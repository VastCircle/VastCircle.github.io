<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='页表 二级页表
将页表分为多个级别不会改变可寻址内存的总量。但是，嵌套方法不需要将整个页表存储为连续数组，也不分配没有描述符的块。这节省了内存空间，但增加了遍历页表的开销。
'><title>性能优化阅读笔记</title>
<link rel=canonical href=https://VastCircle.github.io/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/><link rel=stylesheet href=/scss/style.min.46208cabd58e8bcef0cfb7d7ea6b561adcca3b91dd1fc6657493a44f03c5db75.css><meta property='og:title' content='性能优化阅读笔记'><meta property='og:description' content='页表 二级页表
将页表分为多个级别不会改变可寻址内存的总量。但是，嵌套方法不需要将整个页表存储为连续数组，也不分配没有描述符的块。这节省了内存空间，但增加了遍历页表的开销。
'><meta property='og:url' content='https://VastCircle.github.io/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/'><meta property='og:site_name' content="VastCircle's blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content><meta property='article:published_time' content='2025-04-01T23:17:21+08:00'><meta property='article:modified_time' content='2025-04-01T23:17:21+08:00'><meta name=twitter:title content="性能优化阅读笔记"><meta name=twitter:description content="页表 二级页表
将页表分为多个级别不会改变可寻址内存的总量。但是，嵌套方法不需要将整个页表存储为连续数组，也不分配没有描述符的块。这节省了内存空间，但增加了遍历页表的开销。
"><style>:root{--article-font-family:"Noto Serif SC", var(--base-font-family)}</style><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@300;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex
<!--
extended
-->
on-phone--column extended"><div id=article-toolbar><a href=https://VastCircle.github.io/ class=back-home><svg class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg>
<span>Back</span></a></div><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header class=site-info><figure class=site-avatar><a href=/><img src=/img/avatar_hu9516569771622178000.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🍥</span></figure><h1 class=site-name><a href=/>VastCircle's blog</a></h1><h2 class=site-description>To shine , not to be illuminated</h2><ol class=social-menu><li><a href=https://github.com/VastCircle target=_blank title=GitHub><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://twitter.com target=_blank title=Twitter><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol></header><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>friends</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category></header><h2 class=article-title><a href=/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/>性能优化阅读笔记</a></h2><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Apr 01, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-words>5493字</time></div></footer></div></header><section class=article-content><h2 id=页表>页表</h2><p>二级页表</p><p>将页表分为多个级别不会改变可寻址内存的总量。但是，嵌套方法不需要将整个页表存储为连续数组，也不分配没有描述符的块。这节省了内存空间，但增加了遍历页表的开销。</p><p><figure class=gallery-image style=flex-grow:142;flex-basis:342px><a href=/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/L2PageTables.png data-size=2137x1498><img src=/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/L2PageTables.png width=2137 height=1498 srcset="/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/L2PageTables_hu14037204749170771144.png 480w, /2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/L2PageTables_hu3278571176851013917.png 1024w" loading=lazy alt="2 级页表示例"></a><figcaption>2 级页表示例</figcaption></figure></p><h2 id=性能监测单元>性能监测单元</h2><p>每个现代CPU都提供了监控性能的设施，这些设施被合并到了性能监控单元（PMU）中。</p><p>大多数现代PMU都有一组性能监控计数器（PMC），可用于收集程序执行过程中发生的各种性能事件。</p><p><figure class=gallery-image style=flex-grow:238;flex-basis:571px><a href=/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/PMU.png data-size=2793x1172><img src=/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/PMU.png width=2793 height=1172 srcset="/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/PMU_hu6900871607808201840.png 480w, /2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/PMU_hu13675280461236338084.png 1024w" loading=lazy alt="现代Intel CPU的性能监控单元。"></a><figcaption>现代Intel CPU的性能监控单元。</figcaption></figure></p><h3 id=性能监控计数器>性能监控计数器</h3><p>通常，PMC的宽度为48位，这使得分析工具能够在不中断程序执行的情况下运行很长时间<a class=link href=https://weedge.github.io/perf-book-cn/zh/chapters/3-CPU-Microarchitecture/3-9_PMU_cn.html#fn_2 target=_blank rel=noopener>2</a>。性能计数器是作为模型特定寄存器（MSR）实现的硬件寄存器。这意味着计数器的数量和它们的宽度会因型号而异，您不能依赖于在您的CPU中的相同数量的计数器</p><p><figure class=gallery-image style=flex-grow:162;flex-basis:391px><a href=/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/PMC.png data-size=818x502><img src=/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/PMC.png width=818 height=502 srcset="/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/PMC_hu6887610752607215717.png 480w, /2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/PMC_hu3253121877481112724.png 1024w" loading=lazy alt=带有性能监控计数器的CPU的简化视图。></a><figcaption>带有性能监控计数器的CPU的简化视图。</figcaption></figure></p><h2 id=性能分析中的术语和指标>性能分析中的术语和指标</h2><h3 id=已退役指令和已执行指令>已退役指令和已执行指令</h3><p>现代处理器通常执行的指令数量比程序流程所需的要多。这是因为一些指令是以推测性的方式执行的，如[@sec:SpeculativeExec]中所讨论的。对于大多数指令，CPU在结果可用时提交，所有先前的指令都已退役(retired)。但对于以推测性方式执行的指令，CPU会保留它们的结果，而不立即提交它们的结果。当推测结果被证明是正确时，CPU会解除此类指令的阻塞并正常进行。但当推测结果被证明是错误时，CPU会丢弃推测指令所做的所有更改，并不会退役它们。因此，CPU处理的指令可以被执行但不一定被退役。考虑到这一点，我们通常可以预期执行的指令数量高于已退役的指令数量。</p><p>但有一个例外。某些指令被识别为惯用语，并且在没有实际执行的情况下被解析。其中一些示例是NOP、移动消除和清零，如[@sec:uarchBE]中所讨论的。这些指令不需要执行单元，但仍然被退役。因此，从理论上讲，可能存在已退役指令数量高于已执行指令数量的情况。</p><p>大多数现代处理器都有一个性能监视计数器（PMC），用于收集已退役指令的数量。</p><h3 id=cpu-利用率>CPU 利用率</h3><p>CPU 利用率是在一段时间内 CPU 处于忙碌状态的百分比。从技术上讲，当 CPU 不运行内核的idle线程时，CPU 被 认为是被利用的。</p><p><figure class=gallery-image style=flex-grow:541;flex-basis:1298px><a href=/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250402003540913.png data-size=801x148><img src=/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250402003540913.png width=801 height=148 srcset="/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250402003540913_hu10261036905628789539.png 480w, /2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250402003540913_hu10186407698207898951.png 1024w" loading=lazy></a></figure></p><p>其中，CPU_CLK_UNHALTED.REF_TSC 计算了核心处于非停顿状态时的参考周期数，TSC 代表时间戳计数器（在 Section 2.6中讨论过），它始终在运行。 如果 CPU 利用率低，通常意味着应用程序性能较差，因为 CPU 浪费了一部分时间。然而，高 CPU 利用率并不总是 好性能的指标。这仅仅是系统正在进行一些工作的迹象，但并不表示正在做什么：即使 CPU 由于等待内存访问而被阻塞，它仍然可能被高度利用。在多线程环境中，线程在等待资源继续进行时也可以自旋。稍后在 Section 13.2中， 我们将讨论并行效率指标，特别是 “有效 CPU 利用率”，该指标过滤了自旋时间。</p><h3 id=cpi和ipc>CPI和IPC</h3><p>每条指令周期数 (CPI) - 平均执行一条指令所需的周期数。</p><p>每周期指令数 (IPC) - 平均每个周期完成的指令数。IPC越大越好</p><p>从基准测试的角度来看，IPC 和频率是两个独立的指标。</p><p>英特尔和 AMD 芯片通常具有非常高的频率，最近 的英特尔 13900KS 处理器开箱即用即可提供 6Ghz 的睿频频率，无需超频。另一方面，Apple M1/M2 芯片的频率较 低，但通过更高的 IPC 进行补偿。</p><pre tabindex=0><code>sudo perf stat ./a.exe
</code></pre><h3 id=uop>uop</h3><p>具有 x86 架构的微处理器将复杂的 CISC 类指令转换为简单的 RISC 类微操作，缩写为 𝜇ops。例如，像 ADD rax, rbx 这样的简单加法指令只会生成一个 𝜇op，而更复杂的指令比如 ADD rax, [mem] 可能生成两个：一个用于从 mem 内 存位置读取到临时（未命名）寄存器，另一个用于将其添加到 rax 寄存器。指令 ADD [mem], rax 会生成三个 𝜇ops： 一个用于从内存读取，一个用于相加，一个用于将结果写回内存。</p><p>将指令分割成微操作的主要优点是 𝜇ops 可以执行：</p><p>• 乱序: 考虑 PUSH rbx 指令，它将栈指针减少 8 字节，然后将源操作数存储在栈顶。假设在解码后 PUSH rbx 被 “破解” 成两个依赖的微操作,中，下一个 PUSH 指令可以在前一个 PUSH 指令的 SUB 𝜇op 完成后开始执行，而不必等待现在可以异步执行的 STORE 𝜇op。</p><pre tabindex=0><code>SUB rsp, 8
STORE [rsp], rbx
</code></pre><p>• 并行: 考虑 HADDPD xmm1, xmm2 指令，它将在 xmm1 和 xmm2 中对两个双精度浮点数进行求和（减少），并将两 个结果存储在 xmm1 中，如下所示：</p><pre tabindex=0><code>xmm1[63:0] = xmm2[127:64] + xmm2[63:0]
xmm1[127:64] = xmm1[127:64] + xmm1[63:0]
</code></pre><p>微代码化此指令的一种方法是执行以下操作：1) 减少 xmm2并将结果存储在 xmm_tmp1[63:0] 中，2) 减少 xmm1并将 结果存储在 xmm_tmp2[63:0] 中，3) 将 xmm_tmp1 和 xmm_tmp2 合并到 xmm1 中。总共三个 𝜇ops。请注意，步骤 1) 和 2) 是独立的，因此可以并行完成。</p><p>微融合: 融合来自同一机器指令的 𝜇ops。微融合只能应用于两种类型的组合：内存写操作和读改操作。add eax, [mem] 这条指令中有两个 𝜇ops：1) 读取内存位置 mem，2) 将其添加到 eax。使用微融合，在解码步骤中将两个 𝜇ops 融合成 一个。</p><p>宏融合: 融合来自不同机器指令的 𝜇ops。在某些情况下，解码器可以将算术或逻辑指令与 subsequent 条件跳转 指令融合成单个计算和分支 𝜇op。例如：loop: dec rdi jnz .loop</p><p>微融合和宏融合都可以节省从解码到退役 (retired) 的所有流水线阶段的带宽。</p><p>融合操作在重新排序缓冲区 (ROB) 中 共享单个条目。当一个融合的 𝜇op 只使用一个条目时，ROB 的容量得到更好的利用。这样的一个融合的 ROB 条目 稍后会分派到两个不同的执行端口，但作为单个单元再次退役 (retired)</p><pre tabindex=0><code> sudo perf stat -e uops_dispatched,uops_retired -- ./a.out 
</code></pre><h3 id=pipline-slot>pipline slot</h3><p>流水线槽代表处理一个微操作所需的硬件资源。。图 25 展示了一个每周期有 4 个分配槽的 CPU 的执行流水线。这意味着核心可以在每个周期将执行资源（重命 名的源和目标寄存器、执行端口、ROB 条目等）分配给 4 个新的微操作。</p><p>流水线槽是自顶向下微架构分析 (见 Section 6.1) 的核心指标之一。例如，前端受限和后端受限指标由于各种瓶颈而 表示为未使用的流水线槽的百分比。</p><p><figure class=gallery-image style=flex-grow:145;flex-basis:349px><a href=/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250402011224443.png data-size=374x257><img src=/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250402011224443.png width=374 height=257 srcset="/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250402011224443_hu14350405605681067838.png 480w, /2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250402011224443_hu1095933035646182934.png 1024w" loading=lazy></a></figure></p><h3 id=核心周期和参考周期>核心周期和参考周期</h3><p>大多数 CPU 都使用时钟信号来控制它们的顺序操作。时钟信号由外部发生器产生，每秒提供一致数量的脉冲。时钟 脉冲的频率决定了 CPU 执行指令的速率。</p><p>大多数现代 CPU，包括英特尔和 AMD 的 CPU，没有固定的运行频率。相反，它们实现了动态频率缩放，在英特尔 的 CPU 中称为 Turbo Boost，在 AMD 处理器中称为 Turbo Core。它使 CPU 能够动态增加和减少频率。降低频率可 以减少功耗，但会牺牲性能，增加频率可以提高性能，但会牺牲节能。</p><p>核心时钟周期计数器计算的是 CPU 核心实际运行的频率下的时钟周期数，而不是外部时钟（参考周期）。</p><p>指标ref-cycles统计的周期数是如果没有频率缩放的情况下。指标cycles统计的是真实的 CPU 周期数，即考虑了频率缩放。</p><p><figure class=gallery-image style=flex-grow:408;flex-basis:979px><a href=/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250402011830504.png data-size=1045x256><img src=/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250402011830504.png width=1045 height=256 srcset="/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250402011830504_hu16109986203039746069.png 480w, /2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250402011830504_hu10079190208062985987.png 1024w" loading=lazy></a></figure></p><h3 id=缓存失效>缓存失效</h3><p><figure class=gallery-image style=flex-grow:296;flex-basis:711px><a href=/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250402012232306.png data-size=590x199><img src=/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250402012232306.png width=590 height=199 srcset="/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250402012232306_hu6195894199811405230.png 480w, /2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250402012232306_hu8311064255211617659.png 1024w" loading=lazy></a></figure></p><p>缓存失效可能会发生在指令和数据上。根据 Top-down Microarchitecture Analysis（见 Section 6.1），指令缓存（I-cache） 失效被定义为前端停顿，而数据缓存（D-cache）失效被定义为后端停顿。指令缓存失效在 CPU 流水线的早期阶段 （指令获取阶段）发生。数据缓存失效则发生在后期，即指令执行阶段。</p><h3 id=错误预测>错误预测</h3><pre tabindex=0><code>sudo perf stat -e branches,branch-misses -- ./a.out  
</code></pre><h3 id=性能指标>性能指标</h3><p><figure class=gallery-image style=flex-grow:151;flex-basis:363px><a href=/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250402013659406.png data-size=687x454><img src=/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250402013659406.png width=687 height=454 srcset="/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250402013659406_hu14673297608320781630.png 480w, /2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250402013659406_hu4010768915418696945.png 1024w" loading=lazy></a></figure></p><p><figure class=gallery-image style=flex-grow:91;flex-basis:219px><a href=/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250402013718901.png data-size=513x560><img src=/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250402013718901.png width=513 height=560 srcset="/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250402013718901_hu3336154104166975338.png 480w, /2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250402013718901_hu337463478711302060.png 1024w" loading=lazy></a></figure></p><h3 id=内存延迟和带宽>内存延迟和带宽</h3><p>在现代环境中,低效的内存访问通常是主要的性能瓶颈。因此,处理器从内存子系统中获取单个字节的速度(延迟) 以及每秒可以获取多少字节(带宽)是决定应用程序性能的关键因素之一。</p><p>在 x86 平台上,可以成为有用工具之一的是英特尔内存延迟检查器(MLC),</p><p>我们只关注一个子集指标,即空闲读取延迟和读取带宽。让我们从读取延迟开始。空闲表示在进行测量时,系统处 于空闲状态。这将为我们提供从内存系统组件获取数据所需的最小时间,但是当系统被其他 “内存消耗量大” 的应 用程序加载时,此延迟会增加,因为在各个点上可能会有更多的资源排队。MLC 通过进行相关加载(也称为指针追 踪)来测量空闲延迟。一个测量线程分配一个非常大的缓冲区,并对其进行初始化,以便缓冲区内的每个(64 字节) 缓存行包含指向该缓冲区内另一个非相邻缓存行的指针。通过适当调整缓冲区的大小,我们可以确保几乎所有的加 载都命中某个级别的缓存或主存。</p><blockquote><p>为什么调缓冲区的大小可以确保命中在某一个级别的缓存</p></blockquote><p><figure class=gallery-image style=flex-grow:169;flex-basis:407px><a href=/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250405004739465.png data-size=739x435><img src=/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250405004739465.png width=739 height=435 srcset="/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250405004739465_hu5933420683436180332.png 480w, /2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250405004739465_hu17200651321627045854.png 1024w" loading=lazy></a></figure></p><p>从 1KB 到 48KB 缓冲区大小的左侧的第一个区 域对应于 L1d 缓存,该缓存是每个物理核心私有的。我们可以观察到 E 核心的延迟为 0.9ns,而 P 核心稍高为 1.1ns。 此外,我们可以使用此图来确认缓存大小。请注意,当缓冲区大小超过 32KB 时,E 核心的延迟开始上升,但是在 48KB 之前 P 核心的延迟保持不变。这证实了 E 核心的 L1d 缓存大小为 32KB,而 P 核心的 L1d 缓存大小为 48KB。 第二个区域显示 L2 缓存延迟,E 核的延迟几乎是 P 核的两倍(5.9ns vs. 3.2ns)。对于 P 核,延迟在我们超过 1.25MB 缓冲区大小后会增加,这是预期的。但我们期望 E 核的延迟保持不变,直到 2MB,但在我们的测量中没有发生这种情况。</p><p>第三个区域从 2MB 到 14MB 对应于 L3 缓存延迟,对于两种类型的内核都大约为 12ns。系统中所有内核共享的 L3 缓 存的总大小为 18MB。有趣的是,我们从 15MB 开始看到一些意想不到的动态,而不是 18MB。这很可能是因为一些 访问错过了 L3,需要去主内存。</p><p>第四个区域对应于内存延迟,图表上只显示了其开始部分。当我们越过 18MB 的边界时,延迟会急剧上升,并在 E 核心的 24MB 和 P 核心的 64MB 处开始趋于稳定。使用更大的缓冲区大小为 500MB 时,E 核心的访问延迟为 45ns, P 核心为 90ns。这测量了内存延迟,因为几乎没有加载会命中 L3 缓存。</p><p>使用类似的技术,我们可以测量内存层次结构的各个组件的带宽。为了测量带宽,MLC 执行的加载请求不会被任何后续指令使用。这允许 MLC 生成可能的最大带宽。MLC 在每个配置的逻辑处理器上生成一个软件线程。每个线 程访问的地址是独立的,线程之间没有数据共享。与延迟实验一样,线程使用的缓冲区大小确定了 MLC 是在测量 L1/L2/L3 缓存带宽还是内存带宽。</p><p><figure class=gallery-image style=flex-grow:127;flex-basis:306px><a href=/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250405005844017.png data-size=684x536><img src=/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250405005844017.png width=684 height=536 srcset="/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250405005844017_hu4974051595365791117.png 480w, /2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250405005844017_hu6582201054088410973.png 1024w" loading=lazy></a></figure></p><h2 id=性能分析方法>性能分析方法</h2><p>在这个背景下,所谓的硬件是指执行程序的 CPU,而软件是指操作系统、库、应用程序本身和用于分析的其他工具。 通常,软件堆栈提供高级指标,如时间、上下文切换次数和页面错误,而 CPU 则监视缓存未命中、分支错误预测和 其他与 CPU 相关的事件。</p><h3 id=51-代码插桩-instrumentation>5.1 代码插桩 (Instrumentation)</h3><p>其实就是相当于printf</p><p><figure class=gallery-image style=flex-grow:171;flex-basis:411px><a href=/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250405013216357.png data-size=1001x584><img src=/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250405013216357.png width=1001 height=584 srcset="/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250405013216357_hu17703194273416651726.png 480w, /2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250405013216357_hu9357703449679350585.png 1024w" loading=lazy alt=image-20250405013216357></a><figcaption>image-20250405013216357</figcaption></figure></p><p><figure class=gallery-image style=flex-grow:240;flex-basis:578px><a href=/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250405013227113.png data-size=1002x416><img src=/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250405013227113.png width=1002 height=416 srcset="/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250405013227113_hu3297303976096360266.png 480w, /2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250405013227113_hu13924968354965554334.png 1024w" loading=lazy></a></figure></p><h3 id=跟踪>跟踪</h3><p>另一方面,跟踪依 赖于程序的外部依赖项的现有插桩。例如,strace工具使我们能够跟踪系统调用,并可以被视为对 Linux 内核的插 桩。英特尔处理器跟踪(见附录 D)使您能够记录程序执行的指令,并可以被视为对 CPU 的插桩。跟踪可以从事先 适当插桩的组件中获得,并且不受更改的影响。跟踪通常被用作黑匣子方法,其中用户无法修改应用程序的代码, 但他们希望了解程序在幕后执行的操作。</p><p>跟踪的开销非常取决于我们尝试跟踪的内容。例如,如果我们跟踪的程序几乎不进行系统调用,那么在strace下运 行它的开销将接近零。另一方面,如果我们跟踪的程序严重依赖于系统调用,那么开销可能会非常大,例如,增加 了 100 倍59。此外,跟踪可能会生成大量数据,因为它不会跳过任何样本。为了补偿这一点,跟踪工具提供了过滤 器,使您能够将数据收集限制为特定的时间片段或特定代码段。</p><blockquote><p>感觉就是trace</p></blockquote><h3 id=工作负载特征化>工作负载特征化</h3><p>工作负载特征化是通过定量参数和函数描述工作负载的过程。简单来说,它意味着计算某些性能事件的绝对数量。 特征化的目标是定义工作负载的行为并提取其最重要的特征。</p><p>我们将专注于提取与 CPU 和内存性能相关的特征。从 CPU 角度看, 最好的工作负载特征化示例是顶层微体系结构分析(Top-down Microarchitecture Analysis,TMA)方法,我们将在 Section 6.1中仔细研究。TMA 试图通过将应用程序放入以下 4 个桶之一来表征其性能:CPU 前端、CPU 后端、退役 (retired) 和错误预测,具体取决于造成最多性能问题的原因。TMA 使用性能监视计数器(PMCs)收集所需信息,并 识别 CPU 微体系结构的低效使用。</p><h4 id=计数性能事件>计数性能事件</h4><p>计数背后的想法非常简单:我们希望在程序运行时计数某些性能事件的绝对数量。图 29 展示了从程序开始到结束 计数性能事件的过程。</p><p><figure class=gallery-image style=flex-grow:267;flex-basis:642px><a href=/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250407002141117.png data-size=755x282><img src=/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250407002141117.png width=755 height=282 srcset="/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250407002141117_hu5351877414625898123.png 480w, /2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250407002141117_hu17645198888764373520.png 1024w" loading=lazy></a></figure></p><h4 id=手动收集性能计数器数据>手动收集性能计数器数据</h4><p>Linux perf提供了常用性能计数器的映射。可以通过伪名称而不是指定Event和Umask十六进制值来访问它们。例如, branches只是BR_INST_RETIRED.ALL_BRANCHES的同义词,并且将测量相同的内容。可以使用perf list查看可用 映射名称的列表:</p><h4 id=多路复用和事件缩放>多路复用和事件缩放</h4><p>这就是为什么 PMU 中有多个计数器的原因(在最近的英特尔 Goldencove 微体系结构中,每个硬件线程有 12 个可编程的 PMC,每 个线程有 6 个)。即使这样,固定和可编程计数器的数量并不总是足够的。Top-down 微体系结构分析(TMA)方法 要求在单个程序执行中收集多达 100 种不同的性能事件。
图 30a 显示了只有 4 个 PMC 可用时 8 个性能事件之间的多路复用示例。</p><p><figure class=gallery-image style=flex-grow:130;flex-basis:313px><a href=/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250407012150895.png data-size=808x619><img src=/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250407012150895.png width=808 height=619 srcset="/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250407012150895_hu7189747440316230371.png 480w, /2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/image-20250407012150895_hu6752097185633527509.png 1024w" loading=lazy></a></figure></p><p>通过多路复用,事件并不是一直被测量的,而只在一段时间内被测量。在运行结束时,性能分析工具需要根据总启 用时间对原始计数进行缩放:</p><p>​ 最终计数 = 原始计数 × (运行时间/启用时间)</p><p>假设在分析过程中,我们能够在三个时间间隔内测量来自第 1 组的一个事件。每个测量间隔 持续 100ms(启用时间)。程序运行时间为 500ms(运行时间)。该计数器的总事件数为 10’000(原始计数)。因此,最 终计数需要按以下方式进行缩放: 最终计数 = 10′000 × (500ms/(100ms × 3)) = 16′666</p><blockquote><p>group 2 的事件不会影响事件计数器吗</p><p>貌似是通过操作系统切换上下文，然后再切换的时候读取并清空。</p></blockquote><p>这提供了在整个运行过程中测量事件时计数的估计。非常重要的是要理解,这仍然是一个估计值,而不是实际计数。 多路复用和缩放可以安全地用于执行长时间间隔内相同代码的稳定工作负载。然而,如果程序经常在不同的热点之间跳转,即有不同的阶段,那么就会产生盲点,这可能会在缩放过程中引入错误。为了避免缩放,可以尝试将事件 的数量减少到不超过可用物理 PMC 的数量。然而,这将需要多次运行基准测试,以测量感兴趣的所有计数器。</p><h2 id=cpu-特性用于性能分析>CPU <strong>特性用于性能分析</strong></h2><h2 id=附录>附录</h2><h3 id=参考文献>参考文献</h3><h3 id=版权信息>版权信息</h3><p>本文原载于 <a class=link href=https://vastcircle.github.io target=_blank rel=noopener>vastcircle.github.io</a>，遵循 CC BY-NC-SA 4.0 协议，复制请保留原文出处。</p></section><footer class=article-footer><section class=article-tags></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-contents--wrapper><h2 class=section-title>Related contents</h2><div class=related-contents><div class="flex article-list--tile"><article><a href=/2025/ubuntu22.04%E7%BD%91%E6%98%93%E4%BA%91/><div class=article-details><h2 class=article-title>Ubuntu22.04网易云</h2></div></a></article><article><a href=/2025/gem5_dvr/><div class=article-details><h2 class=article-title>Gem5_dvr</h2></div></a></article><article><a href=/2025/%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%89%93%E5%BC%80%E5%9B%BE%E5%BD%A2%E5%8C%96/><div class=article-details><h2 class=article-title>服务器打开图形化</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{DISQUS&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><script>(function(e,t){var s=document,o="script",n=s.createElement(o),i=s.getElementsByTagName(o)[0];n.src=e,t&&n.addEventListener("load",function(e){t(e)}),i.parentNode.insertBefore(n,i)})("//cdn.bootcss.com/pangu/3.3.0/pangu.min.js",function(){pangu.spacingPage()})</script><section class=copyright>&copy;
2023 -
2025 <a href=https://stack-theme-mod.vercel.app/>vastcircle</a>·<i class="fas fa-bell"></i> <a id=days>0</a>Days<br>共书写了394.9k字·共 103篇文章</br><span><p></section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.2.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a><br><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh target=_blank>© Licensed Under CC BY-NC-SA 4.0</a></section><script>var days,number_of_days,s1="2024-10-06",s1=new Date(s1.replace(/-/g,"/"));s2=new Date,days=s2.getTime()-s1.getTime(),number_of_days=parseInt(days/(1e3*60*60*24)),document.getElementById("days").innerHTML=number_of_days</script></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><form action=/search/ class="search-form widget"><p><label>Search</label>
<input name=keyword required placeholder="Type something...">
<button title=Search><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg></button></p></form><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#页表>页表</a></li><li><a href=#性能监测单元>性能监测单元</a><ol><li><a href=#性能监控计数器>性能监控计数器</a></li></ol></li><li><a href=#性能分析中的术语和指标>性能分析中的术语和指标</a><ol><li><a href=#已退役指令和已执行指令>已退役指令和已执行指令</a></li><li><a href=#cpu-利用率>CPU 利用率</a></li><li><a href=#cpi和ipc>CPI和IPC</a></li><li><a href=#uop>uop</a></li><li><a href=#pipline-slot>pipline slot</a></li><li><a href=#核心周期和参考周期>核心周期和参考周期</a></li><li><a href=#缓存失效>缓存失效</a></li><li><a href=#错误预测>错误预测</a></li><li><a href=#性能指标>性能指标</a></li><li><a href=#内存延迟和带宽>内存延迟和带宽</a></li></ol></li><li><a href=#性能分析方法>性能分析方法</a><ol><li><a href=#51-代码插桩-instrumentation>5.1 代码插桩 (Instrumentation)</a></li><li><a href=#跟踪>跟踪</a></li><li><a href=#工作负载特征化>工作负载特征化</a><ol><li><a href=#计数性能事件>计数性能事件</a></li><li><a href=#手动收集性能计数器数据>手动收集性能计数器数据</a></li><li><a href=#多路复用和事件缩放>多路复用和事件缩放</a></li></ol></li></ol></li><li><a href=#cpu-特性用于性能分析>CPU <strong>特性用于性能分析</strong></a></li><li><a href=#附录>附录</a><ol><li><a href=#参考文献>参考文献</a></li><li><a href=#版权信息>版权信息</a></li></ol></li></ol></nav></div></section><section class="widget categories"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-infinity" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M9.828 9.172a4 4 0 100 5.656A10 10 0 0012 12a10 10 0 012.172-2.828 4 4 0 110 5.656A10 10 0 0112 12 10 10 0 009.828 9.172"/></svg></div><h2 class="widget-title section-title">Categories</h2><div class=widget-categories--list><div class=widget><h3 class=widget-title></h3><div class=widget-body><div class=category-list><div class=category-list-item><a href=https://VastCircle.github.io/categories/boom/ class=category-list-link>boom<span class=category-list-count>2</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/boom%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB/ class=category-list-link>boom代码阅读<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/c++/ class=category-list-link>c++<span class=category-list-count>3</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/cache/ class=category-list-link>cache<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/chipyard/ class=category-list-link>chipyard<span class=category-list-count>3</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/chisel/ class=category-list-link>chisel<span class=category-list-count>2</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/cpu%E5%9F%BA%E7%A1%80/ class=category-list-link>cpu基础<span class=category-list-count>2</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/gem5/ class=category-list-link>gem5<span class=category-list-count>5</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/gpgpu%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/ class=category-list-link>gpgpu读书笔记<span class=category-list-count>2</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/linux/ class=category-list-link>linux<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/prefetch/ class=category-list-link>prefetch<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/riscv/ class=category-list-link>riscv<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/rocket-chip/ class=category-list-link>rocket-chip<span class=category-list-count>2</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/runahead/ class=category-list-link>runahead<span class=category-list-count>3</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB/ class=category-list-link>代码阅读<span class=category-list-count>2</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E5%88%86%E6%94%AF%E9%A2%84%E6%B5%8B/ class=category-list-link>分支预测<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/ class=category-list-link>博客搭建<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/ class=category-list-link>基础概念<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E5%A4%84%E7%90%86%E5%99%A8/ class=category-list-link>处理器<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/ class=category-list-link>操作系统<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E7%8E%AF%E5%A2%83/ class=category-list-link>环境<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/ class=category-list-link>环境搭建<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/ class=category-list-link>环境配置<span class=category-list-count>5</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7/ class=category-list-link>缓存一致性<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/ class=category-list-link>论文阅读<span class=category-list-count>17</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E8%AE%BF%E5%AD%98/ class=category-list-link>访存<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E8%B6%85%E6%A0%87%E9%87%8F%E5%A4%84%E7%90%86%E5%99%A8/ class=category-list-link>超标量处理器<span class=category-list-count>12</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E9%A6%99%E5%B1%B1/ class=category-list-link>香山<span class=category-list-count>8</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E9%A6%99%E5%B1%B1%E6%BA%90%E4%BB%A3%E7%A0%81/ class=category-list-link>香山源代码<span class=category-list-count>3</a></span></div></div></div></div></div></section><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-infinity" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M9.828 9.172a4 4 0 100 5.656A10 10 0 0012 12a10 10 0 012.172-2.828 4 4 0 110 5.656A10 10 0 0112 12 10 10 0 009.828 9.172"/></svg></div><h2 class="widget-title section-title">Archives</h2><div class=widget-archive--list><div class=archives-year><a href=/archives/#2025><span class=year>2025</span>
<span class=count>55</span></a></div><div class=archives-year><a href=/archives/#2024><span class=year>2024</span>
<span class=count>47</span></a></div></div></section><section class="widget tagCloud"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11 3l9 9a1.5 1.5.0 010 2l-6 6a1.5 1.5.0 01-2 0L3 11V7a4 4 0 014-4h4"/><circle cx="9" cy="9" r="2"/></svg></div><h2 class="widget-title section-title">Tags</h2><div class=tagCloud-tags><a href=/tags/runahead/ class=font_size_6>Runahead
</a><a href=/tags/prefetch/ class=font_size_4>Prefetch
</a><a href=/tags/vector/ class=font_size_3>Vector
</a><a href=/tags/cache/ class=font_size_2>Cache
</a><a href=/tags/chipyard/ class=font_size_2>Chipyard
</a><a href=/tags/diplomacy/ class=font_size_2>Diplomacy
</a><a href=/tags/in-order/ class=font_size_2>In-Order
</a><a href=/tags/rocket-chip/ class=font_size_2>Rocket-Chip
</a><a href=/tags/%E5%88%86%E6%94%AF%E9%A2%84%E6%B5%8B/ class=font_size_2>分支预测
</a><a href=/tags/%E5%AF%84%E5%AD%98%E5%99%A8%E9%87%8D%E5%91%BD%E5%90%8D/ class=font_size_2>寄存器重命名</a></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>