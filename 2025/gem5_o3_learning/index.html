<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='é˜…è¯»gem5 o3 cpu çš„ç›¸å…³ä»£ç 
gem5 çš„å¯åŠ¨æµç¨‹ '><title>Gem5_o3_learning</title>
<link rel=canonical href=https://VastCircle.github.io/2025/gem5_o3_learning/><link rel=stylesheet href=/scss/style.min.46208cabd58e8bcef0cfb7d7ea6b561adcca3b91dd1fc6657493a44f03c5db75.css><meta property='og:title' content='Gem5_o3_learning'><meta property='og:description' content='é˜…è¯»gem5 o3 cpu çš„ç›¸å…³ä»£ç 
gem5 çš„å¯åŠ¨æµç¨‹ '><meta property='og:url' content='https://VastCircle.github.io/2025/gem5_o3_learning/'><meta property='og:site_name' content="VastCircle's blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content><meta property='article:published_time' content='2025-03-10T21:38:17+08:00'><meta property='article:modified_time' content='2025-03-10T21:38:17+08:00'><meta name=twitter:title content="Gem5_o3_learning"><meta name=twitter:description content="é˜…è¯»gem5 o3 cpu çš„ç›¸å…³ä»£ç 
gem5 çš„å¯åŠ¨æµç¨‹ "><style>:root{--article-font-family:"Noto Serif SC", var(--base-font-family)}</style><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@300;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex
<!--
extended
-->
on-phone--column extended"><div id=article-toolbar><a href=https://VastCircle.github.io/ class=back-home><svg class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg>
<span>Back</span></a></div><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header class=site-info><figure class=site-avatar><a href=/><img src=/img/avatar_hu9516569771622178000.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸ¥</span></figure><h1 class=site-name><a href=/>VastCircle's blog</a></h1><h2 class=site-description>To shine , not to be illuminated</h2><ol class=social-menu><li><a href=https://github.com/VastCircle target=_blank title=GitHub><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://twitter.com target=_blank title=Twitter><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol></header><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>friends</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/gem5/>Gem5</a></header><h2 class=article-title><a href=/2025/gem5_o3_learning/>Gem5_o3_learning</a></h2><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Mar 10, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-words>15223å­—</time></div></footer></div></header><section class=article-content><p>é˜…è¯»gem5 o3 cpu çš„ç›¸å…³ä»£ç </p><h2 id=gem5-çš„å¯åŠ¨æµç¨‹>gem5 çš„å¯åŠ¨æµç¨‹</h2><p><figure class=gallery-image style=flex-grow:117;flex-basis:280px><a href=/2025/gem5_o3_learning/image-20250311135207240.png data-size=1214x1037><img src=/2025/gem5_o3_learning/image-20250311135207240.png width=1214 height=1037 srcset="/2025/gem5_o3_learning/image-20250311135207240_hu18044602024549881621.png 480w, /2025/gem5_o3_learning/image-20250311135207240_hu15724206339638623331.png 1024w" loading=lazy></a></figure></p><p><figure class=gallery-image style=flex-grow:161;flex-basis:388px><a href=/2025/gem5_o3_learning/v2-c3e789d58af32d1d3f731722f5fc7b76_1440w.jpeg data-size=1397x863><img src=/2025/gem5_o3_learning/v2-c3e789d58af32d1d3f731722f5fc7b76_1440w.jpeg width=1397 height=863 srcset="/2025/gem5_o3_learning/v2-c3e789d58af32d1d3f731722f5fc7b76_1440w_hu8355152863149321304.jpeg 480w, /2025/gem5_o3_learning/v2-c3e789d58af32d1d3f731722f5fc7b76_1440w_hu7752461498771057939.jpeg 1024w" loading=lazy alt="gem5-  c++/python co-binding"></a><figcaption>gem5- c++/python co-binding</figcaption></figure></p><h2 id=ä»¿çœŸå‰çš„åˆå§‹åŒ–>ä»¿çœŸå‰çš„åˆå§‹åŒ–</h2><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#e06c75>src</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>sim</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>main</span>.<span style=color:#e06c75>cc</span>: <span style=color:#e06c75>importer</span>() <span style=color:#56b6c2>-&gt;</span> <span style=color:#e06c75>importInit</span>()<span style=color:#56b6c2>-&gt;</span> <span style=color:#e06c75>initAll</span>()
</span></span><span style=display:flex><span><span style=color:#e06c75>src</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>python</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>embedded</span>.<span style=color:#e06c75>cc</span>: <span style=color:#e06c75>initAll</span>()
</span></span><span style=display:flex><span><span style=color:#e06c75>src</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>sim</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>init</span>.<span style=color:#e06c75>cc</span>: <span style=color:#e06c75>initAll</span>()<span style=color:#56b6c2>-&gt;</span> <span style=color:#e06c75>pybind_init_event</span>()
</span></span><span style=display:flex><span><span style=color:#e06c75>src</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>python</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>pybind11</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>event</span>.<span style=color:#e06c75>cc</span>: <span style=color:#e06c75>pybind_init_event</span>() <span style=color:#56b6c2>-&gt;</span> <span style=color:#e06c75>simulate</span>()
</span></span><span style=display:flex><span><span style=color:#e06c75>src</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>sim</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>simulate</span>.<span style=color:#e06c75>cc</span>: <span style=color:#e06c75>simulate</span>() <span style=color:#56b6c2>-&gt;</span> <span style=color:#e06c75>doSimloop</span>() <span style=color:#56b6c2>-&gt;</span> <span style=color:#e06c75>serviceOne</span>()
</span></span><span style=display:flex><span><span style=color:#e06c75>src</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>sim</span><span style=color:#56b6c2>/</span><span style=color:#e06c75>eventq</span>.<span style=color:#e06c75>cc</span>: <span style=color:#e06c75>serviceOne</span>() <span style=color:#56b6c2>-&gt;</span> <span style=color:#e06c75>eventq</span>.<span style=color:#e06c75>hh</span>:<span style=color:#e06c75>event</span><span style=color:#56b6c2>-&gt;</span><span style=color:#e06c75>process</span>()
</span></span></code></pre></div><h2 id=è®¡ç®—æŒ‡ä»¤>è®¡ç®—æŒ‡ä»¤</h2><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#e06c75>Rename</span><span style=color:#56b6c2>::</span><span style=color:#e06c75>tick</span>()<span style=color:#56b6c2>-&gt;</span><span style=color:#e06c75>Rename</span><span style=color:#56b6c2>::</span><span style=color:#e06c75>RenameInsts</span>()
</span></span><span style=display:flex><span><span style=color:#e06c75>IEW</span><span style=color:#56b6c2>::</span><span style=color:#e06c75>tick</span>()<span style=color:#56b6c2>-&gt;</span><span style=color:#e06c75>IEW</span><span style=color:#56b6c2>::</span><span style=color:#e06c75>dispatchInsts</span>()
</span></span><span style=display:flex><span><span style=color:#e06c75>IEW</span><span style=color:#56b6c2>::</span><span style=color:#e06c75>tick</span>()<span style=color:#56b6c2>-&gt;</span><span style=color:#e06c75>InstructionQueue</span><span style=color:#56b6c2>::</span><span style=color:#e06c75>scheduleReadyInsts</span>()
</span></span><span style=display:flex><span><span style=color:#e06c75>IEW</span><span style=color:#56b6c2>::</span><span style=color:#e06c75>tick</span>()<span style=color:#56b6c2>-&gt;</span><span style=color:#e06c75>IEW</span><span style=color:#56b6c2>::</span><span style=color:#e06c75>executeInsts</span>()
</span></span><span style=display:flex><span><span style=color:#e06c75>IEW</span><span style=color:#56b6c2>::</span><span style=color:#e06c75>tick</span>()<span style=color:#56b6c2>-&gt;</span><span style=color:#e06c75>IEW</span><span style=color:#56b6c2>::</span><span style=color:#e06c75>writebackInsts</span>()
</span></span><span style=display:flex><span><span style=color:#e06c75>Commit</span><span style=color:#56b6c2>::</span><span style=color:#e06c75>tick</span>()<span style=color:#56b6c2>-&gt;</span><span style=color:#e06c75>Commit</span><span style=color:#56b6c2>::</span><span style=color:#e06c75>commitInsts</span>()<span style=color:#56b6c2>-&gt;</span><span style=color:#e06c75>Commit</span><span style=color:#56b6c2>::</span><span style=color:#e06c75>commitHead</span>()
</span></span></code></pre></div><ul><li>é‡å‘½åï¼ˆ<code>Rename::renameInsts()</code>ï¼‰ã€‚é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å°†å¯„å­˜å™¨é‡å‘½åï¼Œå¹¶å°†æŒ‡ä»¤æ¨é€åˆ° IEW é˜¶æ®µã€‚å®ƒä¼šæ£€æŸ¥ IQ/LSQ æ˜¯å¦å¯ä»¥å®¹çº³æ–°æŒ‡ä»¤ã€‚</li><li>Dispatchï¼ˆ<code>IEW::dispatchInsts()</code>ï¼‰ã€‚æ­¤å‡½æ•°å°†é‡å‘½åçš„æŒ‡ä»¤æ’å…¥åˆ° IQ å’Œ LSQ ä¸­ã€‚</li><li>è°ƒåº¦ï¼ˆ<code>InstructionQueue::scheduleReadyInsts()</code>ï¼‰ IQ ç®¡ç†å°±ç»ªåˆ—è¡¨ä¸­çš„å°±ç»ªæŒ‡ä»¤ï¼ˆæ“ä½œæ•°å°±ç»ªï¼‰ï¼Œå¹¶å°†å®ƒä»¬è°ƒåº¦åˆ°å¯ç”¨çš„ FUã€‚FU çš„å»¶è¿Ÿåœ¨è¿™é‡Œè®¾ç½®ï¼Œå½“ FU å®Œæˆæ—¶ï¼ŒæŒ‡ä»¤å°†è¢«å‘é€æ‰§è¡Œã€‚</li><li>æ‰§è¡Œï¼ˆ<code>IEW::executeInsts()</code>ï¼‰ã€‚æ­¤å¤„<code>execute()</code>è°ƒç”¨è®¡ç®—æŒ‡ä»¤å‡½æ•°å¹¶å°†å…¶å‘é€è‡³æäº¤ã€‚è¯·æ³¨æ„<code>execute()</code>å°†æŠŠç»“æœå†™å…¥ç›®æ ‡å¯„å­˜å™¨ã€‚</li><li>Writeback( <code>IEW::writebackInsts()</code>)ã€‚è¿™é‡Œ<code>InstructionQueue::wakeDependents()</code>è°ƒç”¨ã€‚ç›¸å…³æŒ‡ä»¤å°†è¢«æ·»åŠ åˆ°å°±ç»ªåˆ—è¡¨ä¸­ä»¥ä¾›è°ƒåº¦ã€‚</li><li>æäº¤ï¼ˆ<code>Commit::commitInsts()</code>ï¼‰ã€‚ä¸€æ—¦æŒ‡ä»¤åˆ°è¾¾ROBçš„å¤´éƒ¨ï¼Œå®ƒå°†è¢«æäº¤å¹¶ä»ROBä¸­é‡Šæ”¾ã€‚</li></ul><h2 id=è®¿å­˜æŒ‡ä»¤>è®¿å­˜æŒ‡ä»¤</h2><h3 id=load-æŒ‡ä»¤>load æŒ‡ä»¤</h3><ul><li>åŠ è½½æŒ‡ä»¤ä¸è®¡ç®—æŒ‡ä»¤å…±äº«ç›¸åŒçš„è·¯å¾„ç›´åˆ°æ‰§è¡Œã€‚</li></ul><pre tabindex=0><code>Rename::tick()-&gt;Rename::RenameInsts()
IEW::tick()-&gt;IEW::dispatchInsts()
IEW::tick()-&gt;InstructionQueue::scheduleReadyInsts()
IEW::tick()-&gt;IEW::executeInsts()
  -&gt;LSQUnit::executeLoad()
    -&gt;StaticInst::initiateAcc()
      -&gt;LSQ::pushRequest()
        -&gt;LSQUnit::read()
          -&gt;LSQRequest::buildPackets()
          -&gt;LSQRequest::sendPacketToCache()
    -&gt;LSQUnit::checkViolation()
DcachePort::recvTimingResp()-&gt;LSQRequest::recvTimingResp()
  -&gt;LSQUnit::completeDataAccess()
    -&gt;LSQUnit::writeback()
      -&gt;StaticInst::completeAcc()
      -&gt;IEW::instToCommit()
IEW::tick()-&gt;IEW::writebackInsts()
</code></pre><ul><li><p><code>LSQUnit::executeLoad()</code>å°†é€šè¿‡è°ƒç”¨æŒ‡ä»¤çš„å‡½æ•°æ¥å¯åŠ¨è®¿é—®<code>initiateAcc()</code>ã€‚é€šè¿‡æ‰§è¡Œä¸Šä¸‹æ–‡æ¥å£ï¼Œ <code>initiateAcc()</code>å°†è°ƒç”¨<code>initiateMemRead()</code>å¹¶æœ€ç»ˆå®šå‘åˆ°<code>LSQ::pushRequest()</code>ã€‚</p></li><li><p><code>LSQ::pushRequest()</code>å°†åˆ†é…ä¸€ä¸ª<code>LSQRequest</code>æ¥è·Ÿè¸ªæ‰€æœ‰çŠ¶æ€ï¼Œå¹¶å¼€å§‹è½¬æ¢ã€‚è½¬æ¢å®Œæˆåï¼Œå®ƒå°†è®°å½•è™šæ‹Ÿåœ°å€å¹¶è°ƒç”¨<code>LSQUnit::read()</code>ã€‚</p></li><li><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>LSQUnit::read()
</span></span></code></pre></div><p>å°†æ£€æŸ¥è¯¥è´Ÿè½½æ˜¯å¦ä¸ä»»ä½•å…ˆå‰çš„å­˜å‚¨æœ‰åˆ«åã€‚</p><ul><li>å¦‚æœå¯ä»¥è½¬å‘ï¼Œé‚£ä¹ˆå®ƒå°†å®‰æ’<code>WritebackEvent</code>ä¸‹ä¸€ä¸ªå‘¨æœŸã€‚</li><li>å¦‚æœå®ƒæ˜¯åˆ«åä½†ä¸èƒ½è½¬å‘ï¼Œå®ƒä¼šè°ƒç”¨ <code>InstructionQueue::rescheduleMemInst()</code>å’Œ<code>LSQReuqest::discard()</code>ã€‚</li><li>å¦åˆ™ï¼Œå®ƒä¼šå°†æ•°æ®åŒ…å‘é€åˆ°ç¼“å­˜ã€‚</li></ul></li><li><p><code>LSQUnit::writeback()</code>å°†è°ƒç”¨<code>StaticInst::completeAcc()</code>ï¼Œå®ƒå°†æŠŠåŠ è½½çš„å€¼å†™å…¥ç›®æ ‡å¯„å­˜å™¨ã€‚ç„¶åè¯¥æŒ‡ä»¤è¢«æ¨é€åˆ°æäº¤é˜Ÿåˆ—ã€‚<code>IEW::writebackInsts()</code> ç„¶åå°†å…¶æ ‡è®°ä¸ºå®Œæˆå¹¶å”¤é†’å…¶ä¾èµ–é¡¹ã€‚ä»è¿™é‡Œå¼€å§‹ï¼Œå®ƒä¸è®¡ç®—æŒ‡ä»¤å…±äº«ç›¸åŒçš„è·¯å¾„ã€‚</p></li></ul><h3 id=store-æŒ‡ä»¤>store æŒ‡ä»¤</h3><pre tabindex=0><code>IEW::tick()-&gt;IEW::executeInsts()
  -&gt;LSQUnit::executeStore()
    -&gt;StaticInst::initiateAcc()
      -&gt;LSQ::pushRequest()
        -&gt;LSQUnit::write()
    -&gt;LSQUnit::checkViolation()
Commit::tick()-&gt;Commit::commitInsts()-&gt;Commit::commitHead()
IEW::tick()-&gt;LSQUnit::commitStores()
IEW::tick()-&gt;LSQUnit::writebackStores()
  -&gt;LSQRequest::buildPackets()
  -&gt;LSQRequest::sendPacketToCache()
  -&gt;LSQUnit::storePostSend()
DcachePort::recvTimingResp()-&gt;LSQRequest::recvTimingResp()
  -&gt;LSQUnit::completeDataAccess()
    -&gt;LSQUnit::completeStore()
</code></pre><ul><li>ä¸<code>LSQUnit::read()</code>ä¸åŒï¼Œ<code>LSQUnit::write()</code>åªä¼šå¤åˆ¶å­˜å‚¨æ•°æ®ï¼Œä½†ä¸ä¼šå°†æ•°æ®åŒ…å‘é€åˆ°ç¼“å­˜ï¼Œå› ä¸ºå­˜å‚¨å°šæœªæäº¤ã€‚</li><li>å­˜å‚¨æäº¤åï¼Œ<code>LSQUnit::commitStores()</code>å°†æ ‡è®° SQ æ¡ç›®ï¼Œä»¥ä¾¿<code>canWB</code>å°†<code>LSQUnit::writebackStores()</code>å­˜å‚¨è¯·æ±‚å‘é€åˆ°ç¼“å­˜ã€‚</li><li>æœ€åï¼Œå½“å“åº”è¿”å›æ—¶ï¼Œ<code>LSQUnit::completeStore()</code>å°†é‡Šæ”¾ SQ æ¡ç›®ã€‚</li></ul><h3 id=memory-order-fail>memory order fail</h3><p>InstructionQueueå…·æœ‰è·Ÿè¸ªå†…å­˜é¡ºåºä¾èµ–æ€§çš„çš„åŠŸèƒ½<code>MemDepUnit</code>ã€‚å¦‚æœ MemDepUnit å£°æ˜å­˜åœ¨ä¾èµ–æ€§ï¼ŒIQ å°†ä¸ä¼šè°ƒåº¦æŒ‡ä»¤ã€‚</p><p>åœ¨<code>LSQUnit::read()</code> ä¸­ï¼ŒLSQ å°†æœç´¢å¯èƒ½çš„åˆ«åå­˜å‚¨å¹¶è½¬å‘ï¼ˆå¦‚æœå¯èƒ½ï¼‰ã€‚å¦åˆ™ï¼Œå°†é˜»æ­¢åŠ è½½ï¼Œå¹¶é€šè¿‡é€šçŸ¥ MemDepUnit é‡æ–°å®‰æ’ï¼Œç›´åˆ°é˜»æ­¢å­˜å‚¨å®Œæˆã€‚</p><p><code>LSQUnit::executeLoad/Store()</code>ä¸¤è€…éƒ½å°†è°ƒç”¨<code>LSQUnit::checkViolation()</code> æ¥æœç´¢ LQ ä»¥æŸ¥æ‰¾å¯èƒ½çš„é”™è¯¯æ¨æµ‹ã€‚å¦‚æœå‘ç°ï¼Œå®ƒå°†è®¾ç½® <code>LSQUnit::memDepViolator</code>å¹¶<code>IEW::executeInsts()</code>ç¨åå¯åŠ¨ä»¥æ¶ˆé™¤é”™è¯¯æ¨æµ‹çš„æŒ‡ä»¤ã€‚</p><pre tabindex=0><code>IEW::tick()-&gt;IEW::executeInsts()
  -&gt;LSQUnit::executeLoad()
    -&gt;StaticInst::initiateAcc()
    -&gt;LSQUnit::checkViolation()
  -&gt;IEW::squashDueToMemOrder()
</code></pre><h2 id=staticinst>staticinst</h2><p>StaticInst ä¸ºäºŒè¿›åˆ¶æŒ‡ä»¤æä¾›æ‰€æœ‰é™æ€ä¿¡æ¯å’Œæ–¹æ³•ã€‚</p><p>å®ƒåŒ…å«ä»¥ä¸‹ä¿¡æ¯/æ–¹æ³•ï¼š</p><ul><li>æ ‡å¿—æ¥è¡¨æ˜å®ƒæ˜¯ä»€ä¹ˆç±»å‹çš„æŒ‡ä»¤ï¼ˆæ•´æ•°ï¼Œæµ®ç‚¹ï¼Œåˆ†æ”¯ï¼Œå†…å­˜å±éšœç­‰ï¼‰</li><li>æŒ‡ä»¤çš„æ“ä½œç±»</li><li>æºå¯„å­˜å™¨å’Œç›®æ ‡å¯„å­˜å™¨çš„æ•°é‡</li><li>ä½¿ç”¨çš„æ•´æ•°å’Œæµ®ç‚¹å¯„å­˜å™¨çš„æ•°é‡</li><li>å°†äºŒè¿›åˆ¶æŒ‡ä»¤è§£ç ä¸º StaticInst çš„æ–¹æ³•</li><li>è™šæ‹Ÿå‡½æ•°execute()ï¼Œå®šä¹‰å¦‚ä½•æ‰§è¡Œä¸€æ¡æŒ‡ä»¤çš„å…·ä½“æ¶æ„æ“ä½œï¼ˆä¾‹å¦‚è¯»å–r1ã€r2ï¼Œå°†å®ƒä»¬æ·»åŠ å¹¶å­˜å‚¨åœ¨r3ä¸­ï¼‰ã€‚</li><li>è™šæ‹Ÿå‡½æ•°æ¥å¤„ç†å¯åŠ¨å’Œå®Œæˆå†…å­˜æ“ä½œ</li><li>å¯¹äºå°†å†…å­˜æ“ä½œæ‹†åˆ†ä¸ºä¸¤ä¸ªæ“ä½œçš„æ¨¡å‹ï¼Œè™šæ‹Ÿå‡½æ•°åˆ†åˆ«æ‰§è¡Œåœ°å€è®¡ç®—å’Œå†…å­˜è®¿é—®</li><li>åæ±‡ç¼–æŒ‡ä»¤çš„æ–¹æ³•ï¼Œä»¥äººç±»å¯è¯»çš„æ ¼å¼æ‰“å°å‡ºæ¥ã€‚ï¼ˆä¾‹å¦‚ addq r1 r2 r3ï¼‰</li></ul><p>å®ƒæ²¡æœ‰åŠ¨æ€ä¿¡æ¯ï¼Œä¾‹å¦‚æŒ‡ä»¤çš„ PC æˆ–æºå¯„å­˜å™¨çš„å€¼æˆ–ç»“æœã€‚è¿™å…è®¸å°† StaticInst 1 å¯¹ 1 æ˜ å°„åˆ°å”¯ä¸€çš„äºŒè¿›åˆ¶æœºå™¨æŒ‡ä»¤ã€‚æˆ‘ä»¬åˆ©ç”¨è¿™ä¸€äº‹å®ï¼Œå°†äºŒè¿›åˆ¶æŒ‡ä»¤åˆ° StaticInst çš„æ˜ å°„ç¼“å­˜åœ¨ hash_map ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬åªéœ€è§£ç ä¸€æ¬¡äºŒè¿›åˆ¶æŒ‡ä»¤ï¼Œå…¶ä½™æ—¶é—´ç›´æ¥ä½¿ç”¨ StaticInstã€‚</p><h2 id=dyninsts>DynInsts</h2><p>DynInst ç”¨äºä¿å­˜æœ‰å…³æŒ‡ä»¤çš„åŠ¨æ€ä¿¡æ¯ã€‚è¿™å¯¹äºæ›´è¯¦ç»†çš„æ¨¡å‹æˆ–æ— åºæ¨¡å‹æ˜¯å¿…éœ€çš„ï¼Œè¿™ä¸¤ç§æ¨¡å‹éƒ½å¯èƒ½éœ€è¦<a class=link href=https://www.gem5.org/documentation/general_docs/cpu_models/execution_basics#staticinsts target=_blank rel=noopener>StaticInsts</a>ä»¥å¤–çš„é¢å¤–ä¿¡æ¯æ‰èƒ½æ­£ç¡®æ‰§è¡ŒæŒ‡ä»¤ã€‚å®ƒå­˜å‚¨çš„ä¸€äº›åŠ¨æ€ä¿¡æ¯åŒ…æ‹¬ï¼š</p><ul><li>æŒ‡ä»¤çš„PC</li><li>æºå¯„å­˜å™¨å’Œç›®æ ‡å¯„å­˜å™¨çš„é‡å‘½åå¯„å­˜å™¨ç´¢å¼•</li><li>é¢„æµ‹ä¸‹ä¸€ä»£ PC</li><li>æŒ‡å¯¼ç»“æœ</li><li>æŒ‡ä»¤çš„çº¿ç¨‹å·</li><li>æ‰§è¡Œè¯¥æŒ‡ä»¤çš„ CPU</li><li>æŒ‡ä»¤æ˜¯å¦è¢«å‹ç¼©</li></ul><p>æ­¤å¤–ï¼ŒDynInst è¿˜æä¾›äº† ExecContext æ¥å£ã€‚å½“æ‰§è¡Œ ISA æŒ‡ä»¤æ—¶ï¼ŒDynInst å°†ä½œä¸º ExecContext ä¼ å…¥ï¼Œå¤„ç† ISA å¯¹ CPU çŠ¶æ€çš„æ‰€æœ‰è®¿é—®ã€‚</p><p>è¯¦ç»†çš„ CPU æ¨¡å‹å¯ä»¥ä» DynInst æ´¾ç”Ÿï¼Œå¹¶åˆ›å»ºè‡ªå·±çš„ç‰¹å®š DynInst å­ç±»ï¼Œä»¥å®ç°å¯èƒ½éœ€è¦çš„ä»»ä½•é™„åŠ çŠ¶æ€æˆ–åŠŸèƒ½ã€‚è¯·å‚é˜… src/cpu/o3/alpha/dyn_inst.hh ä»¥è·å–æ­¤ç¤ºä¾‹ã€‚</p><h2 id=rename>rename</h2><h4 id=æ­£å¸¸é‡å‘½å><strong>æ­£å¸¸é‡å‘½å</strong></h4><ol><li>æŒ‡ä»¤ <code>ADD R1, R2</code> éœ€é‡å‘½åæ¶æ„å¯„å­˜å™¨ <code>R1</code>ã€‚</li><li>å½“å‰æ˜ å°„ <code>map[R1] = P5</code>ï¼ˆæ—§å¯„å­˜å™¨ï¼‰ã€‚</li><li>ä» <code>freeList</code> åˆ†é…æ–°ç‰©ç†å¯„å­˜å™¨ <code>P10</code>ã€‚</li><li>æ›´æ–°æ˜ å°„è¡¨ï¼š<code>map[R1] = P10</code>ã€‚</li><li>è¿”å› <code>RenameInfo(P10, P5)</code>ã€‚</li></ol><h4 id=é’‰ä½å¯„å­˜å™¨é‡å‘½å><strong>é’‰ä½å¯„å­˜å™¨é‡å‘½å</strong></h4><ol><li>åŸå­æŒ‡ä»¤ <code>XCHG R3, [MEM]</code> é’‰ä½ <code>R3</code>ï¼ˆ<code>numPinnedWrites = 1</code>ï¼‰ã€‚</li><li>åç»­æŒ‡ä»¤å°è¯•é‡å‘½å <code>R3</code> æ—¶ï¼Œæ£€æµ‹åˆ°é’‰ä½è®¡æ•° >0ï¼Œä¿æŒæ˜ å°„ <code>P7</code>ã€‚</li><li>å®Œæˆå†™å…¥åï¼Œé’‰ä½è®¡æ•°å‡1ï¼Œè§£é™¤é’‰ä½ã€‚</li></ol><h2 id=gem5-timebuff>gem5 timebuff</h2><p><code>TimeBuffer</code> æ˜¯ä¸€ä¸ª<strong>ç¯å½¢ç¼“å†²åŒº</strong>ï¼Œç”¨äºå­˜å‚¨<strong>ä¸åŒæ—¶é—´ç‚¹</strong>çš„æ•°æ®ï¼ˆå¦‚æŒ‡ä»¤ã€çŠ¶æ€ç­‰ï¼‰ï¼Œæ”¯æŒï¼š</p><ul><li><strong>æ—¶é—´åç§»è®¿é—®</strong>ï¼šå¯ä»¥è®¿é—®â€œè¿‡å»â€ï¼ˆ<code>past</code>ï¼‰æˆ–â€œæœªæ¥â€ï¼ˆ<code>future</code>ï¼‰çš„æ•°æ®ã€‚</li><li><strong>é«˜æ•ˆå†…å­˜ç®¡ç†</strong>ï¼šé€šè¿‡é¢„åˆ†é…å†…å­˜å’Œ <code>placement new</code> é¿å…åŠ¨æ€åˆ†é…å¼€é”€ã€‚</li><li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼šé€šè¿‡ç´¢å¼•è®¡ç®—å’Œè¾¹ç•Œæ£€æŸ¥ä¿è¯æ•°æ®è®¿é—®çš„æ­£ç¡®æ€§ã€‚</li></ul><div class=table-wrapper><table><thead><tr><th style=text-align:left>å˜é‡</th><th style=text-align:left>è¯´æ˜</th></tr></thead><tbody><tr><td style=text-align:left><code>past</code></td><td style=text-align:left>å¯è®¿é—®çš„â€œè¿‡å»â€æ—¶é—´æ­¥æ•°ï¼ˆè´Ÿæ•°ç´¢å¼•ï¼Œå¦‚ <code>-1</code> è¡¨ç¤ºä¸Šä¸€å‘¨æœŸï¼‰ã€‚</td></tr><tr><td style=text-align:left><code>future</code></td><td style=text-align:left>å¯è®¿é—®çš„â€œæœªæ¥â€æ—¶é—´æ­¥æ•°ï¼ˆæ­£æ•°ç´¢å¼•ï¼Œå¦‚ <code>+1</code> è¡¨ç¤ºä¸‹ä¸€å‘¨æœŸï¼‰ã€‚</td></tr><tr><td style=text-align:left><code>size</code></td><td style=text-align:left>ç¼“å†²åŒºæ€»å¤§å°ï¼ˆ<code>size = past + future + 1</code>ï¼‰ã€‚</td></tr><tr><td style=text-align:left><code>data</code></td><td style=text-align:left>é¢„åˆ†é…çš„å†…å­˜å—ï¼Œå­˜å‚¨æ‰€æœ‰æ•°æ®ï¼ˆæŒ‰ <code>sizeof(T)</code> å¯¹é½ï¼‰ã€‚</td></tr><tr><td style=text-align:left><code>index</code></td><td style=text-align:left>æŒ‡é’ˆæ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ æŒ‡å‘ <code>data</code> ä¸­ä¸€ä¸ªæ—¶é—´ç‚¹çš„æ•°æ®ã€‚</td></tr><tr><td style=text-align:left><code>base</code></td><td style=text-align:left>ç¯å½¢ç¼“å†²åŒºçš„å½“å‰åŸºå‡†ç´¢å¼•ï¼ˆéš <code>advance()</code> é€’å¢ï¼Œæ¨¡æ‹Ÿæ—¶é—´æ¨è¿›ï¼‰ã€‚</td></tr><tr><td style=text-align:left><code>_id</code></td><td style=text-align:left>å¯é€‰çš„ç¼“å†²åŒºæ ‡è¯†ç¬¦ï¼ˆç”¨äºè°ƒè¯•ï¼‰ã€‚</td></tr></tbody></table></div><blockquote><p>index[i] ä¿å­˜çš„æ˜¯æŒ‡é’ˆ ï¼Œ æˆ–è€…è¯´æ˜¯å†…å­˜ï¼Œæ˜¯åœ°å€ ï¼Œ æ‰€ä»¥æ“ä½œ new(index[ptr])Tæ˜¯ç›´æ¥åœ¨index[ptr]å¯¹åº”çš„åœ°å€ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡T ,åœ¨åˆ›å»ºä¸€ä¸ªtimebuffer çš„æ—¶å€™å°±åˆ†é…å¥½äº†è¿™ä¸€ç‰‡å†…å­˜</p></blockquote><p><figure class=gallery-image style=flex-grow:87;flex-basis:210px><a href=/2025/gem5_o3_learning/image-20250403201927705.png data-size=231x264><img src=/2025/gem5_o3_learning/image-20250403201927705.png width=231 height=264 srcset="/2025/gem5_o3_learning/image-20250403201927705_hu13499685319027115380.png 480w, /2025/gem5_o3_learning/image-20250403201927705_hu2202515542592325183.png 1024w" loading=lazy></a></figure></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span>    <span style=color:#e06c75>TimeBuffer</span>(<span style=color:#e5c07b>int</span> <span style=color:#e06c75>p</span>, <span style=color:#e5c07b>int</span> <span style=color:#e06c75>f</span>)
</span></span><span style=display:flex><span>        <span style=color:#56b6c2>:</span> <span style=color:#e06c75>past</span>(<span style=color:#e06c75>p</span>), <span style=color:#e06c75>future</span>(<span style=color:#e06c75>f</span>), <span style=color:#e06c75>size</span>(<span style=color:#e06c75>past</span> <span style=color:#56b6c2>+</span> <span style=color:#e06c75>future</span> <span style=color:#56b6c2>+</span> <span style=color:#d19a66>1</span>),
</span></span><span style=display:flex><span>          <span style=color:#e06c75>data</span>(<span style=color:#c678dd>new</span> <span style=color:#e5c07b>char</span>[<span style=color:#e06c75>size</span> <span style=color:#56b6c2>*</span> <span style=color:#c678dd>sizeof</span>(<span style=color:#e06c75>T</span>)]), <span style=color:#e06c75>index</span>(<span style=color:#e06c75>size</span>), <span style=color:#e06c75>base</span>(<span style=color:#d19a66>0</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#e06c75>assert</span>(<span style=color:#e06c75>past</span> <span style=color:#56b6c2>&gt;=</span> <span style=color:#d19a66>0</span> <span style=color:#56b6c2>&amp;&amp;</span> <span style=color:#e06c75>future</span> <span style=color:#56b6c2>&gt;=</span> <span style=color:#d19a66>0</span>);
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>char</span> <span style=color:#56b6c2>*</span><span style=color:#e06c75>ptr</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>data</span>; <span style=color:#7f848e>// å†…å­˜çš„é¦–åœ°å€ 
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>        <span style=color:#c678dd>for</span> (<span style=color:#e5c07b>unsigned</span> <span style=color:#e06c75>i</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>0</span>; <span style=color:#e06c75>i</span> <span style=color:#56b6c2>&lt;</span> <span style=color:#e06c75>size</span>; <span style=color:#e06c75>i</span><span style=color:#56b6c2>++</span>) {
</span></span><span style=display:flex><span>            <span style=color:#e06c75>index</span>[<span style=color:#e06c75>i</span>] <span style=color:#56b6c2>=</span> <span style=color:#e06c75>ptr</span>; 
</span></span><span style=display:flex><span>            <span style=color:#e06c75>std</span><span style=color:#56b6c2>::</span><span style=color:#e06c75>memset</span>(<span style=color:#e06c75>ptr</span>, <span style=color:#d19a66>0</span>, <span style=color:#c678dd>sizeof</span>(<span style=color:#e06c75>T</span>));
</span></span><span style=display:flex><span>            <span style=color:#c678dd>new</span> (<span style=color:#e06c75>ptr</span>) <span style=color:#e06c75>T</span>;
</span></span><span style=display:flex><span>            <span style=color:#e06c75>ptr</span> <span style=color:#56b6c2>+=</span> <span style=color:#c678dd>sizeof</span>(<span style=color:#e06c75>T</span>);  <span style=color:#7f848e>// æŒ‰ç…§Tçš„å¤§å°å»ºç«‹å¯¹è±¡ï¼Œå¹¶ä¸”èµ‹å€¼index[i] 
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#e06c75>_id</span> <span style=color:#56b6c2>=</span> <span style=color:#56b6c2>-</span><span style=color:#d19a66>1</span>;
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>æ³¨ï¼šæ­¤å¤„çš„å»¶è¿Ÿä¸æ‰“æ‹ç‰¹è´¨ipå†…éƒ¨çš„ç¡¬ä»¶è¡Œä¸ºï¼Œå…¸å‹çš„å¦‚é€šè¿‡ç§»ä½å¯„å­˜å™¨å®ç°Nä¸ªæ—¶é’Ÿçš„å»¶è¿Ÿï¼Œå¦‚fifoçš„ç¡¬ä»¶å®ç°ã€‚ï¼ˆæ¨¡å—é—´çš„å»¶è¿Ÿï¼Œåœ¨gem5ä¸­å¯ä»¥é€šè¿‡ <a class=link href="https://zhida.zhihu.com/search?content_id=232363274&amp;content_type=Article&amp;match_order=1&amp;q=event%e8%b0%83%e5%ba%a6%e6%9c%ba%e5%88%b6&amp;zd_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3NDM4NDUxNTMsInEiOiJldmVudOiwg-W6puacuuWItiIsInpoaWRhX3NvdXJjZSI6ImVudGl0eSIsImNvbnRlbnRfaWQiOjIzMjM2MzI3NCwiY29udGVudF90eXBlIjoiQXJ0aWNsZSIsIm1hdGNoX29yZGVyIjoxLCJ6ZF90b2tlbiI6bnVsbH0.beuQajf3pTcCnJqnteh--rAEmrAlw37yn9XE4RG9sHk&amp;zhida_source=entity" target=_blank rel=noopener>eventè°ƒåº¦æœºåˆ¶</a>(å‚è§ <a class=link href=https://zhuanlan.zhihu.com/p/587079919 target=_blank rel=noopener>gem5 æºç é˜…è¯» ä¹‹ event</a>)ï¼Œç›´æ¥è®¾ç½®è°ƒåº¦æ—¶é—´eventçš„åœ¨äº‹ä»¶é˜Ÿåˆ—ä¸Šçš„æ’å…¥æ—¶é—´ç‚¹æ¥æ¨¡æ‹Ÿï¼‰</p><h3 id=wire>wire</h3><p>wireæ˜¯å¯¹timebuffå…ƒç´ æŒ‡é’ˆçš„å°è£…ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ˆé€šè¿‡wireçš„æˆå‘˜å˜é‡ timerbuff* å’Œ å½“å‰wireåœ¨timerbuffä¸­çš„ä½ç½® ï¼šindex å®šä½ï¼‰é€šè¿‡wireçš„æˆå‘˜å˜é‡indexï¼ŒæŒ‡ç¤ºå½“å‰wireå–è‡ªtimebuffä¸­é‚£ä¸ªä½ç½®çš„å…ƒç´ ï¼Œç‰¹åˆ«çš„,indexä»¥å‚æ•°å½¢å¼ä¼ é€’ç»™timerbuffçš„accessæ–¹æ³•ï¼Œåœ¨å†…éƒ¨å®é™…è®¿é—®å…ƒç´ æ—¶ï¼Œæ˜¯ä¸€ä¸ªç›¸å¯¹ä½ç½®ï¼Œå³å°†è·å–ç›¸å¯¹äºbaseä½œä¸º0ä½ç½®ï¼Œåç§»indexçš„ä½ç½®çš„å…ƒç´ çš„å€¼</p><pre tabindex=0><code> T *operator-&gt;() const { return buffer-&gt;access(index); }
</code></pre><p>index ä»£è¡¨ä»è¿™ä¸ªæ•°æ®ç¼“å­˜é˜Ÿåˆ—ä¸­å®é™…å–æ•°çš„ç‚¹ï¼Œå¦‚æœindex=base-1 åˆ™ä»£è¡¨é€šè¿‡wireæ‹¿åˆ°çš„æ˜¯æ•°æ®å»¶è¿Ÿä¸€ä¸ªcycleçš„å€¼ï¼Œå¦‚æœindex=base+1åˆ™ä»£è¡¨é€šè¿‡wireé‚£åˆ°çš„æ•°æ®æ˜¯å½“å‰æ—¶é—´å‰ä¸€ä¸ªcycleçš„æ•°æ®</p><blockquote><p>index æ˜¯ä¸€ä¸ªåç§»å€¼</p></blockquote><p><figure class=gallery-image style=flex-grow:281;flex-basis:674px><a href=/2025/gem5_o3_learning/image-20250403194314969.png data-size=1057x376><img src=/2025/gem5_o3_learning/image-20250403194314969.png width=1057 height=376 srcset="/2025/gem5_o3_learning/image-20250403194314969_hu5177986229899195230.png 480w, /2025/gem5_o3_learning/image-20250403194314969_hu8329042262570232517.png 1024w" loading=lazy></a></figure></p><p><figure class=gallery-image style=flex-grow:111;flex-basis:267px><a href=/2025/gem5_o3_learning/v2-a7fbd423b30b21d3cc046cd0936617c7_1440w.jpg data-size=1004x900><img src=/2025/gem5_o3_learning/v2-a7fbd423b30b21d3cc046cd0936617c7_1440w.jpg width=1004 height=900 srcset="/2025/gem5_o3_learning/v2-a7fbd423b30b21d3cc046cd0936617c7_1440w_hu3094215347825233840.jpg 480w, /2025/gem5_o3_learning/v2-a7fbd423b30b21d3cc046cd0936617c7_1440w_hu8360682057680467044.jpg 1024w" loading=lazy></a></figure></p><p>å„ç§ç®—æ•°çš„é‡è½½éƒ½æ˜¯åœ¨æ›´æ–° buffer å’Œ index , åŒ…æ‹¬ = ï¼Œ + ï¼Œ - ï¼Œ ++ ï¼Œ &ndash; ï¼Œ+= ï¼Œ -= ï¼Œ -> , *</p><p>å…¶ä¸­ * å’Œ -></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#e06c75>T</span> <span style=color:#56b6c2>&amp;</span><span style=color:#c678dd>operator</span><span style=color:#56b6c2>*</span>() <span style=color:#c678dd>const</span> { <span style=color:#c678dd>return</span> <span style=color:#56b6c2>*</span><span style=color:#e06c75>buffer</span><span style=color:#56b6c2>-&gt;</span><span style=color:#e06c75>access</span>(<span style=color:#e06c75>index</span>); } <span style=color:#7f848e>//è¿”å› T 
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span><span style=color:#e06c75>T</span> <span style=color:#56b6c2>*</span><span style=color:#c678dd>operator</span><span style=color:#56b6c2>-&gt;</span>() <span style=color:#c678dd>const</span> { <span style=color:#c678dd>return</span> <span style=color:#e06c75>buffer</span><span style=color:#56b6c2>-&gt;</span><span style=color:#e06c75>access</span>(<span style=color:#e06c75>index</span>); } <span style=color:#7f848e>// è¿”å› T *  
</span></span></span><span style=display:flex><span><span style=color:#7f848e>//access è¿”å›çš„æ˜¯ T* ç±»å‹çš„ ï¼Œ è¿”å›çš„å°±æ˜¯ idx + base å¯¹åº”çš„ å†…å­˜ åœ°å€ ï¼Œ 
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span><span style=color:#e06c75>T</span> <span style=color:#56b6c2>*</span><span style=color:#61afef;font-weight:700>access</span>(<span style=color:#e5c07b>int</span> <span style=color:#e06c75>idx</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>int</span> <span style=color:#e06c75>vector_index</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>calculateVectorIndex</span>(<span style=color:#e06c75>idx</span>); <span style=color:#7f848e>// idx + base
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>
</span></span><span style=display:flex><span>        <span style=color:#c678dd>return</span> <span style=color:#c678dd>reinterpret_cast</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>T</span> <span style=color:#56b6c2>*&gt;</span>(<span style=color:#e06c75>index</span>[<span style=color:#e06c75>vector_index</span>]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span><span style=color:#7f848e>//
</span></span></span></code></pre></div><h3 id=advance>advance()</h3><p>advance() å‡½æ•°ï¼Œæ˜¯è´Ÿè´£timebuffæ—¶é—´æ¨è¿›çš„api, ä¸€èˆ¬æœ‰æŒæœ‰timebuffå¯¹è±¡çš„parentè´Ÿè´£è°ƒç”¨ï¼Œæ²¡è°ƒç”¨ä¸€æ¬¡ï¼Œä¸Šæ–‡æåˆ°çš„baseç´¢å¼•ï¼Œå‘æ•°æ®å¢å€¼çš„æ–¹å‘(futureæ–¹å‘)ç§»åŠ¨ä¸€ä¸ªå…ƒç´ çš„ä½ç½®ï¼Œ</p><p><figure class=gallery-image style=flex-grow:181;flex-basis:435px><a href=/2025/gem5_o3_learning/v2-f0954e5bf9842644ab7679e39f986ad7_1440w.jpg data-size=285x157><img src=/2025/gem5_o3_learning/v2-f0954e5bf9842644ab7679e39f986ad7_1440w.jpg width=285 height=157 srcset="/2025/gem5_o3_learning/v2-f0954e5bf9842644ab7679e39f986ad7_1440w_hu17772927455913905115.jpg 480w, /2025/gem5_o3_learning/v2-f0954e5bf9842644ab7679e39f986ad7_1440w_hu16655150562502060186.jpg 1024w" loading=lazy></a></figure></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#e5c07b>void</span>
</span></span><span style=display:flex><span>    <span style=color:#61afef;font-weight:700>advance</span>()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#7f848e>// æ¸…ç†â€œæœªæ¥â€æœ€è¿œçš„æ•°æ®ï¼ˆå› ä¸ºæ—¶é—´æ¨è¿›åå®ƒå˜æˆæ— æ•ˆæ•°æ®ï¼‰
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>        <span style=color:#c678dd>if</span> (<span style=color:#56b6c2>++</span><span style=color:#e06c75>base</span> <span style=color:#56b6c2>&gt;=</span> <span style=color:#e06c75>size</span>)
</span></span><span style=display:flex><span>            <span style=color:#e06c75>base</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#7f848e>// æ¨¡æ‹Ÿæ—¶é—´æ­¥è¿›ï¼Œæ›´æ–° base å¹¶æ¸…ç†è¿‡æœŸæ•°æ®ã€‚
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>        <span style=color:#e5c07b>int</span> <span style=color:#e06c75>ptr</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>base</span> <span style=color:#56b6c2>+</span> <span style=color:#e06c75>future</span>;
</span></span><span style=display:flex><span>        <span style=color:#c678dd>if</span> (<span style=color:#e06c75>ptr</span> <span style=color:#56b6c2>&gt;=</span> (<span style=color:#e5c07b>int</span>)<span style=color:#e06c75>size</span>)
</span></span><span style=display:flex><span>            <span style=color:#e06c75>ptr</span> <span style=color:#56b6c2>-=</span> <span style=color:#e06c75>size</span>;
</span></span><span style=display:flex><span>        (<span style=color:#c678dd>reinterpret_cast</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>T</span> <span style=color:#56b6c2>*&gt;</span>(<span style=color:#e06c75>index</span>[<span style=color:#e06c75>ptr</span>]))<span style=color:#56b6c2>-&gt;~</span><span style=color:#e06c75>T</span>();
</span></span><span style=display:flex><span>        <span style=color:#e06c75>std</span><span style=color:#56b6c2>::</span><span style=color:#e06c75>memset</span>(<span style=color:#e06c75>index</span>[<span style=color:#e06c75>ptr</span>], <span style=color:#d19a66>0</span>, <span style=color:#c678dd>sizeof</span>(<span style=color:#e06c75>T</span>));
</span></span><span style=display:flex><span>        <span style=color:#c678dd>new</span> (<span style=color:#e06c75>index</span>[<span style=color:#e06c75>ptr</span>]) <span style=color:#e06c75>T</span>; <span style=color:#7f848e>// åœ¨å·²ç»åˆ†é…çš„å†…å­˜ä¸Šç›´æ¥æ„é€ å¯¹è±¡
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    }
</span></span></code></pre></div><h3 id=wire-getwireint-idx>wire getWire(int idx)</h3><p>ä¸Šæ–‡å·²ç»è¯´è¿‡ wireç±»å‹æ˜¯å¯¹ timebuff æŸä¸€å…ƒç´ çš„å°è£…ï¼Œwireç±»å‹æ ¸å¿ƒæˆå‘˜å˜é‡åŒ…æ‹¬ æŒ‡å‘timebuffçš„æŒ‡é’ˆ å’Œ ç¡®å®šå…ƒç´ ä½ç½®çš„indexï¼Œä»è€Œä½¿ç”¨é€šè¿‡getWireå¾—åˆ°çš„wireå¯¹è±¡ï¼Œéƒ½æ˜¯æŒ‡å‘å½“å‰timebuffçš„æŸä¸€å…ƒç´ ï¼Œç‰¹åˆ«çš„ï¼Œæ­¤å…ƒç´ ä¹Ÿæ˜¯ç›¸å¯¹äºbaseåç§»indexçš„å…ƒç´ ï¼Œéšç€advanceçš„æ‰§è¡Œï¼ŒwireæŒ‡å‘çš„å…ƒç´ ä¹Ÿåœ¨ç§»åŠ¨ï¼Œä¸è®¾è®¡ç¡¬ä»¶ä¸­éšç€æ—¶é—´çš„æ¨ç§»ï¼Œç»Ÿä¸€å¯„å­˜å™¨æ‰¿è½½ä¸åŒçš„å€¼ å¼‚æ›²åŒå·¥ï¼Œä½†ä»è½¯ä»¶ç¼–ç¨‹è§’åº¦çœ‹ï¼Œç§»åŠ¨æ•°ç»„ç´¢å¼•çš„ä»£ä»·è¿œå°äºå°†æ•´ä¸ªæ•°ç»„æ—¶é—´å¹³ç§»è€Œä¿æŒç´¢å¼•ä¸å˜</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span>    <span style=color:#e06c75>wire</span> <span style=color:#61afef;font-weight:700>getWire</span>(<span style=color:#e5c07b>int</span> <span style=color:#e06c75>idx</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#e06c75>valid</span>(<span style=color:#e06c75>idx</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#c678dd>return</span> <span style=color:#e06c75>wire</span>(<span style=color:#c678dd>this</span>, <span style=color:#e06c75>idx</span>);
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>wire åŒ…æ‹¬ buffer å’Œ index ,</p><p>æ¯”æ–¹è¯´getWire(-1) , è¿”å›çš„æ˜¯ wire(this,-1)</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span>        <span style=color:#e06c75>TimeBuffer</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>T</span><span style=color:#56b6c2>&gt;</span> <span style=color:#56b6c2>*</span><span style=color:#e06c75>buffer</span>;
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>int</span> <span style=color:#e06c75>index</span>;
</span></span></code></pre></div><p><figure class=gallery-image style=flex-grow:259;flex-basis:623px><a href=/2025/gem5_o3_learning/v2-3e95487e41fc13905c3e2d59134612b2_1440w.jpg data-size=639x246><img src=/2025/gem5_o3_learning/v2-3e95487e41fc13905c3e2d59134612b2_1440w.jpg width=639 height=246 srcset="/2025/gem5_o3_learning/v2-3e95487e41fc13905c3e2d59134612b2_1440w_hu7665833910306396044.jpg 480w, /2025/gem5_o3_learning/v2-3e95487e41fc13905c3e2d59134612b2_1440w_hu14551924278376815349.jpg 1024w" loading=lazy alt=img></a><figcaption>img</figcaption></figure></p><h3 id=t-accessint-idx>T *access(int idx)</h3><p>access api åŸºæœ¬åªä¼šåœ¨wireä¸­è¢«è°ƒç”¨ï¼Œå½“éœ€è¦è·å–wireå¯¹è±¡çš„å€¼ï¼Œå³å…¶æŒ‡å‘çš„timebuffä¸­çš„å…ƒç´ çš„å€¼æ—¶ï¼Œä¼šé€šè¿‡timebuff::access æ–¹æ³•æ¥è·å–ï¼Œè¯¥æ–¹æ³•åšä¸¤ä»¶äº‹æƒ…ï¼š</p><ol><li>é€šè¿‡timebuff::calculateVectorIndex è®¡ç®—å…ƒç´ ä½ç½®ï¼šå› ä¸ºtimebuffçš„æ•°æ®ç»“æ„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œéœ€è¦é€šè¿‡è°ƒæ•´ç´¢å¼•ä½¿å…¶å…·æœ‰ringbufferçš„ç‰¹å¾ï¼Œä¸»è¦æ˜¯åœ¨æ¶‰åŠæ•°ç»„æ”¶å°¾æ—¶çš„ç´¢å¼•è°ƒæ•´</li><li>è¿”å›æ•°æ®å…ƒç´ ï¼šå‰æåˆ°timebuffå…·æœ‰ä¸€ä¸ªå…ƒç´ ç±»å‹çš„æ¨¡æ¿å‚æ•°ï¼Œè€Œtimebuffçš„æ•°æ®æ˜¯charå‹æ•°ç»„ï¼Œéœ€è¦æ ¹æ®å…ƒç´ ç±»å‹å’Œå ç”¨ç©ºé—´å¤§å°ï¼Œè¿”å›å¯¹åº”å­˜å‚¨ä½ç½®ä¸Šçš„æ•°æ®</li></ol><p>access è¿”å›çš„æ˜¯ T* ç±»å‹çš„ ï¼Œ è¿”å›çš„å°±æ˜¯ idx + base å¯¹åº”çš„ å†…å­˜ åœ°å€ ï¼Œ</p><h3 id=timebuff-å»¶è¿Ÿæ¨¡å‹>TimeBuff å»¶è¿Ÿæ¨¡å‹</h3><p>é€šè¿‡å‰é¢çš„æè¿°ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“äº†å¦‚ä½•ä½¿ç”¨native C++å®ç°ä¸€ä¸ªç§»ä½å¯„å­˜å™¨ï¼Œè¿›è€Œå¯ä»¥å®ç°ç¡¬ä»¶ç”µè·¯ä¸­çš„å»¶è¿Ÿè¡Œä¸ºï¼Œå› ä¸ºæ—¶åºç”µè·¯çš„æ ¸å¿ƒç‰¹ç‚¹ä¹‹ä¸€å°±æ˜¯â€œå¯„å­˜â€</p><p>cpuçš„æµæ°´çº¿ä¸­ï¼Œå„ä¸ªstageæ˜¯ä¸€ä¸ªæ¯”è¾ƒç´§è€¦åˆçš„çŠ¶æ€ï¼Œå„stageçš„é—´çš„äº¤äº’ä¿¡å·ä¹Ÿæ¯”è¾ƒå¤šï¼Œå¹¶ä¸”ä¼šæ¶‰åŠåˆ°å¾ˆå¤šä¿¡å·çš„å‰å‘ä¼ æ’­å’Œåé¡¹ä¼ æ’­:</p><ol><li>å…¸å‹çš„å‰å‘ä¼ æ’­ä¾‹å¦‚fetchå–å€¼åï¼Œä¼ é€’ç»™ä¸‹ä¸€çº§decoder, å…¶è¡Œä¸ºå¯æŠ½è±¡æˆç§»ä½å¯„å­˜å™¨ï¼Œ</li><li>å…¸å‹çš„åå‘ä¼ æ’­ä¾‹å¦‚åˆ†æ”¯æŒ‡ä»¤çš„æ‰§è¡Œç»“æœä¼ é€’åˆ°å‰çº§fetchå•å…ƒï¼Œä¸€è¾¹æ›´æ–°æ›´æ–°é¢„æµ‹æœŸï¼Œä¿®æ­£å–å€¼PC</li></ol><p>åå‘ä¼ æ’­è¡Œä¸ºï¼Œæœ¬è´¨ä¸Šå¯ä»¥æŠ½è±¡ä¸ºä¸€ä¸ªç§»ä½å¯„å­˜å™¨ï¼Œä¸¾ä¾‹æ¥è¯´ï¼Œfetchå•å…ƒæ‹¿åˆ°äº†æ‰§è¡Œé˜¶æ®µçš„åˆ†æ”¯æŒ‡ä»¤çš„æ‰§è¡Œç»“æœï¼Œå¯ä»¥æ˜¯æ‰§è¡Œé˜¶æ®µå½“å‰æ—¶åˆ»æˆ–æ˜¯å»¶è¿ŸNä¸ªcycleçš„å€¼ã€‚</p><p>å› è€Œåœ¨gem5çš„<a class=link href="https://zhida.zhihu.com/search?content_id=232363274&amp;content_type=Article&amp;match_order=1&amp;q=O3%e5%a4%84%e7%90%86%e5%99%a8&amp;zd_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3NDM4NDUxNTMsInEiOiJPM-WkhOeQhuWZqCIsInpoaWRhX3NvdXJjZSI6ImVudGl0eSIsImNvbnRlbnRfaWQiOjIzMjM2MzI3NCwiY29udGVudF90eXBlIjoiQXJ0aWNsZSIsIm1hdGNoX29yZGVyIjoxLCJ6ZF90b2tlbiI6bnVsbH0.vwcoJie_Mr6G_ntxgi1JjL0CvSRVZ8itWqNubf6fTXs&amp;zhida_source=entity" target=_blank rel=noopener>O3å¤„ç†å™¨</a>ä¸­ï¼Œå°±åˆ†åˆ«å®šäº†äº†å„stageé—´çš„å‰å‘ä¼ æ’­timebffä¸åé¡¹ä¼ æ’­timebuff, å…¶ä¸­ï¼Œtimebuffä½œä¸ºå®¹å™¨ï¼Œå…¶æ‰¿è½½çš„æ•°æ®å…ƒç´ ä¸ºå„stageéœ€è¦ä¼ æ’­çš„æ‰€æœ‰æ•°æ®çš„ç»“æ„ä½“ç±»å‹ã€</p><p>åœ¨gem5ä¸­ï¼ŒcpuåŠŸèƒ½çš„å®ç°ï¼Œå› ä¸ºtimebuffçš„å­˜åœ¨ï¼Œåˆ’åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œ <strong>åŠŸèƒ½å®ç°å’Œå»¶è¿Ÿæ¨¡å‹</strong>ï¼Œå…¶ä¸­åŠŸèƒ½å®ç°å®Œæˆæ¯ä¸ªstageçš„åŠŸèƒ½é€»è¾‘å¹¶ç”Ÿäº§æ•°æ®ï¼Œæ¯”å¦‚decderå®ŒæˆæŒ‡ä»¤çš„è§£ç ï¼Œè€Œå»¶è¿Ÿæ¨¡å‹å•çº¯è´Ÿè´£å®ç°çš„å¤„ç†ï¼Œå°†åŠŸèƒ½å®ç°ä¸­äº§ç”Ÿçš„æ•°æ®æ”¾å…¥timebuff,å†æœ‰åçº§é€šè¿‡ wireç±»å‹(å‚è§å‰é¢ç« èŠ‚) è·å–å¯¹åº”å»¶è¿Ÿå‘¨æœŸçš„æ•°æ®ã€‚</p><p><figure class=gallery-image style=flex-grow:412;flex-basis:990px><a href=/2025/gem5_o3_learning/v2-d972d73b0ebc059dcf40f0acb091f4a7_1440w.jpg data-size=1090x264><img src=/2025/gem5_o3_learning/v2-d972d73b0ebc059dcf40f0acb091f4a7_1440w.jpg width=1090 height=264 srcset="/2025/gem5_o3_learning/v2-d972d73b0ebc059dcf40f0acb091f4a7_1440w_hu13207120455469315893.jpg 480w, /2025/gem5_o3_learning/v2-d972d73b0ebc059dcf40f0acb091f4a7_1440w_hu6137225920010514055.jpg 1024w" loading=lazy alt=img></a><figcaption>img</figcaption></figure></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#7f848e>// åœ¨cpuåˆå§‹åŒ–çš„æ—¶å€™è°ƒç”¨setQueueåŒæ­¥äº†ä¸åŒmoduleçš„queue 
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#e06c75>fetch</span>.<span style=color:#e06c75>setFetchQueue</span>(<span style=color:#56b6c2>&amp;</span><span style=color:#e06c75>fetchQueue</span>);
</span></span><span style=display:flex><span>    <span style=color:#e06c75>decode</span>.<span style=color:#e06c75>setFetchQueue</span>(<span style=color:#56b6c2>&amp;</span><span style=color:#e06c75>fetchQueue</span>);
</span></span><span style=display:flex><span>    <span style=color:#e06c75>commit</span>.<span style=color:#e06c75>setFetchQueue</span>(<span style=color:#56b6c2>&amp;</span><span style=color:#e06c75>fetchQueue</span>);
</span></span><span style=display:flex><span>    <span style=color:#e06c75>decode</span>.<span style=color:#e06c75>setDecodeQueue</span>(<span style=color:#56b6c2>&amp;</span><span style=color:#e06c75>decodeQueue</span>);
</span></span><span style=display:flex><span>    <span style=color:#e06c75>rename</span>.<span style=color:#e06c75>setDecodeQueue</span>(<span style=color:#56b6c2>&amp;</span><span style=color:#e06c75>decodeQueue</span>);
</span></span><span style=display:flex><span>    <span style=color:#e06c75>rename</span>.<span style=color:#e06c75>setRenameQueue</span>(<span style=color:#56b6c2>&amp;</span><span style=color:#e06c75>renameQueue</span>);
</span></span><span style=display:flex><span>    <span style=color:#e06c75>iew</span>.<span style=color:#e06c75>setRenameQueue</span>(<span style=color:#56b6c2>&amp;</span><span style=color:#e06c75>renameQueue</span>);
</span></span><span style=display:flex><span>    <span style=color:#e06c75>iew</span>.<span style=color:#e06c75>setIEWQueue</span>(<span style=color:#56b6c2>&amp;</span><span style=color:#e06c75>iewQueue</span>);
</span></span><span style=display:flex><span>    <span style=color:#e06c75>commit</span>.<span style=color:#e06c75>setIEWQueue</span>(<span style=color:#56b6c2>&amp;</span><span style=color:#e06c75>iewQueue</span>);
</span></span><span style=display:flex><span>    <span style=color:#e06c75>commit</span>.<span style=color:#e06c75>setRenameQueue</span>(<span style=color:#56b6c2>&amp;</span><span style=color:#e06c75>renameQueue</span>);
</span></span><span style=display:flex><span><span style=color:#e5c07b>void</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>Commit</span><span style=color:#56b6c2>::</span><span style=color:#e06c75>setFetchQueue</span>(<span style=color:#e06c75>TimeBuffer</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>FetchStruct</span><span style=color:#56b6c2>&gt;</span> <span style=color:#56b6c2>*</span><span style=color:#e06c75>fq_ptr</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#e06c75>fetchQueue</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>fq_ptr</span>;
</span></span><span style=display:flex><span>    <span style=color:#7f848e>// æ­¤æ—¶æ˜¯å·²ç»å¯¹fromFetch ä¹‹ç±»çš„å€¼ æŒ‰ç…§ å»¶æ—¶ getWire äº† ï¼Œ 
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#7f848e>// æ¯”æ–¹è¯´fromFetch å¾—åˆ°çš„å°±æ˜¯ (*TimeBuffer, -1) , å³ index æ˜¯ -1 ï¼Œ timebufer æˆåŠŸè¿æ¥ä¸Šäº†cpu æ€»ä½“çš„timebuff 
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#7f848e>// Setup wire to get instructions from rename (for the ROB).
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#7f848e>// buffer çš„èµ‹å€¼è¿˜æ˜¯åŒä¸€ä¸ªbuffer , ä¸»è¦å°±æ˜¯indexè¿›è¡Œäº†æ”¹å˜ 
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#e06c75>fromFetch</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>fetchQueue</span><span style=color:#56b6c2>-&gt;</span><span style=color:#e06c75>getWire</span>(<span style=color:#56b6c2>-</span><span style=color:#e06c75>fetchToCommitDelay</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#7f848e>// åœ¨setä¹‹åï¼Œåç»­çš„æ“ä½œå°±æ˜¯è°ƒç”¨advance , åœ¨advance çš„æ—¶å€™ï¼Œä¸»è¦æ˜¯base åœ¨å¢åŠ  
</span></span></span><span style=display:flex><span><span style=color:#7f848e>// å› ä¸ºéƒ½æ˜¯æŒ‡é’ˆçš„è¿ç®— ï¼Œ fromFetché‡Œé¢æ˜¯ä¸€ä¸ªTimeBufferçš„æŒ‡é’ˆï¼ŒæŒ‡å‘cpuçš„é‚£è¾¹TimeBuffer , åœ¨åç»­è®¿é—®FromFetch çš„æ—¶å€™ï¼Œéƒ½æ˜¯é€šè¿‡accessæ¥è®¿é—® ï¼Œ å³é€šè¿‡base å’Œ index è®¡ç®—å‡ºéœ€è¦å–çš„æ•°æ®çš„åœ°å€ï¼Œç„¶åå»å– 
</span></span></span></code></pre></div><blockquote><p>è¿™æ ·åªè¦åœ¨åˆå§‹çš„æ—¶å€™ç¡®å®šå¥½ index ï¼Œ å°±èƒ½ç‹—ç¨³å®šå–å‡ºå½“å‰æ—¶é—´è½´çš„å‰é¢æˆ–è€…åé¢çš„æ•°æ®äº†</p></blockquote><h2 id=gem5-event>gem5 event</h2><h3 id=role>role</h3><p>gem5æ˜¯ä¸€ä¸ªevent-drivenç±»å‹çš„ä»¿çœŸå™¨ï¼Œä»è€Œå¯ä»¥æ›´é«˜æ•ˆçš„å¤„ç†æ¯ä¸ªâ€œåŠ¨ä½œ/å“åº”â€ï¼Œè€Œä¸éœ€è¦è½®è¯¢å…¨å±€æ—¶é—´ï¼Œåˆ¤æ–­eventæ˜¯å¦è¯¥è¢«æ‰§è¡Œäº†ï¼Œä»è€Œå‡å°‘äº†å¤§é‡çš„æ‰§è¡Œæ—¶é—´.</p><p>Gem5ä¸­çš„åŸºç¡€class <a class=link href="https://zhida.zhihu.com/search?content_id=218596916&amp;content_type=Article&amp;match_order=1&amp;q=SimObject&amp;zd_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3NDQxNjUyMzQsInEiOiJTaW1PYmplY3QiLCJ6aGlkYV9zb3VyY2UiOiJlbnRpdHkiLCJjb250ZW50X2lkIjoyMTg1OTY5MTYsImNvbnRlbnRfdHlwZSI6IkFydGljbGUiLCJtYXRjaF9vcmRlciI6MSwiemRfdG9rZW4iOm51bGx9.pc6Lo1rC1NmnL6G2OzxHE8DME6lPG0I8NE6q7FQardQ&amp;zhida_source=entity" target=_blank rel=noopener>SimObject</a> å°±ç»§æ‰¿è‡ªEventManager, å› è€Œæ¯ä¸ªæœ‰SimObjectæ´¾ç”Ÿè€Œæ¥çš„å¯¹è±¡ï¼Œéƒ½å¯ä»¥æ‰¿æ‹…EventManagerçš„èŒè´£ï¼Œç‰¹åˆ«çš„ï¼ŒSimObjectå°†æŒæœ‰ï¼š</p><ol><li>ä¸€ä¸ªEventQueueå¯¹è±¡çš„æŒ‡é’ˆï¼ŒæŒ‡å‘ä¸€ä¸ªå…¨å±€EventQueueï¼ˆå‚è§<em><strong>Event tree</strong></em>ï¼‰</li><li>Schedule æ–¹æ³•</li></ol><p>å…¶ä¸­schduleæ–¹æ³•å°†å¯¹è±¡çš„Eventæ’åºæ’å…¥åˆ°å…¨å±€EventQueueä¸­ï¼Œè€Œè¿™å°±æ˜¯åˆ›å»ºå…¨å±€Event treeçš„è¿‡ç¨‹ï¼Œå‚è§<em><strong>Event tree</strong></em>ã€‚</p><h3 id=event-queue>Event Queue</h3><p>eventçš„æ‰§è¡Œåˆæ˜¯åŸºäºwhen+priorityå€¼æ’åºçš„ï¼Œé€šè¿‡ EventManager.schedule &mdash;> EventQueue.schedule æœ€ç»ˆå°†æŸä¸ªEventæ’åºå¹¶æ’å…¥åˆ°EventQueueä¸­ï¼Œè€ŒEventQueue åœ¨gem5ä¸­æ˜¯å…¨å±€å˜é‡ï¼Œæ‰€æœ‰simObjectçš„Eventæœ€ç»ˆéƒ½å°†è¢«æ³¨å†Œåˆ°è¿™å‡ ä¸ªqueueä¸­çš„æŸä¸€ä¸ª</p><p>æœªå®Œ</p><h2 id=o3-æµæ°´çº¿çš„è¯¦ç»†åˆ†æ>o3 æµæ°´çº¿çš„è¯¦ç»†åˆ†æ</h2><h3 id=ä»¥æŸä¸€æ¡æŒ‡ä»¤ä¸ºä¾‹å­>ä»¥æŸä¸€æ¡æŒ‡ä»¤ä¸ºä¾‹å­</h3><p>å¯ä»¥çœ‹å‡ºæ¥æ˜¯8å‘å°„çš„</p><p><figure class=gallery-image style=flex-grow:282;flex-basis:678px><a href=/2025/gem5_o3_learning/image-20250413002549372.png data-size=1193x422><img src=/2025/gem5_o3_learning/image-20250413002549372.png width=1193 height=422 srcset="/2025/gem5_o3_learning/image-20250413002549372_hu11228186284351161241.png 480w, /2025/gem5_o3_learning/image-20250413002549372_hu14795775061635398957.png 1024w" loading=lazy></a></figure></p><p>ä»¥è¿™æ¡c_liä¸ºä¾‹å­ï¼Œ 500ä½œä¸ºå•ä½ç²’åº¦</p><p><figure class=gallery-image style=flex-grow:474;flex-basis:1137px><a href=/2025/gem5_o3_learning/image-20250413002621824.png data-size=640x135><img src=/2025/gem5_o3_learning/image-20250413002621824.png width=640 height=135 srcset="/2025/gem5_o3_learning/image-20250413002621824_hu9230471427412902551.png 480w, /2025/gem5_o3_learning/image-20250413002621824_hu941025651433306006.png 1024w" loading=lazy alt=image-20250413002621824></a><figcaption>image-20250413002621824</figcaption></figure></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span> 135000: system.cpu.decoder: Requesting bytes 0x433db525 from address 0x10928
</span></span><span style=display:flex><span> 135000: system.cpu.decoder: Decoding instruction 0x0000433d at address 0x1092a
</span></span><span style=display:flex><span> 135000: global: DynInst: <span style=color:#56b6c2>[</span>sn:13<span style=color:#56b6c2>]</span> Instruction created. Instcount <span style=color:#c678dd>for</span> system.cpu <span style=color:#56b6c2>=</span> <span style=color:#d19a66>1</span>
</span></span><span style=display:flex><span> 135000: system.cpu.fetch: <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> Instruction PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x1092a</span><span style=color:#56b6c2>=</span>&gt;0x1092c<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span> created <span style=color:#56b6c2>[</span>sn:13<span style=color:#56b6c2>]</span>.
</span></span><span style=display:flex><span> 135000: system.cpu.fetch: <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> Instruction is: c_li t1, <span style=color:#d19a66>15</span>
</span></span><span style=display:flex><span> 135000: system.cpu.fetch: <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> Fetch queue entry created <span style=color:#56b6c2>(</span>1/32<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> 135500: system.cpu.decode: <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> Sending instruction to rename.
</span></span><span style=display:flex><span> 135500: system.cpu.decode: <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> Processing instruction <span style=color:#56b6c2>[</span>sn:13<span style=color:#56b6c2>]</span> with PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x1092a</span><span style=color:#56b6c2>=</span>&gt;0x1092c<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> 136000: system.cpu.rename: <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> Sending instructions to IEW.
</span></span><span style=display:flex><span> 136000: system.cpu.rename: <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> Processing instruction <span style=color:#56b6c2>[</span>sn:13<span style=color:#56b6c2>]</span> with PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x1092a</span><span style=color:#56b6c2>=</span>&gt;0x1092c<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span> 136000: global: Renamed reg integer<span style=color:#56b6c2>[</span>6<span style=color:#56b6c2>]</span> to physical reg <span style=color:#d19a66>41</span> <span style=color:#56b6c2>(</span>41<span style=color:#56b6c2>)</span> old mapping was <span style=color:#d19a66>6</span> <span style=color:#56b6c2>(</span>6<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span> 136000: system.cpu.rename: <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> Renaming arch reg <span style=color:#d19a66>6</span> <span style=color:#56b6c2>(</span>integer<span style=color:#56b6c2>)</span> to physical reg <span style=color:#d19a66>41</span> <span style=color:#56b6c2>(</span>41<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span> 136000: system.cpu.rename: <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> <span style=color:#56b6c2>[</span>sn:13<span style=color:#56b6c2>]</span> Adding instruction to <span style=color:#e5c07b>history</span> buffer <span style=color:#56b6c2>(</span><span style=color:#e06c75>size</span><span style=color:#56b6c2>=</span>1<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> 136500: system.cpu.commit: Getting instructions from Rename stage.
</span></span><span style=display:flex><span> 136500: system.cpu.commit: <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> <span style=color:#56b6c2>[</span>sn:13<span style=color:#56b6c2>]</span> Inserting PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x1092a</span><span style=color:#56b6c2>=</span>&gt;0x1092c<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span> into ROB.
</span></span><span style=display:flex><span> 136500: system.cpu.rob: Adding inst PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x1092a</span><span style=color:#56b6c2>=</span>&gt;0x1092c<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span> to the ROB.
</span></span><span style=display:flex><span> 136500: system.cpu.rob: <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> Now has <span style=color:#d19a66>1</span> instructions.
</span></span><span style=display:flex><span> 136500: system.cpu.commit: Trying to commit instructions in the ROB.
</span></span><span style=display:flex><span> 136500: system.cpu.commit: <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> Can<span style=color:#98c379>&#39;t commit, Instruction [sn:13] PC (0x1092a=&gt;0x1092c).(0=&gt;1) is head of ROB and not ready
</span></span></span><span style=display:flex><span><span style=color:#98c379>
</span></span></span><span style=display:flex><span><span style=color:#98c379> 137000: system.cpu.iew: Issue: Processing [tid:0]
</span></span></span><span style=display:flex><span><span style=color:#98c379> 137000: system.cpu.iew: [tid:0] Not blocked, so attempting to run dispatch.
</span></span></span><span style=display:flex><span><span style=color:#98c379> 137000: system.cpu.iew: [tid:0] Issue: Adding PC (0x1092a=&gt;0x1092c).(0=&gt;1) [sn:13] [tid:0] to IQ. ## dispatch inst 
</span></span></span><span style=display:flex><span><span style=color:#98c379> 137000: system.cpu.iq: Adding instruction [sn:13] PC (0x1092a=&gt;0x1092c).(0=&gt;1) to the IQ. # instruction_queue.insert() inst_queue.cc 
</span></span></span><span style=display:flex><span><span style=color:#98c379>  137000: system.cpu.iq: Instruction is ready to issue, putting it onto the ready list, PC (0x1092a=&gt;0x1092c).(0=&gt;1) opclass:1 [sn:13]. ## åœ¨instruction_queu.insert()ä¸­å¦‚æœä¸æ˜¯è®¿å­˜æŒ‡ä»¤ä¼šæ‰§è¡ŒaddIFReady , åˆ¤æ–­æŒ‡ä»¤æ˜¯å¦ready to issue ,æ˜¯çš„è¯ä¼šåŠ å…¥readyInsts 
</span></span></span><span style=display:flex><span><span style=color:#98c379> 137000: system.cpu.iq: Thread 0: Issuing instruction PC (0x1092a=&gt;0x1092c).(0=&gt;1) [sn:13] # InstructionQueue::scheduleReadyInsts() inst_queue.cc , é€‰å–readyInstsä¸­çš„insts issue  
</span></span></span><span style=display:flex><span><span style=color:#98c379> 137000: system.cpu.commit: [tid:0] Can&#39;</span>t commit, Instruction <span style=color:#56b6c2>[</span>sn:13<span style=color:#56b6c2>]</span> PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x1092a</span><span style=color:#56b6c2>=</span>&gt;0x1092c<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span> is head of ROB and not ready
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> 137500: system.cpu.iew: Execute: Executing instructions from IQ.## è¿™é‡Œå°±æ˜¯executeinstä¸­çš„æŒ‡ä»¤ä¼šè¢«æ‰§è¡Œ 
</span></span><span style=display:flex><span> 137500: system.cpu.iew: Execute: Processing PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x1092a</span><span style=color:#56b6c2>=</span>&gt;0x1092c<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span>, <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> <span style=color:#56b6c2>[</span>sn:13<span style=color:#56b6c2>]</span>.
</span></span><span style=display:flex><span> 137500: global: RegFile: Setting int register <span style=color:#d19a66>41</span> to 0xf  <span style=color:#7f848e>## è°ƒç”¨inst-&gt;execute æ‰§è¡ŒæŒ‡ä»¤ </span>
</span></span><span style=display:flex><span> 137500: system.cpu.iew: Sending instructions to commit, <span style=color:#56b6c2>[</span>sn:13<span style=color:#56b6c2>]</span> PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x1092a</span><span style=color:#56b6c2>=</span>&gt;0x1092c<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span>. <span style=color:#7f848e>## writebackInsts() </span>
</span></span><span style=display:flex><span> 137500: system.cpu.iq: Waking dependents of completed instruction.
</span></span><span style=display:flex><span> 137500: system.cpu.iq: Waking any dependents on register <span style=color:#d19a66>41</span> <span style=color:#56b6c2>(</span>integer<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span> 137500: system.cpu.iq: Waking up a dependent instruction, <span style=color:#56b6c2>[</span>sn:15<span style=color:#56b6c2>]</span> PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x1092e</span><span style=color:#56b6c2>=</span>&gt;0x10932<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span> 137500: system.cpu.commit: <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> Can&#39;t commit, Instruction <span style=color:#56b6c2>[</span>sn:13<span style=color:#56b6c2>]</span> PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x1092a</span><span style=color:#56b6c2>=</span>&gt;0x1092c<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span> is head of ROB and not ready
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> 138000: system.cpu.commit: <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> Marking PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x1092a</span><span style=color:#56b6c2>=</span>&gt;0x1092c<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span>, <span style=color:#56b6c2>[</span>sn:13<span style=color:#56b6c2>]</span> ready within ROB.
</span></span><span style=display:flex><span> 138000: system.cpu.commit: <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> Instruction <span style=color:#56b6c2>[</span>sn:13<span style=color:#56b6c2>]</span> PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x1092a</span><span style=color:#56b6c2>=</span>&gt;0x1092c<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span> is head of ROB and ready to commit
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> 138500: system.cpu.commit: <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> <span style=color:#56b6c2>[</span>sn:13<span style=color:#56b6c2>]</span> Committing instruction with PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x1092a</span><span style=color:#56b6c2>=</span>&gt;0x1092c<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span> 138500: system.cpu.rob: <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> Retiring head instruction, instruction PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x1092a</span><span style=color:#56b6c2>=</span>&gt;0x1092c<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span>, <span style=color:#56b6c2>[</span>sn:13<span style=color:#56b6c2>]</span>
</span></span><span style=display:flex><span> 138500: system.cpu: Removing committed instruction <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x1092a</span><span style=color:#56b6c2>=</span>&gt;0x1092c<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span> <span style=color:#56b6c2>[</span>sn:13<span style=color:#56b6c2>]</span>
</span></span><span style=display:flex><span> 138500: system.cpu: Removing instruction, <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> <span style=color:#56b6c2>[</span>sn:13<span style=color:#56b6c2>]</span> PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x1092a</span><span style=color:#56b6c2>=</span>&gt;0x1092c<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span>
</span></span></code></pre></div><p>å†æ‰¾ä¸€æ¡addi</p><p><figure class=gallery-image style=flex-grow:453;flex-basis:1088px><a href=/2025/gem5_o3_learning/image-20250413151104704.png data-size=608x134><img src=/2025/gem5_o3_learning/image-20250413151104704.png width=608 height=134 srcset="/2025/gem5_o3_learning/image-20250413151104704_hu8381175566214838772.png 480w, /2025/gem5_o3_learning/image-20250413151104704_hu18106490195205124056.png 1024w" loading=lazy></a></figure></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span> 135000: system.cpu.decoder: Decoding instruction 0x00f77793 at address 0x10932
</span></span><span style=display:flex><span> 135000: system.cpu.decoder: Decode: Decoded andi instruction: 0x5000010000f77793
</span></span><span style=display:flex><span> 135000: global: DynInst: <span style=color:#56b6c2>[</span>sn:16<span style=color:#56b6c2>]</span> Instruction created. Instcount <span style=color:#c678dd>for</span> system.cpu <span style=color:#56b6c2>=</span> <span style=color:#d19a66>4</span>
</span></span><span style=display:flex><span> 135000: system.cpu.fetch: <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> Instruction PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x10932</span><span style=color:#56b6c2>=</span>&gt;0x10936<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span> created <span style=color:#56b6c2>[</span>sn:16<span style=color:#56b6c2>]</span>.
</span></span><span style=display:flex><span> 135000: system.cpu.fetch: <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> Instruction is: andi a5, a4, <span style=color:#d19a66>15</span>
</span></span><span style=display:flex><span> 135000: system.cpu.fetch: <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> Fetch queue entry created <span style=color:#56b6c2>(</span>4/32<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> 135500: system.cpu.decode: <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> Sending instruction to rename.
</span></span><span style=display:flex><span> 135500: system.cpu.decode: <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> Processing instruction <span style=color:#56b6c2>[</span>sn:16<span style=color:#56b6c2>]</span> with PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x10932</span><span style=color:#56b6c2>=</span>&gt;0x10936<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> 136000: system.cpu.rename: <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> Sending instructions to IEW.
</span></span><span style=display:flex><span> 136000: system.cpu.rename: <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> Processing instruction <span style=color:#56b6c2>[</span>sn:16<span style=color:#56b6c2>]</span> with PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x10932</span><span style=color:#56b6c2>=</span>&gt;0x10936<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span> 136000: system.cpu.rename: <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> Looking up integer arch reg 14, got phys reg <span style=color:#d19a66>42</span> <span style=color:#56b6c2>(</span>integer<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span> 136000: system.cpu.rename: <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> Register <span style=color:#d19a66>42</span> <span style=color:#56b6c2>(</span>flat: 42<span style=color:#56b6c2>)</span> <span style=color:#56b6c2>(</span>integer<span style=color:#56b6c2>)</span> is not ready.
</span></span><span style=display:flex><span> 136000: global: Renamed reg integer<span style=color:#56b6c2>[</span>15<span style=color:#56b6c2>]</span> to physical reg <span style=color:#d19a66>43</span> <span style=color:#56b6c2>(</span>43<span style=color:#56b6c2>)</span> old mapping was <span style=color:#d19a66>15</span> <span style=color:#56b6c2>(</span>15<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span> 136000: system.cpu.rename: <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> Renaming arch reg <span style=color:#d19a66>15</span> <span style=color:#56b6c2>(</span>integer<span style=color:#56b6c2>)</span> to physical reg <span style=color:#d19a66>43</span> <span style=color:#56b6c2>(</span>43<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span> 136000: system.cpu.rename: <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> <span style=color:#56b6c2>[</span>sn:16<span style=color:#56b6c2>]</span> Adding instruction to <span style=color:#e5c07b>history</span> buffer <span style=color:#56b6c2>(</span><span style=color:#e06c75>size</span><span style=color:#56b6c2>=</span>3<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> 136500: system.cpu.commit: <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> <span style=color:#56b6c2>[</span>sn:16<span style=color:#56b6c2>]</span> Inserting PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x10932</span><span style=color:#56b6c2>=</span>&gt;0x10936<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span> into ROB.  // getinst<span style=color:#56b6c2>()</span> from commit.cc 
</span></span><span style=display:flex><span> 136500: system.cpu.rob: Adding inst PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x10932</span><span style=color:#56b6c2>=</span>&gt;0x10936<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span> to the ROB. // insertinst<span style=color:#56b6c2>()</span> rob.cc 
</span></span><span style=display:flex><span> 136500: system.cpu.rob: <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> Now has <span style=color:#d19a66>4</span> instructions.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> 137000: system.cpu.iew: <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> Issue: Adding PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x10932</span><span style=color:#56b6c2>=</span>&gt;0x10936<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span> <span style=color:#56b6c2>[</span>sn:16<span style=color:#56b6c2>]</span> <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> to IQ. // dispatch 
</span></span><span style=display:flex><span> 137000: system.cpu.iq: Adding instruction <span style=color:#56b6c2>[</span>sn:16<span style=color:#56b6c2>]</span> PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x10932</span><span style=color:#56b6c2>=</span>&gt;0x10936<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span> to the IQ.
</span></span><span style=display:flex><span> 137000: system.cpu.iq: Instruction PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x10932</span><span style=color:#56b6c2>=</span>&gt;0x10936<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span> has src reg <span style=color:#d19a66>42</span> <span style=color:#56b6c2>(</span>integer<span style=color:#56b6c2>)</span> that is being added to the dependency chain. <span style=color:#7f848e># è¿™é‡Œä½“æ ¡äº†å’Œå‰é¢çš„ä¸åŒï¼Œå‰é¢ç›´æ¥å‘å°„äº† </span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> 137500: system.cpu.iew: Sending instructions to commit, <span style=color:#56b6c2>[</span>sn:13<span style=color:#56b6c2>]</span> PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x1092a</span><span style=color:#56b6c2>=</span>&gt;0x1092c<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span> 137500: system.cpu.iq: Waking dependents of completed instruction.
</span></span><span style=display:flex><span> 137500: system.cpu.iq: Waking any dependents on register <span style=color:#d19a66>41</span> <span style=color:#56b6c2>(</span>integer<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span> 137500: system.cpu.iq: Waking up a dependent instruction, <span style=color:#56b6c2>[</span>sn:15<span style=color:#56b6c2>]</span> PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x1092e</span><span style=color:#56b6c2>=</span>&gt;0x10932<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span> 137500: system.cpu.iq: Instruction is ready to issue, putting it onto the ready list, PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x1092e</span><span style=color:#56b6c2>=</span>&gt;0x10932<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span> opclass:1 <span style=color:#56b6c2>[</span>sn:15<span style=color:#56b6c2>]</span>.
</span></span><span style=display:flex><span> 137500: global: <span style=color:#56b6c2>[</span>sn:15<span style=color:#56b6c2>]</span> has <span style=color:#d19a66>2</span> ready out of <span style=color:#d19a66>2</span> sources. RTI 0<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span> 137500: system.cpu.iew: Setting Destination Register <span style=color:#d19a66>41</span> <span style=color:#56b6c2>(</span>integer<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span> 137500: system.cpu.scoreboard: Setting reg <span style=color:#d19a66>41</span> <span style=color:#56b6c2>(</span>integer<span style=color:#56b6c2>)</span> as ready
</span></span><span style=display:flex><span> 137500: system.cpu.iew: Sending instructions to commit, <span style=color:#56b6c2>[</span>sn:14<span style=color:#56b6c2>]</span> PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x1092c</span><span style=color:#56b6c2>=</span>&gt;0x1092e<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span> 137500: system.cpu.iq: Waking dependents of completed instruction.
</span></span><span style=display:flex><span> 137500: system.cpu.iq: Waking any dependents on register <span style=color:#d19a66>42</span> <span style=color:#56b6c2>(</span>integer<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span> 137500: system.cpu.iq: Waking up a dependent instruction, <span style=color:#56b6c2>[</span>sn:16<span style=color:#56b6c2>]</span> PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x10932</span><span style=color:#56b6c2>=</span>&gt;0x10936<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span> 137500: global: <span style=color:#56b6c2>[</span>sn:16<span style=color:#56b6c2>]</span> has <span style=color:#d19a66>1</span> ready out of <span style=color:#d19a66>1</span> sources. RTI 0<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span> 137500: system.cpu.iq: Instruction is ready to issue, putting it onto the ready list, PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x10932</span><span style=color:#56b6c2>=</span>&gt;0x10936<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span> opclass:1 <span style=color:#56b6c2>[</span>sn:16<span style=color:#56b6c2>]</span>.
</span></span><span style=display:flex><span> 137500: system.cpu.iq: Thread 0: Issuing instruction PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x10932</span><span style=color:#56b6c2>=</span>&gt;0x10936<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span> <span style=color:#56b6c2>[</span>sn:16<span style=color:#56b6c2>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> 138000: system.cpu.iew: Execute: Executing instructions from IQ.
</span></span><span style=display:flex><span> 138000: system.cpu.iew: Execute: Processing PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x10932</span><span style=color:#56b6c2>=</span>&gt;0x10936<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span>, <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> <span style=color:#56b6c2>[</span>sn:16<span style=color:#56b6c2>]</span>.
</span></span><span style=display:flex><span> 138000: global: RegFile: Access to int register 42, has data 0x1fda0
</span></span><span style=display:flex><span> 138000: global: RegFile: Setting int register <span style=color:#d19a66>43</span> to <span style=color:#d19a66>0</span>
</span></span><span style=display:flex><span> 138000: system.cpu.iew: Current wb cycle: 0, width: 8, numInst: <span style=color:#d19a66>1</span>  <span style=color:#7f848e>## InsttoCommit()</span>
</span></span><span style=display:flex><span> 138000: system.cpu.iew: Sending instructions to commit, <span style=color:#56b6c2>[</span>sn:16<span style=color:#56b6c2>]</span> PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x10932</span><span style=color:#56b6c2>=</span>&gt;0x10936<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span> 138000: system.cpu.iq: Waking dependents of completed instruction.
</span></span><span style=display:flex><span> 138000: system.cpu.iq: Waking any dependents on register <span style=color:#d19a66>43</span> <span style=color:#56b6c2>(</span>integer<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span> 138000: system.cpu.iq: Waking up a dependent instruction, <span style=color:#56b6c2>[</span>sn:17<span style=color:#56b6c2>]</span> PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x10936</span><span style=color:#56b6c2>=</span>&gt;0x10938<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> 138500: system.cpu.commit: <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> Marking PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x10932</span><span style=color:#56b6c2>=</span>&gt;0x10936<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span>, <span style=color:#56b6c2>[</span>sn:16<span style=color:#56b6c2>]</span> ready within ROB.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> 139000: system.cpu.commit: Trying to commit head instruction, <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> <span style=color:#56b6c2>[</span>sn:16<span style=color:#56b6c2>]</span>
</span></span><span style=display:flex><span> 139000: system.cpu.commit: <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> <span style=color:#56b6c2>[</span>sn:16<span style=color:#56b6c2>]</span> Committing instruction with PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x10932</span><span style=color:#56b6c2>=</span>&gt;0x10936<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span> 139000: system.cpu.rob: <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> Retiring head instruction, instruction PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x10932</span><span style=color:#56b6c2>=</span>&gt;0x10936<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span>, <span style=color:#56b6c2>[</span>sn:16<span style=color:#56b6c2>]</span>
</span></span><span style=display:flex><span> 139000: system.cpu: Removing committed instruction <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x10932</span><span style=color:#56b6c2>=</span>&gt;0x10936<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span> <span style=color:#56b6c2>[</span>sn:16<span style=color:#56b6c2>]</span>
</span></span><span style=display:flex><span> 139000: system.cpu: Removing instruction, <span style=color:#56b6c2>[</span>tid:0<span style=color:#56b6c2>]</span> <span style=color:#56b6c2>[</span>sn:16<span style=color:#56b6c2>]</span> PC <span style=color:#56b6c2>(</span><span style=color:#e06c75>0x10932</span><span style=color:#56b6c2>=</span>&gt;0x10936<span style=color:#56b6c2>)</span>.<span style=color:#56b6c2>(</span><span style=color:#e06c75>0</span><span style=color:#56b6c2>=</span>&gt;1<span style=color:#56b6c2>)</span>
</span></span></code></pre></div><p>å¯ä»¥é€šè¿‡log æ¥çœ‹ä¸€ä¸‹ï¼Œä¸€æ¡ç®€å•çš„ç®—æ•°æŒ‡ä»¤ä¼šè°ƒç”¨ä»€ä¹ˆå‡½æ•° ï¼Œ</p><p>æ‰€ä»¥åœ¨rename çš„ç¬¬äºŒä¸ªå‘¨æœŸï¼Œç¡®å®æ˜¯ä¼šå»è¾“å…¥rob çš„ ï¼Œ åœ¨commit é‡Œæœ‰è°ƒç”¨ rob çš„insertrob</p><h3 id=iew>iew</h3><p>åœ¨iew é˜¶æ®µ ï¼Œ å…ˆåšsorInsts() ,æŠŠä»rename è·å–çš„æŒ‡ä»¤(fromRename)å†™å…¥inst é˜Ÿåˆ— ï¼Œ</p><p>ç„¶åå†åšdispatch ,æŠŠinsté˜Ÿåˆ—çš„æ•°æ®æ´¾åˆ°å‘å°„é˜Ÿåˆ—é‡Œå»ï¼Œinstqueue , ldstrqueueï¼Œç›´æ¥æ˜¯insert ,è¿™é‡Œä¼šå»èµ‹å€¼toRename ï¼Œè¿™ä¸ªinst_queue çš„inserté‡Œå¹²äº†å¾ˆå¤šäº‹æƒ… ï¼Œ åŒ…æ‹¬æ ¹æ®æºå¯„å­˜å™¨æ ‡è®° dependenciesï¼ˆé‚£äº›æ²¡æœ‰readyçš„), addIfReady , å¯¹äºready çš„æŒ‡ä»¤å¯ä»¥ç›´æ¥åŠ å…¥readyInsté˜Ÿåˆ—ï¼ŒscheduleReadyInst å°±æ˜¯å»è°ƒåº¦readyInsté˜Ÿåˆ—ï¼Œåœ¨ä¸‹ä¸€ä¸ªå‘¨æœŸè¿›è¡Œissue çš„</p><p>ç„¶åæ˜¯executeInsts ï¼Œ</p><p>åœ¨executeInstsæ—¶ï¼Œè·å–instQueueçš„é¦–æ¡æŒ‡ä»¤ ï¼Œè¿›è¡Œæ‰§è¡Œ ï¼Œsize æ˜¯ä»fromIssueè·å–çš„,getInstToexecuteè·å–çš„æ˜¯instsToExecuteçš„å¼€å¤´ ï¼Œ instsToExecute æ˜¯åœ¨scheduleReadyInstçš„æ—¶å€™æ›´æ–°çš„ï¼Œå’Œsizeæ˜¯åŒæ­¥æ›´æ–°çš„ï¼Œ</p><p>ç„¶åæ˜¯writebackinsts , æ ¹æ®toCommitä¸­çš„æŒ‡ä»¤(toCommit æ˜¯ iewqueueçš„å†…å®¹ï¼Œæ˜¯åœ¨insttocommit å‡½æ•°è¿›è¡Œè®¾ç½®toCommit (è¿™æ˜¯åœ¨executeinstè°ƒç”¨çš„) ï¼Œ executeinsts ä¼šå¯¹å‡½æ•°è¿›è¡Œè°ƒç”¨ ï¼Œ å¯¹å‘å°„é˜Ÿåˆ—è¿›è¡ŒwakeDepentends (æ ¹æ®ç›®çš„å¯„å­˜å™¨æ›´æ–°ä¾èµ–), è®¾ç½®scordboard(ç›®æ ‡å¯„å­˜å™¨å·²ç»readyäº†) ,</p><p>ç„¶åæ˜¯inst_queue.scheduleReadyInst ï¼Œ æ˜¯è·å–æ–°çš„å¯ä»¥è¿›è¡Œæ‰§è¡Œçš„æŒ‡ä»¤ï¼Œå°±æ˜¯ä»readyInst[]é˜Ÿåˆ—ä¸­è¿›è¡Œè·å–ï¼Œè¦èµ‹å€¼instsToexecuteå’Œç›¸åº”çš„size , ç„¶åæ˜¯issueToExecQueue .advance , å»æŠŠé˜Ÿåˆ—å‰è¿›ä¸€æ­¥(å…¶å®è¿™é‡Œä¸å‰è¿›è·å–çš„ä¹Ÿæ˜¯å¯¹çš„ï¼Œæ–°çš„size æœ¬èº«å°±ä¼šè¢«executeinstæ£€æµ‹åˆ°ï¼Œä½†æ˜¯å¦‚æœå‰è¿›çš„è¯ï¼Œèµ‹å€¼å°±ä¼šèµ‹å€¼æ–°çš„size , ç„¶åexecuteæ˜¯è°ƒç”¨æ—§çš„size,å”¯ä¸€çš„å·®è·å°±æ˜¯sizeåœ¨èµ‹å€¼ä¹‹åä¸ä¼šè¢«æ›¿æ¢) ã€‚</p><p>æŒ‰ç…§æµæ°´çº¿çš„é¡ºåºæ­£å¸¸æ‰§è¡Œ ï¼Œ è¿™ä¸ªcycle èµ‹å€¼äº† torename , ç„¶åä¼šadvance , æ‰€ä»¥rename å¾—åˆ°çš„æ­£å¥½å°±æ˜¯ä¸Šä¸€ä¸ªå‘¨æœŸè·å¾—çš„æ•°æ® ï¼Œä½†æ˜¯è¿™æ ·çš„è¯ï¼Œå³ä½¿æ²¡æœ‰timebuffer ä¹Ÿèƒ½å¤Ÿå®ç° ï¼Œä¸è¿‡è¿™æ ·çš„è¯ä¼šè¿›è¡Œè¦†ç›– ã€‚</p><p>TimeBuffer æ˜¯å¾€å‰ä¼ è¾“æ•°æ®çš„ ï¼Œ å„ç§queueæ˜¯å¾€åä¼ è¾“æ•°æ®çš„</p><p>å¯¹äºgem5 o3 , dispatch å’Œ issue å¯ä»¥åœ¨åŒä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸ ï¼Œè¿™æ˜¯æœ€æè‡´çš„</p><h3 id=commit>commit</h3><p>åœ¨ commit é˜¶æ®µ ï¼Œ é€šè¿‡ markCompletedInsts å¯ä»¥æ ‡è®°æŒ‡ä»¤å·²ç»å®Œæˆäº†ï¼ŒfromIEW->instsï¼Œ å°±æ˜¯iewqueueçš„å†…å®¹ ï¼Œ æ­¤æ—¶å¦‚æœå‘ç°å¤´éƒ¨çš„æŒ‡ä»¤æ˜¯æ ‡è®°ä¸ºcommit çš„è¯ï¼Œä¹Ÿä¼šlog ready to commit , åä¹‹ log it not ready , commit æ˜¯åœ¨ markcommit ä¹‹å‰çš„ ï¼Œ æ‰€ä»¥è¿™å‘¨æœŸæ ‡è®°commit çš„ä¸‹ä¸€å‘¨æœŸæ‰èƒ½commit</p><p>å¦‚æœæ˜¯ready to commit çš„è¯ ï¼Œ commit å‡½æ•°ä¼šè°ƒç”¨ commitinst å‡½æ•° ï¼Œ è°ƒç”¨commithead , (å¤šè¯´ä¸€å¥ï¼Œgetinstæ˜¯ä»rename é‡Œå–äº†inst ,), commithead é‡Œä¹Ÿæœ‰rob è°ƒç”¨çš„ retireheadå‡½æ•° ï¼Œ è‚¯å®šä¼šæ›´æ–°rob ï¼Œ ç„¶åä¹Ÿä¼šè°ƒç”¨cpu removeFrontInst , ä¸€æ¡æŒ‡ä»¤å½»åº•ç»“æŸ ã€‚</p><h2 id=gem5-æµæ°´çº¿çš„çŠ¶æ€æ§åˆ¶>gem5 æµæ°´çº¿çš„çŠ¶æ€æ§åˆ¶</h2><p>å°±ä»¥rename ä½œä¸ºä¾‹å­ ï¼Œ å¯¹äºæ¯ä¸€ä¸ªæµæ°´çº¿ ï¼Œéƒ½æœ‰ä¸€ä¸ªå˜é‡ ï¼Œ æ¯”æ–¹è¯´rename å°±æ˜¯renamestatus</p><pre tabindex=0><code>1. é˜¶æ®µæ•´ä½“çŠ¶æ€
æ‰€æœ‰é˜¶æ®µéƒ½æœ‰ä¸€ä¸ªæ•´ä½“çŠ¶æ€å˜é‡_statusï¼Œé€šå¸¸åŒ…å«ï¼š

Activeï¼šé˜¶æ®µæ´»è·ƒï¼Œæ­£åœ¨å¤„ç†æŒ‡ä»¤
Inactiveï¼šé˜¶æ®µç©ºé—²ï¼Œæ²¡æœ‰å·¥ä½œè¦åš
Blockedï¼šé˜¶æ®µè¢«é˜»å¡ï¼Œç­‰å¾…ä¸‹æ¸¸èµ„æºå¯ç”¨
2. çº¿ç¨‹çº§çŠ¶æ€
æ¯ä¸ªé˜¶æ®µä¸ºæ¯ä¸ªçº¿ç¨‹ç»´æŠ¤ä¸€ä¸ªæ›´ç»†ç²’åº¦çš„çŠ¶æ€å˜é‡ï¼Œå¦‚decodeStatus[tid]ï¼ŒåŒ…å«ï¼š

Runningï¼šæ­£å¸¸å¤„ç†æŒ‡ä»¤
Idleï¼šçº¿ç¨‹æ²¡æœ‰æŒ‡ä»¤éœ€è¦å¤„ç†
Blockedï¼šçº¿ç¨‹è¢«ä¸‹æ¸¸é˜¶æ®µé˜»å¡
Unblockingï¼šçº¿ç¨‹æ­£ä»é˜»å¡çŠ¶æ€æ¢å¤
Squashingï¼šçº¿ç¨‹æ­£åœ¨å¤„ç†åˆ†æ”¯é¢„æµ‹é”™è¯¯æˆ–å¼‚å¸¸çš„æ¢å¤
</code></pre><p>å½“ä¸‹æ¸¸èµ„æºä¸è¶³çš„æ—¶å€™ï¼Œæµæ°´çº¿ä¼šè¿›è¡Œé˜»å¡çŠ¶æ€ ï¼Œä¸‹æ¸¸ä¼šæ˜¾å¼çš„é€šè¿‡ fromRename ä¹‹ç±»çš„å»å‘æµæ°´çº¿å‘é€block çŠ¶æ€</p><p>æ¯”æ–¹è¯´ rename , å®ƒåœ¨tick çš„æ—¶å€™ ï¼Œé¦–å…ˆå°±ä¼šå¯¹æ‰€æœ‰çº¿ç¨‹è¿›è¡Œ checkSignalsAndUpdate(tid)</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span>    <span style=color:#c678dd>while</span> (<span style=color:#e06c75>threads</span> <span style=color:#56b6c2>!=</span> <span style=color:#e06c75>end</span>) {
</span></span><span style=display:flex><span>        <span style=color:#e06c75>ThreadID</span> <span style=color:#e06c75>tid</span> <span style=color:#56b6c2>=</span> <span style=color:#56b6c2>*</span><span style=color:#e06c75>threads</span><span style=color:#56b6c2>++</span>;
</span></span><span style=display:flex><span>        <span style=color:#e06c75>DPRINTF</span>(<span style=color:#e06c75>Rename</span>, <span style=color:#98c379>&#34;Processing [tid:%i]</span><span style=color:#98c379>\n</span><span style=color:#98c379>&#34;</span>, <span style=color:#e06c75>tid</span>);
</span></span><span style=display:flex><span>        <span style=color:#e06c75>status_change</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>checkSignalsAndUpdate</span>(<span style=color:#e06c75>tid</span>) <span style=color:#56b6c2>||</span> <span style=color:#e06c75>status_change</span>;
</span></span><span style=display:flex><span>        <span style=color:#e06c75>rename</span>(<span style=color:#e06c75>status_change</span>, <span style=color:#e06c75>tid</span>);
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>checkSignalAndUpdate</p><p>å…¶ä¸­ä¼šæ£€æŸ¥èµ„æºæ˜¯å¦ä¸è¶³ï¼ˆIQ , ROB , LQ , SQ , FreeList ï¼Œ iew æ˜¯å¦å‘ rename å‘é€äº† block ä¿¡å·</p><blockquote><p>å®ƒçš„ä¸€ç³»åˆ—èµ„æºçš„æ£€æŸ¥éƒ½æ˜¯from_iew é‡Œè·å–çš„ ï¼Œ why ?</p><p>fromiew æ˜¯iew ä¸Šä¸€ä¸ªå‘¨æœŸå¤„ç†è·å¾—çš„ä¸€äº›æ•°æ® ï¼Œ ä»å¯„å­˜å™¨è§’åº¦è¿™å‘¨æœŸç¡®å®åº”è¯¥å¾—åˆ°äº†</p><p>å®ƒè·å–çš„freeIQEntries ï¼Œ freeLQEntries ï¼Œä¹‹ç±»çš„éƒ½æ˜¯é€šè¿‡from_iew è·å–çš„ ï¼Œ freeROBEntries , æ˜¯åœ¨commit é˜¶æ®µè·å–çš„</p><p>ç„¶årename åœ¨calcFreeROBEntries çš„æ—¶å€™ï¼Œ è®¡ç®—å…¬å¼æ˜¯è¿™æ ·çš„ ï¼Œ</p><p>å…¶å®fromå“ªé‡Œæ˜¯æ— æ‰€è°“çš„ï¼Œä¸»è¦æ˜¯è¦è·å¾—ä¸Šä¸€å‘¨æœŸçš„æ•°æ® ï¼Œ fromcommit ä¸»è¦æ˜¯commit é˜¶æ®µæœ‰ä¸Šä¸ªå‘¨æœŸçš„rob æ•°æ® ï¼Œ fromiew æ˜¯å› ä¸ºæœ‰ä¸Šä¸ªå‘¨æœŸdispatch çš„æ•°æ®</p><p>è¿™ç§ç»Ÿè®¡è¯´æ˜ä¸Šå‘¨æœŸdispatch çš„è¿˜æ²¡è¢«commit æ„ŸçŸ¥åˆ° ï¼Œ å› ä¸ºå®ƒè·å–çš„ä¹Ÿæ˜¯ä¸Šå‘¨æœŸçš„robEntries</p><p>è¿™å‘¨æœŸcommit æ˜¯èƒ½å¤ŸçŸ¥é“dispatch çš„ ï¼Œ ä½†æ˜¯åœ¨rename è¿™ä¸ªé˜¶æ®µæ˜¯æ²¡æœ‰è¿›è¡Œæ›´æ–°çš„</p><p>ä¸Šé¢çš„2å¥è¯æ˜¯é”™è¯¯çš„ ï¼Œ å› ä¸ºå®é™…ä¸Šä¸æ˜¯dispatch çš„æ—¶å€™å‘é€ç»™rob , è€Œæ˜¯renameçš„æ—¶å€™å‘é€ç»™rob ,</p><p>æ‰€ä»¥freeEnties æ˜¯å·²ç»å‡å»äº†dispatchçš„æŒ‡ä»¤æ•°çš„</p><p>å…¶å®ä¸ç”¨è€ƒè™‘çš„è¿™ä¹ˆå¤æ‚ ï¼Œ instsInProgress[tid] - fromIEW->iewInfo[tid].dispatched) æ‰æ˜¯æœ¬å‘¨æœŸå·²ç»é‡å‘½åä½†æ˜¯æ²¡æœ‰å‘å°„çš„ ï¼Œ æ‰€ä»¥éœ€è¦é¢„ç•™ä½ç½®</p><p>int num_free = freeEntries[tid].robEntries -
(instsInProgress[tid] - fromIEW->iewInfo[tid].dispatched);</p><p>å·²ç»ç»è¿‡rename ä½†æ˜¯è¿˜æœªåˆ†å‘çš„æŒ‡ä»¤å·²ç»æ¶ˆè€—äº†ROBç©ºé—´ ï¼Œ éœ€è¦ä»æ€»ç©ºé—²æ¡ç›®ä¸­å‡å»</p><p>å¯¹äºinstInProgress , å½“æŒ‡ä»¤é€šè¿‡renameé˜¶æ®µçš„æ—¶å€™ï¼Œè®¡æ•°å™¨å¢åŠ ï¼Œå½“æŒ‡ä»¤ä»iewæˆåŠŸåˆ†å‘åˆ°æŒ‡ä»¤é˜Ÿåˆ—çš„æ—¶å€™ï¼Œè®¡æ•°å™¨å‡å°‘ instinprogressè·Ÿè¸ªæ­£åœ¨æµæ°´çº¿ä¸­ç§»åŠ¨ä½†æ˜¯å°šæœªè¿›å…¥æŒ‡ä»¤é˜Ÿåˆ—/load-store é˜Ÿåˆ—çš„æŒ‡ä»¤</p><p>å…¶å®ä¹Ÿæ˜¯ä»freeIEWå¤„è·å–çš„ ï¼Œ</p></blockquote><pre tabindex=0><code>    // Check if there&#39;s a squash signal, squash if there is
    // Check stall signals, block if necessary.
    // If status was blocked
    //     check if stall conditions have passed
    //         if so then go to unblocking
    // If status was Squashing
    //     check if squashing is not high.  Switch to running this cycle.
    // If status was serialize stall
    //     check if ROB is empty and no insts are in flight to the ROB
</code></pre><pre tabindex=0><code>                 +----------+
                 |   Idle   |&lt;--------+
                 +-----+----+         |
                       |              |
                       | æœ‰æŒ‡ä»¤éœ€å¤„ç†  |
                       V              |
                 +----------+         |
                 |  Running |         | æ²¡æœ‰æŒ‡ä»¤
                 +-----+----+         |
                       |              |
                       |              |
        +--------+-----+-----+--------+
        |        |           |        |
    èµ„æºä¸è¶³    åˆ†æ”¯é¢„æµ‹é”™è¯¯   æ­£å¸¸å¤„ç†å®Œæˆ
        |        |           |
        V        V           |
   +--------+ +----------+   |
   | Blocked | | Squashing| &lt;+
   +----+---+ +-----+----+
        |           |
   é˜»å¡æ¡ä»¶æ¶ˆå¤±   æ¸…é™¤å®Œæˆ
        |           |
        V           |
   +-----------+    |
   | Unblocking|    |
   +-----+-----+    |
         |          |
    skid bufferç©º   |
         |          |
         +----------+
</code></pre><p>block çŠ¶æ€çš„è½¬å˜æœ‰ä¸¤ç§ ï¼Œ ä¸€ç§æ˜¯åœ¨å‰é¢å‘ç°èµ„æºçš„æ—¶å€™æ ¹æ®å‰é¢å‘¨æœŸçš„å°±åˆ¤æ–­å‡ºæ¥èµ„æºä¸è¶³ï¼Œ è¿˜æœ‰ä¸€ç§æ˜¯åœ¨renameInstçš„æ—¶å€™å‘ç°å½“å‰éœ€è¦é‡å‘½åçš„æŒ‡ä»¤æ•°æ˜¯&lt;èµ„æºæ•°çš„</p><p>åœ¨sortInsts æ—¶æ˜¯ä¸éœ€è¦åˆ¤æ–­çŠ¶æ€çš„ ï¼Œæ‰€ä»¥å³ä½¿æ˜¯é˜»å¡ ï¼Œ å®é™…ä¹Ÿæ˜¯inst å…ˆä» fromdecode -> inst åˆ° inst , å†åˆ° skidbuffer</p><p>cycle 0 , å…ˆåœ¨æ›´æ–°çŠ¶æ€æ˜¯å‘ç°è¦block , ç„¶åinst ä¼šä» inst buffer ç§»åŠ¨åˆ°skidbuffer , çŠ¶æ€è¿›å…¥block ,</p><p>åœ¨cycle 1 , æ­¤æ—¶çŠ¶æ€æ˜¯block äº† ï¼Œ decode ä¹Ÿä¸ä¼šäº§å‡ºæ–°çš„inst äº† ï¼Œ ä¸è¿‡decode ä¸Šå‘¨æœŸäº§å‡ºçš„inst ä¹Ÿä¼šè¾“å…¥åˆ°skidbuffer ,</p><p>block åœ¨ç¡¬ä»¶ä¸­æ˜¯ç›¸å½“äºready ä¿¡å· ï¼Œ ä¸è¿‡æœ‰ä¸€äº›ä¸ä¸€æ ·çš„å°±æ˜¯ï¼Œæ¯”æ–¹è¯´cycle 0 , rename å‘ç°æ— æ³•dispatch äº† ï¼Œå®ƒä¼šæŠŠready ä¿¡å·æ‹‰ä½ ï¼Œ åœ¨ä¸‹ä¸€å‘¨æœŸrename è¾“å…¥çš„inst å°±æ˜¯ä¸å˜çš„</p><p>ä½†æ˜¯ ï¼Œåœ¨gem5 ä¸­ ï¼Œ cycle 0 åˆ¤æ–­å‡ºæ— æ³•dispatch äº† ï¼Œ è®¾ç½®ä¸ºblock , æ­¤æ—¶ä¼šæŠŠinst è¾“å…¥åˆ° skidbuffer , ä¸è¿‡æ­¤æ—¶decodeå·²ç»å¯¹æŒ‡ä»¤è¿›è¡Œäº†å¤„ç†ï¼Œå¹¶ä¸”æ”¾åœ¨äº†torenameé˜Ÿåˆ—ä¸Š ï¼Œæ‰€ä»¥æ­£å¸¸æ¥è¯´ cycle 1 å‘¨æœŸ ï¼Œ rename è¿˜æ˜¯èƒ½å¤Ÿæ¥å—åˆ° decode ä¼ å…¥çš„æ•°æ® ï¼Œè¿™ä¸ªæ•°æ®è¿˜æ˜¯ä¼šè¢«è¾“å…¥åˆ°skidbuffer</p><p>decode å”¯ä¸€block çš„ç†ç”±å°±æ˜¯ rename block äº† ï¼Œ decode æ— æ³•å‘é€åˆ°ä¸‹ä¸€çº§</p><p>åœ¨unblock çš„æ—¶å€™ï¼Œä¼šæŠŠskid buffer çš„æ•°æ®å‘é€å®Œ ï¼Œå‘å®Œä¹‹åï¼Œå†è¿›å…¥running mode</p><p>çœ‹è¿™é‡Œdecode æ˜¯Blocking çŠ¶æ€ ï¼Œ ä½†æ˜¯rename è¿˜æ˜¯æ¥æ”¶äº†inst åˆ° skidbuffer , å’Œä¸Šé¢çš„åˆ†ææ˜¯ä¸€è‡´çš„ ï¼Œæ˜¯ä¸Šä¸ªå‘¨æœŸè¿›è¡Œdecode çš„ æ•°æ®</p><p><figure class=gallery-image style=flex-grow:186;flex-basis:446px><a href=/2025/gem5_o3_learning/image-20250419142008614.png data-size=1410x758><img src=/2025/gem5_o3_learning/image-20250419142008614.png width=1410 height=758 srcset="/2025/gem5_o3_learning/image-20250419142008614_hu5005971208709278762.png 480w, /2025/gem5_o3_learning/image-20250419142008614_hu17172815589540901216.png 1024w" loading=lazy></a></figure></p><p>ç¡¬ä»¶ä¸Š ï¼Œ æŠŠæ•°æ®å…¨éƒ½dispatch ä¹‹åä¼šæŠŠready æ‹‰é«˜ ï¼Œ ä¸‹ä¸€å‘¨æœŸå°±å¯ä»¥è·å–åˆ°æ–°çš„æ•°æ®äº†</p><p>å¯¹äºgem5 , åœ¨block ä¹‹åä¼šå…ˆè½¬ä¸ºunblock , æŠŠskidbuffer çš„æ•°æ®å‘å®Œ ï¼Œ ç„¶åå†è®©decode æä¾›æ–°çš„æ•°æ® ï¼Œ æœ¬èº« skidbuffer é‡Œå¤šäº†ä¸€ç»„æ•°æ® ï¼Œ åœ¨ç¡¬ä»¶èƒ½å¤Ÿready çš„é‚£ä¸ªå‘¨æœŸï¼Œå®ƒå»å‘é€skidbuffer çš„æ•°æ® ï¼Œ ä¸è¿‡å¦‚æœèƒ½åœ¨å‘¨æœŸå‘å®Œï¼Œå°±æ˜¯runningäº† ï¼Œæ­¤æ—¶decode æ„ŸçŸ¥åˆ°unblock äº† ï¼Œ ä¸‹ä¸ªå‘¨æœŸdecodeå¯ä»¥æ”¾æ•°æ®äº†ï¼Œä½†æ˜¯ä¸‹ä¸€å‘¨æœŸrename æ„ŸçŸ¥åˆ°çš„æ˜¯decode æ— æ•°æ®å§ï¼Œ</p><blockquote><p>æ€»æ„Ÿè§‰ä¼šæœ‰æ€§èƒ½çš„æŸå¤± ï¼Œ rename åœ¨ cycle 0 é€šçŸ¥ decode unblock äº† ï¼Œcycle1 çš„æ—¶å€™ decode å¼€å§‹è·å–æ–°çš„æŒ‡ä»¤ ï¼Œ rename ä¼šåœ¨cycle 2 çš„æ—¶å€™å¾—åˆ°é‚£ä¸€ç»„æŒ‡ä»¤ ï¼Œ å¯¹çš„ï¼Œ åœ¨å¯ä»¥running çš„é‚£ä¸ªå‘¨æœŸï¼Œå®é™…ä¸Šç©ºè·‘äº† ï¼Ÿ</p><p>å¦‚æœæ­¤æ—¶decode æ˜¯æ²¡æœ‰æŒ‡ä»¤çš„ï¼Œé‚£å°±æ˜¯åˆç†çš„ ï¼Œ ç¡®å®æ˜¯ ï¼Œ decode é˜»å¡äº† ï¼Œ fetch åº”è¯¥</p></blockquote><p><figure class=gallery-image style=flex-grow:320;flex-basis:770px><a href=/2025/gem5_o3_learning/image-20250419164832711.png data-size=1425x444><img src=/2025/gem5_o3_learning/image-20250419164832711.png width=1425 height=444 srcset="/2025/gem5_o3_learning/image-20250419164832711_hu12862425231972313929.png 480w, /2025/gem5_o3_learning/image-20250419164832711_hu5502443116281225258.png 1024w" loading=lazy></a></figure></p><h3 id=ä¸€æ¡load-æŒ‡ä»¤çš„æ‰€æœ‰-log>ä¸€æ¡load æŒ‡ä»¤çš„æ‰€æœ‰ log</h3><p>è¿™åº”è¯¥æ˜¯ä¸€æ¡load hit çš„load æŒ‡ä»¤</p><p><figure class=gallery-image style=flex-grow:3516;flex-basis:8438px><a href=/2025/gem5_o3_learning/image-20250423102946586.png data-size=1090x31><img src=/2025/gem5_o3_learning/image-20250423102946586.png width=1090 height=31 srcset="/2025/gem5_o3_learning/image-20250423102946586_hu7852976632522816433.png 480w, /2025/gem5_o3_learning/image-20250423102946586_hu7587512065775351436.png 1024w" loading=lazy></a></figure></p><pre tabindex=0><code class=language-assembly data-lang=assembly>7775500: system.cpu.decoder: Requesting bytes 0x681cfcbf from address 0x30100
7775500: system.cpu.decoder: pc 30102 , vl 0 vsew 0 vlmul0
7775500: system.cpu.decoder: Decoding instruction 0x0000681c at address 0x30102
7775500: system.cpu.decoder: Decode: Decoded c_ld instruction: 0x500001000000681c
7775500: global: DynInst: [sn:10846] Instruction created. Instcount for system.cpu = 38
7775500: system.cpu.fetch: [tid:0] Instruction PC (0x30102=&gt;0x30104).(0=&gt;1) created [sn:10846].
7775500: system.cpu.fetch: [tid:0] Instruction is: c_ld a5, 16(s0)
7775500: system.cpu.fetch: [tid:0] Fetch queue entry created (1/32).

7776000: system.cpu.decode: Processing [tid:0]
7776000: system.cpu.decode: [tid:0] Not blocked, so attempting to run stage.
7776000: system.cpu.decode: [tid:0] Sending instruction to rename.
7776000: system.cpu.decode: [tid:0] Processing instruction [sn:10846] with PC (0x30102=&gt;0x30104).(0=&gt;1)

7776500: system.cpu.rename: [tid:0] Sending instructions to IEW.
7776500: system.cpu.rename: calcFreeLQEntries: free lqEntries: 27, loadsInProgress: 3, loads dispatchedToLQ: 3
7776500: system.cpu.rename: [tid:0] Processing instruction [sn:10846] with PC (0x30102=&gt;0x30104).(0=&gt;1).
7776500: system.cpu.rename: [tid:0] Looking up integer arch reg 8, got phys reg 12 (integer)
7776500: system.cpu.rename: [tid:0] Register 12 (flat: 12) (integer) is ready.
7776500: global: [sn:10846] has 1 ready out of 1 sources. RTI 0)
7776500: global: Renamed reg integer[15] to physical reg 255 (255) old mapping was 222 (222)
7776500: system.cpu.rename: [tid:0] Renaming arch reg 15 (integer) to physical reg 255 (255).
7776500: system.cpu.rename: [tid:0] Renaming arch reg 15 (integer) to physical reg 255 (255). flat dest 15
7776500: system.cpu.rename: [tid:0] [sn:10846] Adding instruction to history buffer (size=20).

7777000: system.cpu.iew: Activity this cycle.
7777000: system.cpu.commit: Getting instructions from Rename stage.
7777000: system.cpu.commit: [tid:0] [sn:10846] Inserting PC (0x30102=&gt;0x30104).(0=&gt;1) into ROB.
7777000: system.cpu.rob: Adding inst PC (0x30102=&gt;0x30104).(0=&gt;1) to the ROB.

7777500: system.cpu.iew: [tid:0] Not blocked, so attempting to run dispatch.
7777500: system.cpu.iew: [tid:0] Issue: Adding PC (0x30102=&gt;0x30104).(0=&gt;1) [sn:10846] [tid:0] to IQ.
7777500: system.cpu.iew: [tid:0] Issue: Memory instruction encountered, adding to LSQ.
7777500: system.cpu.iew.lsq.thread0: Inserting load PC (0x30102=&gt;0x30104).(0=&gt;1), idx:1394 [sn:10846] # ldq.insertLoad()
7777500: system.cpu.iq: Adding instruction [sn:10846] PC (0x30102=&gt;0x30104).(0=&gt;1) to the IQ.
7777500: memdepentry: Memory dependency entry created. memdep_count=6 (0x30102=&gt;0x30104).(0=&gt;1) # memdequnit::insert()
7777500: global: Inst 0x30102 with index 64 had no SSID
7777500: system.cpu.memDep0: No dependency for inst PC (0x30102=&gt;0x30104).(0=&gt;1) [sn:10846].
7777500: system.cpu.memDep0: Adding instruction [sn:10846] to the ready list.
7777500: system.cpu.iq: Instruction is ready to issue, putting it onto the ready list, PC (0x30102=&gt;0x30104).(0=&gt;1) opclass:52 [sn:10846]. ## InstructionQueue::addReadyMemInst()
7777500: system.cpu.iq: Thread 0: Issuing instruction PC (0x30102=&gt;0x30104).(0=&gt;1) [sn:10846]# è°ƒç”¨çš„æ˜¯scheduleReadyInst()é€‰æ‹©éœ€è¦è¢«issue çš„æŒ‡ä»¤ï¼Œä¸‹ä¸€å‘¨æœŸæŒ‡ä»¤ä¼šå‘å°„åˆ°æ‰§è¡Œå•å…ƒ 
7777500: system.cpu.memDep0: Issuing instruction PC 0x30102 [sn:10846]. # è¿™é‡Œä¹Ÿè°ƒç”¨äº†memDep issue ä¸»è¦æ˜¯æ›´æ–°store-setsçš„ 


7778000: system.cpu.iew: Execute: Processing PC (0x30102=&gt;0x30104).(0=&gt;1), [tid:0] [sn:10846].
7778000: system.cpu.iew: Execute: Calculating address for memory reference.
7778000: system.cpu.iew.lsq.thread0: Executing load PC (0x30102=&gt;0x30104).(0=&gt;1), [sn:10846] # ldq.executeLoad()
7778000: global: RegFile: Access to int register 12, has data 0xa0ad8
7778000: system.cpu.iew.lsq.thread0: Read called, load idx: 1394, store idx: 1942, storeHead: 1930 addr: 0x90ae8 ## è¿™é‡Œæ˜¯lsq_unit.read(), ä½†æ˜¯å®é™…ä¸Šç»å†äº†ç›¸å½“é•¿çš„è°ƒç”¨é“¾
7778000: system.cpu.iew.lsq.thread0: Doing memory access for inst [sn:10846] PC (0x30102=&gt;0x30104).(0=&gt;1) ## lsq_unit.read()
7778000: system.cpu.iew.lsq.thread0: Memory request (pkt: ReadResp [90ae8:90aef]) from inst [sn:10846] was sent (cache is blocked: 0, cache_got_blocked: 0)
7778000: global: update entry for pc:(0x30102=&gt;0x30104).(0=&gt;1) new_addr : a0ae8
7778000: system.cpu.iew: Load: PC=(0x30102=&gt;0x30104).(0=&gt;1),&lt;extra arg&gt;%

7779000: system.cpu.iew: Sending instructions to commit, [sn:10846] PC (0x30102=&gt;0x30104).(0=&gt;1). # writebackinsts
7779000: system.cpu.iq: Waking dependents of completed instruction.
7779000: system.cpu.memDep0: Completed mem instruction PC (0x30102=&gt;0x30104).(0=&gt;1) [sn:10846].
7779000: memdepentry: Memory dependency entry deleted. memdep_count=5 (0x30102=&gt;0x30104).(0=&gt;1)
7779000: system.cpu.iq: Completing mem instruction PC: (0x30102=&gt;0x30104).(0=&gt;1) [sn:10846] # MemDepUnit::completed(ï¼‰
7779000: system.cpu.iq: Waking any dependents on register 255 (integer).
7779000: system.cpu.iq: Waking up a dependent instruction, [sn:10848] PC (0x30106=&gt;0x30108).(0=&gt;1).
7779000: global: [sn:10848] has 1 ready out of 1 sources. RTI 0)

7779500: system.cpu.commit: [tid:0] Marking PC (0x30102=&gt;0x30104).(0=&gt;1), [sn:10846] ready within ROB. # commit::markCompletedInsts() , è¿™é‡Œå·²ç»åšå¥½äº†æäº¤çš„å‡†å¤‡ï¼Œä½†æ˜¯å‰é¢çš„æŒ‡ä»¤è¿˜æ²¡æœ‰æäº¤å®Œå…¨ 


7781500: system.cpu.commit: Trying to commit head instruction, [tid:0] [sn:10846] ## å‰é¢çš„æŒ‡ä»¤æäº¤å®Œäº†ï¼Œ
7781500: system.cpu.commit: [tid:0] [sn:10846] Committing instruction with PC (0x30102=&gt;0x30104).(0=&gt;1)
7781500: system.cpu.rob: [tid:0] Retiring head instruction, instruction PC (0x30102=&gt;0x30104).(0=&gt;1), [sn:10846]
7781500: system.cpu: Removing committed instruction [tid:0] PC (0x30102=&gt;0x30104).(0=&gt;1) [sn:10846]
7781500: system.cpu: Removing instruction, [tid:0] [sn:10846] PC (0x30102=&gt;0x30104).(0=&gt;1)
</code></pre><p>load store æŒ‡ä»¤è¿˜æ˜¯ä¼šè¢«åŠ å…¥åˆ°iq</p><p>åœ¨dispatch çš„æ—¶å€™ä¹Ÿä¼šè°ƒç”¨ldstQueue.insertLoad(inst)å»æ’å…¥load</p><p>åœ¨iq.insert é‡Œè¿˜ä¼šè°ƒç”¨ memdequnit .insert å»ç”Ÿæˆmem çš„entry</p><p>lsq_unit.read æ˜¯åœ¨è°ƒç”¨ lsq_initiateAcc()çš„æ—¶å€™ç»è¿‡ä¸€å±‚ä¸€å±‚è°ƒç”¨çš„ ï¼Œ æ˜¯å’Œinst ç›¸å…³çš„</p><p><figure class=gallery-image style=flex-grow:374;flex-basis:898px><a href=/2025/gem5_o3_learning/image-20250426100747055.png data-size=760x203><img src=/2025/gem5_o3_learning/image-20250426100747055.png width=760 height=203 srcset="/2025/gem5_o3_learning/image-20250426100747055_hu10669214937265287552.png 480w, /2025/gem5_o3_learning/image-20250426100747055_hu16144696394555657848.png 1024w" loading=lazy></a></figure></p><h3 id=mem_dep_unit>mem_dep_unit</h3><p>ï¼ˆMemory Dependency Unitï¼‰æ˜¯ gem5 O3 CPU æ¨¡å‹ä¸­çš„å…³é”®ç»„ä»¶ï¼Œè´Ÿè´£é¢„æµ‹å’Œç®¡ç†å†…å­˜æŒ‡ä»¤ï¼ˆåŠ è½½å’Œå­˜å‚¨ï¼‰ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å®ƒçš„ä¸»è¦ç›®çš„æ˜¯ç¡®ä¿åœ¨ä¹±åºæ‰§è¡Œç¯å¢ƒä¸­ç»´æŠ¤æ­£ç¡®çš„å†…å­˜è®¿é—®é¡ºåºï¼ŒåŒæ—¶æœ€å¤§é™åº¦åœ°æé«˜æŒ‡ä»¤çº§å¹¶è¡Œæ€§ã€‚</p><p>å…¶æ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬ï¼š</p><ul><li>é¢„æµ‹å¹¶è·Ÿè¸ªå†…å­˜æŒ‡ä»¤é—´çš„ä¾èµ–å…³ç³»</li><li>ç®¡ç†å†…å­˜å±éšœæŒ‡ä»¤</li><li>å¤„ç†å†…å­˜ä¾èµ–è¿è§„æƒ…å†µ</li><li>å†³å®šå†…å­˜æŒ‡ä»¤ä½•æ—¶å¯ä»¥å®‰å…¨åœ°æ‰§è¡Œ</li></ul><p>æ¯æ¬¡åœ¨dispatch çš„æ—¶å€™éƒ½ä¼šç”Ÿæˆä¸€ä¸ªmem_dep_entry ,</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#c678dd>class</span> <span style=color:#e5c07b>MemDepEntry</span> {
</span></span><span style=display:flex><span><span style=color:#c678dd>public</span><span style=color:#56b6c2>:</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>DynInstPtr</span> <span style=color:#e06c75>inst</span>;               <span style=color:#7f848e>// è¢«è·Ÿè¸ªçš„æŒ‡ä»¤
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#e06c75>ListIt</span> <span style=color:#e06c75>listIt</span>;                 <span style=color:#7f848e>// æŒ‡ä»¤åœ¨åˆ—è¡¨ä¸­çš„ä½ç½®è¿­ä»£å™¨
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#e06c75>std</span><span style=color:#56b6c2>::</span><span style=color:#e06c75>vector</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>MemDepEntryPtr</span><span style=color:#56b6c2>&gt;</span> <span style=color:#e06c75>dependInsts</span>;  <span style=color:#7f848e>// ä¾èµ–äºæ­¤æŒ‡ä»¤çš„å…¶ä»–æŒ‡ä»¤åˆ—è¡¨
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#e5c07b>bool</span> <span style=color:#e06c75>regsReady</span> <span style=color:#56b6c2>=</span> <span style=color:#e5c07b>false</span>;        <span style=color:#7f848e>// å¯„å­˜å™¨æ˜¯å¦å°±ç»ª
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#e5c07b>int</span> <span style=color:#e06c75>memDeps</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>0</span>;               <span style=color:#7f848e>// éœ€è¦æ»¡è¶³çš„å†…å­˜ä¾èµ–æ•°é‡
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#e5c07b>bool</span> <span style=color:#e06c75>completed</span> <span style=color:#56b6c2>=</span> <span style=color:#e5c07b>false</span>;        <span style=color:#7f848e>// æŒ‡ä»¤æ˜¯å¦å®Œæˆ
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#e5c07b>bool</span> <span style=color:#e06c75>squashed</span> <span style=color:#56b6c2>=</span> <span style=color:#e5c07b>false</span>;         <span style=color:#7f848e>// æŒ‡ä»¤æ˜¯å¦è¢«æŒ¤å‡º
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>};
</span></span></code></pre></div><p>ä½¿ç”¨store-sets åˆ¤æ–­å†…å­˜ä¾èµ– ï¼Œ å¦‚æœæ²¡æœ‰å†…å­˜ä¾èµ–äº† ï¼Œ è°ƒç”¨InstructionQueue åŠ å…¥åˆ°readyInstsé˜Ÿåˆ—é‡Œé¢ ï¼Œ</p><p>åˆ¤æ–­å†…å­˜ä¾èµ–ä¹‹å‰ï¼Œå®é™…ä¸Šæ˜¯æ£€æŸ¥è¿‡æ˜¯å¦å‡ºç°å¯„å­˜å™¨ä¾èµ–çš„</p><h2 id=inst_queue>inst_queue</h2><h3 id=list_order>list_order</h3><p><a class=link href=vscode-file://vscode-app/usr/share/code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html>listOrder</a> æ˜¯ä¸€ä¸ªåŒ…å« <a class=link href=vscode-file://vscode-app/usr/share/code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html>ListOrderEntry</a> å¯¹è±¡çš„é“¾è¡¨ï¼Œæ¯ä¸ª <a class=link href=vscode-file://vscode-app/usr/share/code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html>ListOrderEntry</a> è®°å½•äº†ä¸€ä¸ªæ“ä½œç±»åˆ«é˜Ÿåˆ—çš„ä¿¡æ¯ï¼š</p><pre tabindex=0><code>struct ListOrderEntry {
    OpClass queueType;         // é˜Ÿåˆ—ç±»å‹ï¼ˆæ“ä½œç±»åˆ«ï¼‰
    InstSeqNum oldestInst;     // è¯¥é˜Ÿåˆ—ä¸­æœ€è€æŒ‡ä»¤çš„åºåˆ—å·
};
</code></pre><p>è¯¥åˆ—è¡¨æŒ‰ç…§æŒ‡ä»¤çš„å¹´é¾„ï¼ˆåºåˆ—å·ï¼‰æ’åºï¼ŒåŒ…å«äº†å„ç§æ“ä½œç±»å‹çš„å°±ç»ªæŒ‡ä»¤é˜Ÿåˆ—ã€‚å®ƒçš„ä¸»è¦ä½œç”¨æœ‰ï¼š</p><ol><li><strong>ç»´æŠ¤å‘å°„ä¼˜å…ˆçº§</strong>ï¼šç¡®ä¿æœ€è€çš„æŒ‡ä»¤æœ€å…ˆå‘å°„ï¼Œå®ç°æŒ‰ç¨‹åºé¡ºåºå‘å°„çš„ç­–ç•¥</li><li><strong>æ“ä½œç±»å‹é€‰æ‹©</strong>ï¼šé€šè¿‡éå† <a class=link href=vscode-file://vscode-app/usr/share/code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html>listOrder</a>ï¼ŒæŒ‰é¡ºåºé€‰æ‹©ä¸åŒæ“ä½œç±»å‹çš„æŒ‡ä»¤è¿›è¡Œå‘å°„</li><li><strong>å‘å°„å¸¦å®½åˆ†é…</strong>ï¼šåœ¨ <a class=link href=vscode-file://vscode-app/usr/share/code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html>totalWidth</a>ï¼ˆæ€»å‘å°„å¸¦å®½ï¼‰èŒƒå›´å†…ï¼Œå°½å¯èƒ½å¤šåœ°å‘å°„æŒ‡ä»¤</li></ol><p>æ‰€ä»¥è¯´readyInsts[op_class]ä¹Ÿæ˜¯æŒ‰ç…§op_class è¿›è¡Œåˆ†ç±»çš„</p><p>order_list æ¯ä¸€ä¸ªop_class æ¡ç›®åªä¼šå­˜åœ¨ä¸€é¡¹ ï¼Œ</p><p><strong>æ·»åŠ æ¡ç›®</strong>ï¼šå½“ä¸€ä¸ªæ“ä½œç±»å‹ï¼ˆOpClassï¼‰çš„å°±ç»ªé˜Ÿåˆ—ä»ç©ºå˜ä¸ºéç©ºæ—¶ï¼Œä¼šå‘ <code>listOrder</code> æ·»åŠ ä¸€ä¸ªæ–°æ¡ç›®</p><p>queueOnList å°±æ˜¯æ ‡è®°è¯¥op_class å¯¹åº”çš„listæ˜¯å¦å·²ç»åœ¨åˆ—è¡¨ä¸­äº†</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span>        <span style=color:#c678dd>if</span> (<span style=color:#56b6c2>!</span><span style=color:#e06c75>queueOnList</span>[<span style=color:#e06c75>op_class</span>]) {
</span></span><span style=display:flex><span>            <span style=color:#e06c75>addToOrderList</span>(<span style=color:#e06c75>op_class</span>);
</span></span><span style=display:flex><span>        } <span style=color:#c678dd>else</span> <span style=color:#61afef;font-weight:700>if</span> (<span style=color:#e06c75>readyInsts</span>[<span style=color:#e06c75>op_class</span>].<span style=color:#e06c75>top</span>()<span style=color:#56b6c2>-&gt;</span><span style=color:#e06c75>seqNum</span>  <span style=color:#56b6c2>&lt;</span>
</span></span><span style=display:flex><span>                   (<span style=color:#56b6c2>*</span><span style=color:#e06c75>readyIt</span>[<span style=color:#e06c75>op_class</span>]).<span style=color:#e06c75>oldestInst</span>) {
</span></span><span style=display:flex><span>            <span style=color:#e06c75>listOrder</span>.<span style=color:#e06c75>erase</span>(<span style=color:#e06c75>readyIt</span>[<span style=color:#e06c75>op_class</span>]);
</span></span><span style=display:flex><span>            <span style=color:#e06c75>addToOrderList</span>(<span style=color:#e06c75>op_class</span>);
</span></span><span style=display:flex><span>        }
</span></span></code></pre></div><p><strong>åˆ é™¤æ¡ç›®</strong>ï¼šå½“ä¸€ä¸ªæ“ä½œç±»å‹çš„å°±ç»ªé˜Ÿåˆ—å˜ä¸ºç©ºæ—¶ï¼Œä¼šä» <code>listOrder</code> ä¸­ç§»é™¤å…¶æ¡ç›®</p><pre tabindex=0><code>// åœ¨ scheduleReadyInsts() å‡½æ•°ä¸­
if (!readyInsts[op_class].empty()) {
    moveToYoungerInst(order_it);
} else {
    // é˜Ÿåˆ—ä¸ºç©ºï¼Œä» listOrder ä¸­ç§»é™¤
    readyIt[op_class] = listOrder.end();
    queueOnList[op_class] = false;
}

// åˆ é™¤åŸæ¡ç›®
listOrder.erase(order_it++);
</code></pre><h4 id=schedulereadyinstså‡½æ•°è§£æ>scheduleReadyInsts()å‡½æ•°è§£æ</h4><pre tabindex=0><code>é¦–å…ˆå¤„ç†è¢«å»¶è¿Ÿæˆ–é˜»å¡çš„å†…å­˜æŒ‡ä»¤
æŒ‰ç…§æŒ‡ä»¤é˜Ÿåˆ—çš„é¡ºåºå°è¯•å‘å°„æŒ‡ä»¤
ä¸ºæ¯æ¡æŒ‡ä»¤åˆ†é…é€‚å½“çš„åŠŸèƒ½å•å…ƒï¼ˆFunctional Unitï¼‰
æ ¹æ®æŒ‡ä»¤ç‰¹æ€§å®‰æ’ç«‹å³æ‰§è¡Œæˆ–å»¶è¿Ÿæ‰§è¡Œ
æ›´æ–°æŒ‡ä»¤çŠ¶æ€å’Œç›¸å…³ç»Ÿè®¡ä¿¡æ¯
</code></pre><p>è°ƒåº¦çš„æ—¶å€™è·å–çš„æ˜¯readyInstæŒ‡ä»¤çš„top</p><p>readyInst æ˜¯åœ¨ä¸€äº›åœ°æ–¹è°ƒç”¨äº† AddIfReady å‡½æ•°è·å–çš„</p><p>AddIfReady æœ‰ä»¥ä¸‹æƒ…æ™¯è¢«è°ƒç”¨</p><ol><li>åœ¨åŠ å…¥æŒ‡ä»¤é˜Ÿåˆ—çš„æ—¶å€™ï¼Œå¦‚æœä¸æ˜¯mem æŒ‡ä»¤ ï¼Œä¼šè°ƒç”¨ addIfReady (insert), åˆ¤æ–­æ˜¯å¦ready</li><li>å½“ä¸€æ¡æŒ‡ä»¤æ‰§è¡Œå®Œæˆä¹‹åï¼Œæ ‡è®°è‡ªå·±çš„ç›®æ ‡å¯„å­˜å™¨ä¸ºå¯ç”¨ ï¼Œ å¹¶å”¤é†’æ‰€æœ‰ä¾èµ–è¯¥å¯„å­˜å™¨çš„æŒ‡ä»¤ ï¼Œ è¿™äº›æŒ‡ä»¤å¦‚æœæ‰€æœ‰æºå¯„å­˜å™¨å°±ç»ªå°±ä¼šæ·»åŠ åˆ°readyInstsé˜Ÿåˆ—ä¸­ ï¼Œ ï¼ˆwakeupDependents)</li><li>å†…å­˜æŒ‡ä»¤åœ¨å¯„å­˜å™¨å°±ç»ªåï¼Œè¿˜éœ€è¦é€šè¿‡å†…å­˜ä¾èµ–å•å…ƒ (MemDepUnit) è§£å†³å¯èƒ½çš„å†…å­˜ä¾èµ–é—®é¢˜ã€‚å½“å†…å­˜ä¾èµ–è§£å†³åï¼Œä¼šé€šè¿‡ <a class=link href=vscode-file://vscode-app/usr/share/code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html>addReadyMemInst</a> å‡½æ•°å°†å†…å­˜æŒ‡ä»¤æ·»åŠ åˆ° <a class=link href=vscode-file://vscode-app/usr/share/code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html>readyInsts</a> é˜Ÿåˆ—</li></ol><p>åœ¨é€‰æ‹©æŒ‡ä»¤çš„æ—¶å€™ï¼Œé€šè¿‡order_list çš„op_class å»è®¿é—®readyInst , è·å–æŒ‡ä»¤ï¼Œ ç„¶åæ›´æ–° order_list ,æŠŠæœ€è€çš„æŒ‡ä»¤æ‹‰å‡ºæ¥ ï¼Œç„¶åå°±æ˜¯è·å–åŠŸèƒ½å•å…ƒ ï¼Œ å…·ä½“ä¼šè·å–åŠŸèƒ½å•å…ƒçš„idx å’Œ latency ,</p><p>å¯¹äºå•å‘¨æœŸçš„æŒ‡ä»¤ ï¼Œ å¯ä»¥åŠ å…¥åˆ°æ‰§è¡Œé˜Ÿåˆ— ï¼Œ ç„¶ååœ¨ä¸‹å‘¨æœŸé‡Šæ”¾ fu ,</p><p>åœ¨ä¸‹å‘¨æœŸé‡Šæ”¾çš„æ–¹æ³•æ¯”è¾ƒç®€å• ï¼Œ å°±æ˜¯è¿™å‘¨æœŸå…ˆåŠ å…¥åˆ°ä¸€ä¸ªé˜Ÿåˆ— ï¼Œ ç„¶åä¸‹å‘¨æœŸé€šè¿‡processFreeUnit è¯»å–é˜Ÿåˆ—çš„å†…å®¹free fu , processFreeUnitæ˜¯åœ¨ schedulereadyinst ä¹‹å‰å°±è°ƒç”¨äº† ï¼Œ æ‰€ä»¥å®Œå…¨å¯è¡Œ ã€‚</p><p>å¯¹äºå¤šå‘¨æœŸçš„æŒ‡ä»¤ ï¼Œ æ˜¯åˆ›å»ºäº†ä¸€ä¸ªäº‹ä»¶ ï¼Œ ç„¶åè®¾ç½®äº‹ä»¶è§¦å‘æ—¶é—´ä¸º op_latency - 1 ï¼Œç„¶ååˆ°äº†è§¦å‘æ—¶é—´ï¼Œæ‰ä¼šæŠŠæŒ‡ä»¤æ”¾åˆ°instsToExecute é˜Ÿåˆ— ï¼Œ æ‰€ä»¥å®ƒçš„å»¶è¿Ÿå®é™…ä¸Šä¸æ˜¯æ‰§è¡Œçš„æ—¶å€™äº§ç”Ÿçš„ï¼Œæ˜¯scheduleåˆ°inststoExecute çš„æ—¶å€™äº§ç”Ÿçš„</p><p>issue çš„æŒ‡ä»¤ä¼šsetIssue()</p><p>æ‰€ä»¥å®ƒçš„å‘å°„é€»è¾‘æ˜¯å°½å¯èƒ½å‘å°„å¤šçš„æŒ‡ä»¤ï¼Œä»readyInsté‡Œï¼Œ è€Œä¸”è¶Šè€çš„æŒ‡ä»¤è¶Šæ—©å‘é€</p><h3 id=movetoyoungerinst>moveToYoungerInst()</h3><p>å½“ä¸€ä¸ªæ“ä½œç±»å‹ï¼ˆOpClassï¼‰çš„å°±ç»ªé˜Ÿåˆ—é¡¶éƒ¨æŒ‡ä»¤å˜åŒ–æ—¶ï¼ˆå¦‚æœ€è€çš„æŒ‡ä»¤è¢«å‘å°„å‡ºå»ï¼‰ï¼Œè¯¥å‡½æ•°è´Ÿè´£é‡æ–°å®šä½è¯¥æ“ä½œç±»å‹åœ¨ <a class=link href=vscode-file://vscode-app/usr/share/code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html>listOrder</a> åˆ—è¡¨ä¸­çš„ä½ç½®ï¼Œç¡®ä¿ä¸åŒæ“ä½œç±»å‹çš„å°±ç»ªé˜Ÿåˆ—æŒ‰ç…§å…¶é¡¶éƒ¨æŒ‡ä»¤çš„åºåˆ—å·ï¼ˆç¨‹åºé¡ºåºï¼‰æ’åºã€‚</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#e5c07b>void</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>InstructionQueue</span><span style=color:#56b6c2>::</span><span style=color:#e06c75>moveToYoungerInst</span>(<span style=color:#e06c75>ListOrderIt</span> <span style=color:#e06c75>list_order_it</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#7f848e>// è·å–ä¸‹ä¸€ä¸ªåˆ—è¡¨é¡¹çš„è¿­ä»£å™¨
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#e06c75>ListOrderIt</span> <span style=color:#e06c75>next_it</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>list_order_it</span>;
</span></span><span style=display:flex><span>    <span style=color:#56b6c2>++</span><span style=color:#e06c75>next_it</span>;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#7f848e>// ä¿å­˜éœ€è¦é‡æ–°å®šä½çš„é˜Ÿåˆ—ç±»å‹
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#e06c75>OpClass</span> <span style=color:#e06c75>op_class</span> <span style=color:#56b6c2>=</span> (<span style=color:#56b6c2>*</span><span style=color:#e06c75>list_order_it</span>).<span style=color:#e06c75>queueType</span>;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#7f848e>// åˆ›å»ºæ–°çš„åˆ—è¡¨æ¡ç›®
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#e06c75>ListOrderEntry</span> <span style=color:#e06c75>queue_entry</span>;
</span></span><span style=display:flex><span>    <span style=color:#e06c75>queue_entry</span>.<span style=color:#e06c75>queueType</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>op_class</span>;
</span></span><span style=display:flex><span>    <span style=color:#e06c75>queue_entry</span>.<span style=color:#e06c75>oldestInst</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>readyInsts</span>[<span style=color:#e06c75>op_class</span>].<span style=color:#e06c75>top</span>()<span style=color:#56b6c2>-&gt;</span><span style=color:#e06c75>seqNum</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#7f848e>// åœ¨åˆ—è¡¨ä¸­å¯»æ‰¾æ­£ç¡®çš„æ’å…¥ä½ç½®
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#7f848e>// å‘åéå†ï¼Œç›´åˆ°æ‰¾åˆ°åºåˆ—å·å¤§äºå½“å‰é˜Ÿåˆ—é¡¶éƒ¨æŒ‡ä»¤çš„ä½ç½®
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#c678dd>while</span> (<span style=color:#e06c75>next_it</span> <span style=color:#56b6c2>!=</span> <span style=color:#e06c75>listOrder</span>.<span style=color:#e06c75>end</span>() <span style=color:#56b6c2>&amp;&amp;</span>
</span></span><span style=display:flex><span>           (<span style=color:#56b6c2>*</span><span style=color:#e06c75>next_it</span>).<span style=color:#e06c75>oldestInst</span> <span style=color:#56b6c2>&lt;</span> <span style=color:#e06c75>queue_entry</span>.<span style=color:#e06c75>oldestInst</span>) {
</span></span><span style=display:flex><span>        <span style=color:#56b6c2>++</span><span style=color:#e06c75>next_it</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#7f848e>// åœ¨æ‰¾åˆ°çš„ä½ç½®æ’å…¥æ–°æ¡ç›®ï¼Œå¹¶æ›´æ–°è¯¥æ“ä½œç±»å‹çš„è¿­ä»£å™¨å¼•ç”¨
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#e06c75>readyIt</span>[<span style=color:#e06c75>op_class</span>] <span style=color:#56b6c2>=</span> <span style=color:#e06c75>listOrder</span>.<span style=color:#e06c75>insert</span>(<span style=color:#e06c75>next_it</span>, <span style=color:#e06c75>queue_entry</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>å‡è®¾æˆ‘ä»¬æœ‰ä»¥ä¸‹çŠ¶æ€ï¼š</p><ol><li>æ•´æ•°æ“ä½œé˜Ÿåˆ—ï¼šåºåˆ—å·ä¸º [100, 110, 120]ï¼ˆæœ€è€æŒ‡ä»¤åºåˆ—å·æ˜¯100ï¼‰</li><li>æµ®ç‚¹æ“ä½œé˜Ÿåˆ—ï¼šåºåˆ—å·ä¸º [105, 115, 125]ï¼ˆæœ€è€æŒ‡ä»¤åºåˆ—å·æ˜¯105ï¼‰</li><li>å½“å‰çš„å‘å°„é¡ºåºåˆ—è¡¨ <a class=link href=vscode-file://vscode-app/usr/share/code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html>listOrder</a>ï¼š[æ•´æ•°é˜Ÿåˆ—, æµ®ç‚¹é˜Ÿåˆ—]ï¼ˆå› ä¸º100 &lt; 105ï¼‰</li></ol><p>ç°åœ¨ï¼Œå¦‚æœæ•´æ•°é˜Ÿåˆ—çš„æœ€è€æŒ‡ä»¤ï¼ˆåºåˆ—å·100ï¼‰è¢«å‘å°„å‡ºå»ï¼Œåˆ™æ•´æ•°é˜Ÿåˆ—å˜ä¸º [110, 120]ï¼Œ<strong>æœ€è€çš„æŒ‡ä»¤å˜æˆäº†åºåˆ—å·110</strong>ã€‚è¿™æ—¶éœ€è¦è°ƒç”¨ <a class=link href=vscode-file://vscode-app/usr/share/code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html>moveToYoungerInst</a> é‡æ–°è°ƒæ•´æ•´æ•°é˜Ÿåˆ—åœ¨ <a class=link href=vscode-file://vscode-app/usr/share/code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html>listOrder</a> ä¸­çš„ä½ç½®ã€‚</p><p>ç”±äº110 > 105ï¼Œè°ƒæ•´åçš„ <a class=link href=vscode-file://vscode-app/usr/share/code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html>listOrder</a> åº”è¯¥å˜æˆ [æµ®ç‚¹é˜Ÿåˆ—, æ•´æ•°é˜Ÿåˆ—]ã€‚</p><h3 id=readyit>readyIt</h3><ol><li><strong>å¿«é€Ÿè®¿é—®</strong>ï¼šæä¾›å¯¹æ¯ä¸ªæ“ä½œç±»å‹åœ¨ <a class=link href=vscode-file://vscode-app/usr/share/code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html>listOrder</a> ä¸­ä½ç½®çš„ç›´æ¥è®¿é—®ï¼Œæ— éœ€éå†æ•´ä¸ª <a class=link href=vscode-file://vscode-app/usr/share/code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html>listOrder</a> åˆ—è¡¨</li><li><strong>ä½ç½®è¿½è¸ª</strong>ï¼šå½“æ“ä½œç±»å‹çš„å°±ç»ªé˜Ÿåˆ—çŠ¶æ€å˜åŒ–æ—¶ï¼Œå¿«é€Ÿæ‰¾åˆ°å¹¶ä¿®æ”¹å®ƒåœ¨å‘å°„é¡ºåºä¸­çš„ä½ç½®</li><li><strong>ä¼˜åŒ–æ€§èƒ½</strong>ï¼šé¿å…åœ¨æ›´æ–°å‘å°„é¡ºåºæ—¶è¿›è¡Œé‡å¤æŸ¥æ‰¾ï¼Œæé«˜è°ƒåº¦æ•ˆç‡</li></ol><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span> <span style=color:#e06c75>readyIt</span>[<span style=color:#e06c75>op_class</span>] <span style=color:#56b6c2>=</span> <span style=color:#e06c75>listOrder</span>.<span style=color:#e06c75>insert</span>(<span style=color:#e06c75>next_it</span>, <span style=color:#e06c75>queue_entry</span>);
</span></span></code></pre></div><p>æ‰€ä»¥ä½¿ç”¨readyIt[op_class]åº”è¯¥å¯ä»¥ç›´æ¥è®¿é—®åˆ°æ’å…¥çš„é‚£ä¸ªè¡¨é¡¹çš„æŒ‡é’ˆ ï¼Œè®¿é—®å°±ä¼šæ¯”è¾ƒæ–¹ä¾¿ï¼Œä¸éœ€è¦é€šè¿‡é“¾è¡¨éå†æ¥å®ç° ï¼Œerase çš„æ—¶å€™ä¹Ÿä¼šæ¯”è¾ƒæ–¹ä¾¿ ã€‚</p><p><figure class=gallery-image style=flex-grow:221;flex-basis:530px><a href=/2025/gem5_o3_learning/image-20250423152137923.png data-size=473x214><img src=/2025/gem5_o3_learning/image-20250423152137923.png width=473 height=214 srcset="/2025/gem5_o3_learning/image-20250423152137923_hu16149300792399966226.png 480w, /2025/gem5_o3_learning/image-20250423152137923_hu8174389800356719600.png 1024w" loading=lazy></a></figure></p><h3 id=instlist>instList</h3><p>instList çš„ä¸»è¦åŠŸèƒ½æ˜¯å­˜å‚¨å’Œè·Ÿè¸ªæ‰€æœ‰åœ¨æŒ‡ä»¤é˜Ÿåˆ—ä¸­çš„æŒ‡ä»¤</p><p>å½“æŒ‡ä»¤ä»é‡å‘½åé˜¶æ®µè¿›å…¥åˆ°æŒ‡ä»¤é˜Ÿåˆ—çš„æ—¶å€™ï¼Œä»–ä»¬è¢«åŠ å…¥åˆ°å¯¹åº”çº¿ç¨‹çš„instListä¸­</p><p><a class=link href=vscode-file://vscode-app/usr/share/code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html>instList</a>ç»´æŠ¤äº†æŒ‡ä»¤æŒ‰ç¨‹åºé¡ºåº(åºåˆ—å·)çš„åˆ—è¡¨ï¼Œè¿™å¯¹äºå®ç°ç²¾ç¡®å¼‚å¸¸å’Œæ­£ç¡®çš„æŒ‡ä»¤æäº¤éå¸¸é‡è¦ï¼ˆcommit æ˜¯æ ¹æ®fromCommit->commitInfo çš„ä¿¡å·åœ¨iewä½œcommit çš„ ï¼‰</p><p><a class=link href=vscode-file://vscode-app/usr/share/code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html>instList</a>åœ¨å¤„ç†åˆ†æ”¯é¢„æµ‹é”™è¯¯ç­‰éœ€è¦åˆ·æ–°æŒ‡ä»¤æµæ°´çº¿çš„æƒ…å†µæ—¶æ‰®æ¼”å…³é”®è§’è‰²ï¼ŒdoSquash æ—¶æ˜¯ä¾èµ–instList çš„</p><h2 id=fu_pool>fu_pool</h2><h3 id=getunit>getUnit</h3><ul><li>é¦–å…ˆæ£€æŸ¥æ± ä¸­æ˜¯å¦æœ‰èƒ½æ‰§è¡Œè¯¥æ“ä½œçš„åŠŸèƒ½å•å…ƒ</li><li>ç„¶ååœ¨å…·æœ‰è¯¥èƒ½åŠ›çš„åŠŸèƒ½å•å…ƒä¸­è½®è¯¢æŸ¥æ‰¾ç©ºé—²å•å…ƒ</li><li>å¦‚æœæ‰¾åˆ°ï¼Œå°†å…¶æ ‡è®°ä¸ºç¹å¿™å¹¶è¿”å›ç´¢å¼•</li><li>è¿”å›å€¼ï¼š<ul><li>åŠŸèƒ½å•å…ƒç´¢å¼•ï¼ˆâ‰¥0ï¼‰ï¼šæˆåŠŸåˆ†é…åŠŸèƒ½å•å…ƒ</li><li><a class=link href=vscode-file://vscode-app/usr/share/code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html>NoCapableFU</a> (-2)ï¼šæ± ä¸­æ²¡æœ‰èƒ½æ‰§è¡Œè¯¥æ“ä½œç±»å‹çš„åŠŸèƒ½å•å…ƒ</li><li><a class=link href=vscode-file://vscode-app/usr/share/code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html>NoFreeFU</a> (-1)ï¼šæœ‰èƒ½åŠ›ä½†å½“å‰éƒ½åœ¨ä½¿ç”¨ä¸­</li></ul></li></ul><p>æ˜¯å¦æœ‰æ‰§è¡Œè¯¥åŠŸèƒ½æ˜¯ç»è¿‡é…ç½®çš„ ï¼Œ å¯ä»¥é€šè¿‡python æ¥è¿›è¡Œç›¸åº”çš„é…ç½®</p><h3 id=fupercaplist>fuPerCapList</h3><p>FuPerCapListæ˜¯ä¸€ä¸ªå‘é‡ ï¼Œ å¯ä»¥é€šè¿‡op_class è¿›è¡Œç´¢å¼• ï¼Œ</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#c678dd>class</span> <span style=color:#e5c07b>FUIdxQueue</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#c678dd>private</span><span style=color:#56b6c2>:</span>
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>int</span> <span style=color:#e06c75>idx</span>;                      <span style=color:#7f848e>// å½“å‰ç´¢å¼•ä½ç½®
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#e5c07b>int</span> <span style=color:#e06c75>size</span>;                     <span style=color:#7f848e>// é˜Ÿåˆ—å¤§å°
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#e06c75>std</span><span style=color:#56b6c2>::</span><span style=color:#e06c75>vector</span><span style=color:#56b6c2>&lt;</span><span style=color:#e5c07b>int</span><span style=color:#56b6c2>&gt;</span> <span style=color:#e06c75>funcUnitsIdx</span>; <span style=color:#7f848e>// åŠŸèƒ½å•å…ƒç´¢å¼•å‘é‡
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    
</span></span><span style=display:flex><span>  <span style=color:#c678dd>public</span><span style=color:#56b6c2>:</span>
</span></span><span style=display:flex><span>    <span style=color:#7f848e>// ...æ–¹æ³•å®šä¹‰...
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>};
</span></span></code></pre></div><p>funcUnitsIdx æœ‰å¤šå¤§å°±ä»£è¡¨æœ‰å¤šå°‘ä¸ªæ‰§è¡Œå•å…ƒ ï¼Œ funcUnitsIdx [i] æ˜¯é€’å¢çš„ï¼Œä½†æ˜¯æœ‰ä¸€ä¸‹å¯¹åº”çš„æ˜¯åŒä¸€ä¸ªåºå· ï¼Œ</p><p>ä¸åŒçš„åºå·ä»£è¡¨ä¸åŒçš„æ‰§è¡Œå•å…ƒï¼Œæ‰€ä»¥funcUnitsIdx çš„å¤§å°æ€»æ•° æ˜¯ > æ‰§è¡Œå•å…ƒçš„æ•°é‡çš„</p><p>æ¯”æ–¹è¯´ IntMult å’Œ IntDiv æ˜¯ä¸åŒçš„op_class , ä½†æ˜¯å®é™…ä¸Šæ˜¯ç”¨çš„åŒä¸€ä¸ªæ‰§è¡Œå•å…ƒ</p><p><figure class=gallery-image style=flex-grow:32;flex-basis:76px><a href=/2025/gem5_o3_learning/image-20250423161351759.png data-size=214x668><img src=/2025/gem5_o3_learning/image-20250423161351759.png width=214 height=668 srcset="/2025/gem5_o3_learning/image-20250423161351759_hu13371034812060869134.png 480w, /2025/gem5_o3_learning/image-20250423161351759_hu4606734674716903772.png 1024w" loading=lazy></a></figure></p><div class=table-wrapper><table><thead><tr><th style=text-align:left>åŠŸèƒ½å•å…ƒç±»å‹</th><th style=text-align:left>æ“ä½œç±»å‹</th><th style=text-align:left>å»¶è¿Ÿ(å‘¨æœŸ)</th><th style=text-align:left>æ˜¯å¦æµæ°´çº¿</th><th style=text-align:left>å•å…ƒæ•°é‡</th></tr></thead><tbody><tr><td style=text-align:left><strong>IntALU</strong></td><td style=text-align:left>IntAlu</td><td style=text-align:left>1 (é»˜è®¤)</td><td style=text-align:left>æ˜¯ (é»˜è®¤)</td><td style=text-align:left>6</td></tr><tr><td style=text-align:left><strong>IntMultDiv</strong></td><td style=text-align:left>IntMult</td><td style=text-align:left>3</td><td style=text-align:left>æ˜¯ (é»˜è®¤)</td><td style=text-align:left>2</td></tr><tr><td style=text-align:left></td><td style=text-align:left>IntDiv</td><td style=text-align:left>20</td><td style=text-align:left>å¦</td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>FP_ALU</strong></td><td style=text-align:left>FloatAdd</td><td style=text-align:left>2</td><td style=text-align:left>æ˜¯ (é»˜è®¤)</td><td style=text-align:left>4</td></tr><tr><td style=text-align:left></td><td style=text-align:left>FloatCmp</td><td style=text-align:left>2</td><td style=text-align:left>æ˜¯ (é»˜è®¤)</td><td style=text-align:left></td></tr><tr><td style=text-align:left></td><td style=text-align:left>FloatCvt</td><td style=text-align:left>2</td><td style=text-align:left>æ˜¯ (é»˜è®¤)</td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>FP_MultDiv</strong></td><td style=text-align:left>FloatMult</td><td style=text-align:left>4</td><td style=text-align:left>æ˜¯ (é»˜è®¤)</td><td style=text-align:left>2</td></tr><tr><td style=text-align:left></td><td style=text-align:left>FloatMultAcc</td><td style=text-align:left>5</td><td style=text-align:left>æ˜¯ (é»˜è®¤)</td><td style=text-align:left></td></tr><tr><td style=text-align:left></td><td style=text-align:left>FloatMisc</td><td style=text-align:left>3</td><td style=text-align:left>æ˜¯ (é»˜è®¤)</td><td style=text-align:left></td></tr><tr><td style=text-align:left></td><td style=text-align:left>FloatDiv</td><td style=text-align:left>12</td><td style=text-align:left>å¦</td><td style=text-align:left></td></tr><tr><td style=text-align:left></td><td style=text-align:left>FloatSqrt</td><td style=text-align:left>24</td><td style=text-align:left>å¦</td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>SIMD_Unit</strong></td><td style=text-align:left>SimdAdd</td><td style=text-align:left>1 (é»˜è®¤)</td><td style=text-align:left>æ˜¯ (é»˜è®¤)</td><td style=text-align:left>4</td></tr><tr><td style=text-align:left></td><td style=text-align:left>SimdAddAcc</td><td style=text-align:left>1 (é»˜è®¤)</td><td style=text-align:left>æ˜¯ (é»˜è®¤)</td><td style=text-align:left></td></tr><tr><td style=text-align:left></td><td style=text-align:left>SimdAlu</td><td style=text-align:left>1 (é»˜è®¤)</td><td style=text-align:left>æ˜¯ (é»˜è®¤)</td><td style=text-align:left></td></tr><tr><td style=text-align:left></td><td style=text-align:left>SimdCmp</td><td style=text-align:left>1 (é»˜è®¤)</td><td style=text-align:left>æ˜¯ (é»˜è®¤)</td><td style=text-align:left></td></tr><tr><td style=text-align:left></td><td style=text-align:left>SimdCvt</td><td style=text-align:left>1 (é»˜è®¤)</td><td style=text-align:left>æ˜¯ (é»˜è®¤)</td><td style=text-align:left></td></tr><tr><td style=text-align:left></td><td style=text-align:left>SimdMisc</td><td style=text-align:left>1 (é»˜è®¤)</td><td style=text-align:left>æ˜¯ (é»˜è®¤)</td><td style=text-align:left></td></tr><tr><td style=text-align:left></td><td style=text-align:left>SimdMult</td><td style=text-align:left>1 (é»˜è®¤)</td><td style=text-align:left>æ˜¯ (é»˜è®¤)</td><td style=text-align:left></td></tr><tr><td style=text-align:left></td><td style=text-align:left>å…¶ä»–SIMDæ“ä½œ&mldr;</td><td style=text-align:left>1 (é»˜è®¤)</td><td style=text-align:left>æ˜¯ (é»˜è®¤)</td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>Matrix_Unit</strong></td><td style=text-align:left>Matrix</td><td style=text-align:left>1 (é»˜è®¤)</td><td style=text-align:left>æ˜¯ (é»˜è®¤)</td><td style=text-align:left>1</td></tr><tr><td style=text-align:left></td><td style=text-align:left>MatrixMov</td><td style=text-align:left>1 (é»˜è®¤)</td><td style=text-align:left>æ˜¯ (é»˜è®¤)</td><td style=text-align:left></td></tr><tr><td style=text-align:left></td><td style=text-align:left>MatrixOP</td><td style=text-align:left>1 (é»˜è®¤)</td><td style=text-align:left>æ˜¯ (é»˜è®¤)</td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>PredALU</strong></td><td style=text-align:left>SimdPredAlu</td><td style=text-align:left>1 (é»˜è®¤)</td><td style=text-align:left>æ˜¯ (é»˜è®¤)</td><td style=text-align:left>1</td></tr><tr><td style=text-align:left><strong>ReadPort</strong></td><td style=text-align:left>MemRead</td><td style=text-align:left>1 (é»˜è®¤)</td><td style=text-align:left>æ˜¯ (é»˜è®¤)</td><td style=text-align:left>0</td></tr><tr><td style=text-align:left></td><td style=text-align:left>FloatMemRead</td><td style=text-align:left>1 (é»˜è®¤)</td><td style=text-align:left>æ˜¯ (é»˜è®¤)</td><td style=text-align:left></td></tr><tr><td style=text-align:left></td><td style=text-align:left>SimdUnitStrideLoad</td><td style=text-align:left>1 (é»˜è®¤)</td><td style=text-align:left>æ˜¯ (é»˜è®¤)</td><td style=text-align:left></td></tr><tr><td style=text-align:left></td><td style=text-align:left>å…¶ä»–è¯»æ“ä½œ&mldr;</td><td style=text-align:left>1 (é»˜è®¤)</td><td style=text-align:left>æ˜¯ (é»˜è®¤)</td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>WritePort</strong></td><td style=text-align:left>MemWrite</td><td style=text-align:left>1 (é»˜è®¤)</td><td style=text-align:left>æ˜¯ (é»˜è®¤)</td><td style=text-align:left>0</td></tr><tr><td style=text-align:left></td><td style=text-align:left>FloatMemWrite</td><td style=text-align:left>1 (é»˜è®¤)</td><td style=text-align:left>æ˜¯ (é»˜è®¤)</td><td style=text-align:left></td></tr><tr><td style=text-align:left></td><td style=text-align:left>SimdUnitStrideStore</td><td style=text-align:left>1 (é»˜è®¤)</td><td style=text-align:left>æ˜¯ (é»˜è®¤)</td><td style=text-align:left></td></tr><tr><td style=text-align:left></td><td style=text-align:left>å…¶ä»–å†™æ“ä½œ&mldr;</td><td style=text-align:left>1 (é»˜è®¤)</td><td style=text-align:left>æ˜¯ (é»˜è®¤)</td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>RdWrPort</strong></td><td style=text-align:left>MemRead/Write</td><td style=text-align:left>1 (é»˜è®¤)</td><td style=text-align:left>æ˜¯ (é»˜è®¤)</td><td style=text-align:left>4</td></tr><tr><td style=text-align:left></td><td style=text-align:left>FloatMemRead/Write</td><td style=text-align:left>1 (é»˜è®¤)</td><td style=text-align:left>æ˜¯ (é»˜è®¤)</td><td style=text-align:left></td></tr><tr><td style=text-align:left></td><td style=text-align:left>æ‰€æœ‰SIMDè¯»å†™æ“ä½œ</td><td style=text-align:left>1 (é»˜è®¤)</td><td style=text-align:left>æ˜¯ (é»˜è®¤)</td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>IprPort</strong></td><td style=text-align:left>IprAccess</td><td style=text-align:left>3</td><td style=text-align:left>å¦</td><td style=text-align:left>1</td></tr></tbody></table></div><h2 id=lsq>LSQ</h2><h3 id=lsqcheckviolations>LSQ::checkViolations</h3><p>æ£€æŸ¥å†…å­˜ä¾èµ–å†²çªï¼Œæ£€æŸ¥åœ°å€èŒƒå›´é‡å ï¼Œ å¯¹äºåŠ è½½ï¼Œæ ‡è®°å¯èƒ½çš„ä¾èµ–è¿å ï¼Œ å¯¹äºå­˜å‚¨ï¼Œæ ‡è®°æ˜¯å¦æœ‰åŠ è½½æŒ‡ä»¤é”™è¯¯çš„å…ˆäºå®ƒæ‰§è¡Œ</p><h2 id=o3-æŒ‡ä»¤çš„squash>o3 æŒ‡ä»¤çš„squash</h2><h3 id=squash-è°ƒç”¨>squash è°ƒç”¨</h3><h4 id=ä»commit-é˜¶æ®µå‡ºå‘çš„squash>ä»commit é˜¶æ®µå‡ºå‘çš„squash</h4><ol><li><p><a class=link href=vscode-file://vscode-app/usr/share/code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html>Commit::squashAll(ThreadID tid)</a> - åœ¨æäº¤é˜¶æ®µè§¦å‘çš„å…¨é¢squash</p></li><li><p><a class=link href=vscode-file://vscode-app/usr/share/code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html>IEW::checkSignalsAndUpdate(ThreadID tid)</a> - æ¥æ”¶å¹¶å¤„ç†æ¥è‡ªCommitçš„squashä¿¡å·</p></li><li><p><a class=link href=vscode-file://vscode-app/usr/share/code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html>IEW::squash(ThreadID tid)</a> - åœ¨æ‰§è¡Œé˜¶æ®µå¤„ç†squash</p></li></ol><h4 id=ä»åˆ†æ”¯é¢„æµ‹é”™è¯¯è§¦å‘çš„squash>ä»åˆ†æ”¯é¢„æµ‹é”™è¯¯è§¦å‘çš„squash</h4><ol><li><a class=link href=vscode-file://vscode-app/usr/share/code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html>IEW::squashDueToBranch(const DynInstPtr& inst, ThreadID tid)</a> - åˆ†æ”¯é¢„æµ‹é”™è¯¯è§¦å‘squash</li><li><code>BPredUnit::squash(const InstSeqNum &amp;squashed_sn, ...)</code> - åˆ†æ”¯é¢„æµ‹å™¨å¤„ç†squash</li></ol><h4 id=ä»å†…å­˜é¡ºåºé”™è¯¯è§¦å‘çš„squash>ä»å†…å­˜é¡ºåºé”™è¯¯è§¦å‘çš„squash</h4><ol><li><a class=link href=vscode-file://vscode-app/usr/share/code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html>IEW::squashDueToMemOrder(const DynInstPtr& inst, ThreadID tid)</a> - å†…å­˜é¡ºåºè¿åè§¦å‘squash</li></ol><h4 id=fetch-é˜¶æ®µçš„squash>fetch é˜¶æ®µçš„squash</h4><p>ä»æäº¤é˜¶æ®µå‘æ¥çš„squashä¿¡å·ï¼Œé€šå¸¸ç”±åˆ†æ”¯é¢„æµ‹é”™è¯¯æˆ–å†…å­˜ä¾èµ–è¿åè§¦å‘ã€‚
ä»è§£ç é˜¶æ®µå‘æ¥çš„squashä¿¡å·ï¼Œä¾‹å¦‚ç”±è¯‘ç é˜¶æ®µæ£€æµ‹åˆ°çš„æŒ‡ä»¤æ ¼å¼é”™è¯¯è§¦å‘ã€‚</p><p>è¿™æ˜¯å®é™…æ‰§è¡Œsquashæ“ä½œçš„æ ¸å¿ƒå‡½æ•°ï¼ŒdoSquash</p><ol><li>æ›´æ–°PC</li><li>é‡ç½®è§£ç å™¨</li><li>æ¸…é™¤æœªå®Œæˆçš„ç¼“å­˜è®¿é—®</li><li>æ¸…ç©ºfetché˜Ÿåˆ—(fetché˜Ÿåˆ—ä¼šä¼ è¾“åˆ°toDecodeé˜Ÿåˆ—ï¼Œç„¶åä¼ é€’ç»™decode)</li><li>æ›´æ–°ç»Ÿè®¡è®¡æ•°å™¨</li></ol><p>åœ¨checkSignalsAndUpdateçš„æ—¶å€™ä¼šå»è°ƒç”¨squash , å¦‚æœ fromCommit->commitInfo.squash(è¿™æ˜¯å…¶ä¸­ä¸€ç§æƒ…å†µ)ï¼Œdeocde, iew (è¿˜æœ‰ä¸€ç§æ˜¯robSquashing), rename åªæœ‰è¿™ä¸€ç§æƒ…å†µ(éƒ½æ˜¯ä»commit é‚£è¾¹ä¼ é€’è¿‡æ¥çš„squash ä¿¡å·) ï¼Œ fetch æœ‰commit , decode å¯¼è‡´çš„squash</p><p>å¯¹äºiew å¯¼è‡´çš„squash , ä¼šè°ƒç”¨instQueue.squash å’Œ ldstQueue.squash , ç„¶åè¿˜æ˜¯è¦æ¸…ç©ºRenameInst é˜Ÿåˆ—ä¸­çš„æ•°æ®ï¼ˆå°±æ˜¯ä»renameä¼ é€’è¿‡æ¥çš„)ï¼Œ</p><h2 id=æŒ‡ä»¤çš„seqnum>æŒ‡ä»¤çš„seqNum</h2><p>åºåˆ—å·çš„å®é™…é€’å¢å’Œåˆ†é…å‘ç”Ÿåœ¨CPUçš„Fetché˜¶æ®µ</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#7f848e>// src/cpu/o3/fetch_impl.hh
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span><span style=color:#c678dd>template</span> <span style=color:#56b6c2>&lt;</span><span style=color:#c678dd>class</span> <span style=color:#e5c07b>Impl</span><span style=color:#56b6c2>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>void</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>DefaultFetch</span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>Impl</span><span style=color:#56b6c2>&gt;::</span><span style=color:#e06c75>fetch</span>(<span style=color:#e06c75>ThreadID</span> <span style=color:#e06c75>tid</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#7f848e>// ...
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    <span style=color:#c678dd>while</span> (...) {
</span></span><span style=display:flex><span>        <span style=color:#7f848e>// è·å–æ–°çš„åºåˆ—å·
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>        <span style=color:#e06c75>InstSeqNum</span> <span style=color:#e06c75>seq</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>cpu</span><span style=color:#56b6c2>-&gt;</span><span style=color:#e06c75>getAndIncrementInstSeq</span>();
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#7f848e>// åˆ›å»ºæ–°çš„åŠ¨æ€æŒ‡ä»¤å¹¶åˆ†é…åºåˆ—å·
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>        <span style=color:#e06c75>DynInstPtr</span> <span style=color:#e06c75>instruction</span> <span style=color:#56b6c2>=</span> <span style=color:#c678dd>new</span> <span style=color:#e06c75>DynInst</span>(
</span></span><span style=display:flex><span>            <span style=color:#e06c75>staticInst</span>, <span style=color:#e06c75>curMacroop</span>, <span style=color:#e06c75>pc</span>, <span style=color:#e06c75>nextPC</span>, <span style=color:#e06c75>seq</span>, <span style=color:#e06c75>cpu</span>);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#7f848e>// ...
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>    }
</span></span><span style=display:flex><span>    <span style=color:#7f848e>// ...
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>}
</span></span></code></pre></div><p>åºåˆ—å·åœ¨CPUçš„å¤šä¸ªç»„ä»¶ä¸­ç”¨äºï¼š</p><ol><li><strong>ç¡®å®šç¨‹åºé¡ºåº</strong>ï¼šå°½ç®¡æŒ‡ä»¤å¯èƒ½ä¹±åºæ‰§è¡Œï¼Œä½†é€šè¿‡åºåˆ—å·å¯ä»¥ç¡®å®šåŸå§‹ç¨‹åºé¡ºåº</li><li><strong>è¯†åˆ«ä¾èµ–å…³ç³»</strong>ï¼šè¾ƒæ—©çš„æŒ‡ä»¤(è¾ƒå°çš„åºåˆ—å·)å¯èƒ½è¢«è¾ƒæ™šçš„æŒ‡ä»¤(è¾ƒå¤§çš„åºåˆ—å·)ä¾èµ–</li><li><strong>åˆ†æ”¯é¢„æµ‹æ¢å¤</strong>ï¼šåœ¨åˆ†æ”¯é¢„æµ‹é”™è¯¯æ—¶ï¼Œå¯ä»¥ç¡®å®šå“ªäº›æŒ‡ä»¤éœ€è¦è¢«ä¸¢å¼ƒ(åºåˆ—å·å¤§äºé”™è¯¯åˆ†æ”¯çš„æŒ‡ä»¤)</li><li><strong>ç²¾ç¡®å¼‚å¸¸å¤„ç†</strong>ï¼šç¡®ä¿åªæœ‰åºåˆ—å·å°äºæˆ–ç­‰äºå¼•å‘å¼‚å¸¸æŒ‡ä»¤çš„æŒ‡ä»¤è¢«æäº¤</li></ol><h2 id=é™„å½•>é™„å½•</h2><h3 id=å‚è€ƒæ–‡çŒ®>å‚è€ƒæ–‡çŒ®</h3><p><a class=link href=https://www.icfgblog.com/index.php/riscv/351.html target=_blank rel=noopener>https://www.icfgblog.com/index.php/riscv/351.html</a></p><p><a class=link href=https://jianyue.tech/posts/gem5/ target=_blank rel=noopener>https://jianyue.tech/posts/gem5/</a></p><p><a class=link href=https://blog.csdn.net/ivy_reny/article/details/54289190 target=_blank rel=noopener>https://blog.csdn.net/ivy_reny/article/details/54289190</a></p><p><a class=link href=https://zhuanlan.zhihu.com/p/702348447 target=_blank rel=noopener>gem5 c++/python co-binding</a></p><p><a class=link href=https://deep-learning.feishu.cn/wiki/YAmkwBlzkiTGlnkQQXMctS1bnse target=_blank rel=noopener>https://deep-learning.feishu.cn/wiki/YAmkwBlzkiTGlnkQQXMctS1bnse</a></p><p><a class=link href=https://zhuanlan.zhihu.com/p/495960488 target=_blank rel=noopener>gem5æŒ‡ä»¤å®šä¹‰å®ç°å‰–æ</a></p><p><a class=link href=https://zhuanlan.zhihu.com/p/350219725 target=_blank rel=noopener>gem5å¦‚ä½•å¤„ç†ä¸å®šé•¿æŒ‡ä»¤</a></p><p><a class=link href=https://zhuanlan.zhihu.com/p/649049616 target=_blank rel=noopener>gem5 æºç é˜…è¯»timebuff</a></p><p><a class=link href=https://zhuanlan.zhihu.com/p/587079919 target=_blank rel=noopener>gem5 event</a></p><p>649f680 10d60 access to int register 22 has data 0x7fffffffffd60</p><p>4294</p><p>ä¸­é—´è¦æ˜¯æœ‰s</p></section><footer class=article-footer><section class=article-tags></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-contents--wrapper><h2 class=section-title>Related contents</h2><div class=related-contents><div class="flex article-list--tile"><article><a href=/2024/gem5_learning/><div class=article-details><h2 class=article-title>Gem5_learning</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{DISQUS&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><script>(function(e,t){var s=document,o="script",n=s.createElement(o),i=s.getElementsByTagName(o)[0];n.src=e,t&&n.addEventListener("load",function(e){t(e)}),i.parentNode.insertBefore(n,i)})("//cdn.bootcss.com/pangu/3.3.0/pangu.min.js",function(){pangu.spacingPage()})</script><section class=copyright>&copy;
2023 -
2025 <a href=https://stack-theme-mod.vercel.app/>vastcircle</a>Â·<i class="fas fa-bell"></i> <a id=days>0</a>Days<br>å…±ä¹¦å†™äº†394.9kå­—Â·å…± 103ç¯‡æ–‡ç« </br><span><p></section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.2.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a><br><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh target=_blank>Â© Licensed Under CC BY-NC-SA 4.0</a></section><script>var days,number_of_days,s1="2024-10-06",s1=new Date(s1.replace(/-/g,"/"));s2=new Date,days=s2.getTime()-s1.getTime(),number_of_days=parseInt(days/(1e3*60*60*24)),document.getElementById("days").innerHTML=number_of_days</script></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><form action=/search/ class="search-form widget"><p><label>Search</label>
<input name=keyword required placeholder="Type something...">
<button title=Search><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg></button></p></form><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#gem5-çš„å¯åŠ¨æµç¨‹>gem5 çš„å¯åŠ¨æµç¨‹</a></li><li><a href=#ä»¿çœŸå‰çš„åˆå§‹åŒ–>ä»¿çœŸå‰çš„åˆå§‹åŒ–</a></li><li><a href=#è®¡ç®—æŒ‡ä»¤>è®¡ç®—æŒ‡ä»¤</a></li><li><a href=#è®¿å­˜æŒ‡ä»¤>è®¿å­˜æŒ‡ä»¤</a><ol><li><a href=#load-æŒ‡ä»¤>load æŒ‡ä»¤</a></li><li><a href=#store-æŒ‡ä»¤>store æŒ‡ä»¤</a></li><li><a href=#memory-order-fail>memory order fail</a></li></ol></li><li><a href=#staticinst>staticinst</a></li><li><a href=#dyninsts>DynInsts</a></li><li><a href=#rename>rename</a><ol><li><ol><li><a href=#æ­£å¸¸é‡å‘½å><strong>æ­£å¸¸é‡å‘½å</strong></a></li><li><a href=#é’‰ä½å¯„å­˜å™¨é‡å‘½å><strong>é’‰ä½å¯„å­˜å™¨é‡å‘½å</strong></a></li></ol></li></ol></li><li><a href=#gem5-timebuff>gem5 timebuff</a><ol><li><a href=#wire>wire</a></li><li><a href=#advance>advance()</a></li><li><a href=#wire-getwireint-idx>wire getWire(int idx)</a></li><li><a href=#t-accessint-idx>T *access(int idx)</a></li><li><a href=#timebuff-å»¶è¿Ÿæ¨¡å‹>TimeBuff å»¶è¿Ÿæ¨¡å‹</a></li></ol></li><li><a href=#gem5-event>gem5 event</a><ol><li><a href=#role>role</a></li><li><a href=#event-queue>Event Queue</a></li></ol></li><li><a href=#o3-æµæ°´çº¿çš„è¯¦ç»†åˆ†æ>o3 æµæ°´çº¿çš„è¯¦ç»†åˆ†æ</a><ol><li><a href=#ä»¥æŸä¸€æ¡æŒ‡ä»¤ä¸ºä¾‹å­>ä»¥æŸä¸€æ¡æŒ‡ä»¤ä¸ºä¾‹å­</a></li><li><a href=#iew>iew</a></li><li><a href=#commit>commit</a></li></ol></li><li><a href=#gem5-æµæ°´çº¿çš„çŠ¶æ€æ§åˆ¶>gem5 æµæ°´çº¿çš„çŠ¶æ€æ§åˆ¶</a><ol><li><a href=#ä¸€æ¡load-æŒ‡ä»¤çš„æ‰€æœ‰-log>ä¸€æ¡load æŒ‡ä»¤çš„æ‰€æœ‰ log</a></li><li><a href=#mem_dep_unit>mem_dep_unit</a></li></ol></li><li><a href=#inst_queue>inst_queue</a><ol><li><a href=#list_order>list_order</a><ol><li><a href=#schedulereadyinstså‡½æ•°è§£æ>scheduleReadyInsts()å‡½æ•°è§£æ</a></li></ol></li><li><a href=#movetoyoungerinst>moveToYoungerInst()</a></li><li><a href=#readyit>readyIt</a></li><li><a href=#instlist>instList</a></li></ol></li><li><a href=#fu_pool>fu_pool</a><ol><li><a href=#getunit>getUnit</a></li><li><a href=#fupercaplist>fuPerCapList</a></li></ol></li><li><a href=#lsq>LSQ</a><ol><li><a href=#lsqcheckviolations>LSQ::checkViolations</a></li></ol></li><li><a href=#o3-æŒ‡ä»¤çš„squash>o3 æŒ‡ä»¤çš„squash</a><ol><li><a href=#squash-è°ƒç”¨>squash è°ƒç”¨</a><ol><li><a href=#ä»commit-é˜¶æ®µå‡ºå‘çš„squash>ä»commit é˜¶æ®µå‡ºå‘çš„squash</a></li><li><a href=#ä»åˆ†æ”¯é¢„æµ‹é”™è¯¯è§¦å‘çš„squash>ä»åˆ†æ”¯é¢„æµ‹é”™è¯¯è§¦å‘çš„squash</a></li><li><a href=#ä»å†…å­˜é¡ºåºé”™è¯¯è§¦å‘çš„squash>ä»å†…å­˜é¡ºåºé”™è¯¯è§¦å‘çš„squash</a></li><li><a href=#fetch-é˜¶æ®µçš„squash>fetch é˜¶æ®µçš„squash</a></li></ol></li></ol></li><li><a href=#æŒ‡ä»¤çš„seqnum>æŒ‡ä»¤çš„seqNum</a></li><li><a href=#é™„å½•>é™„å½•</a><ol><li><a href=#å‚è€ƒæ–‡çŒ®>å‚è€ƒæ–‡çŒ®</a></li></ol></li></ol></nav></div></section><section class="widget categories"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-infinity" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M9.828 9.172a4 4 0 100 5.656A10 10 0 0012 12a10 10 0 012.172-2.828 4 4 0 110 5.656A10 10 0 0112 12 10 10 0 009.828 9.172"/></svg></div><h2 class="widget-title section-title">Categories</h2><div class=widget-categories--list><div class=widget><h3 class=widget-title></h3><div class=widget-body><div class=category-list><div class=category-list-item><a href=https://VastCircle.github.io/categories/boom/ class=category-list-link>boom<span class=category-list-count>2</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/boom%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB/ class=category-list-link>boomä»£ç é˜…è¯»<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/c++/ class=category-list-link>c++<span class=category-list-count>3</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/cache/ class=category-list-link>cache<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/chipyard/ class=category-list-link>chipyard<span class=category-list-count>3</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/chisel/ class=category-list-link>chisel<span class=category-list-count>2</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/cpu%E5%9F%BA%E7%A1%80/ class=category-list-link>cpuåŸºç¡€<span class=category-list-count>2</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/gem5/ class=category-list-link>gem5<span class=category-list-count>5</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/gpgpu%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/ class=category-list-link>gpgpuè¯»ä¹¦ç¬”è®°<span class=category-list-count>2</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/linux/ class=category-list-link>linux<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/prefetch/ class=category-list-link>prefetch<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/riscv/ class=category-list-link>riscv<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/rocket-chip/ class=category-list-link>rocket-chip<span class=category-list-count>2</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/runahead/ class=category-list-link>runahead<span class=category-list-count>3</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB/ class=category-list-link>ä»£ç é˜…è¯»<span class=category-list-count>2</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E5%88%86%E6%94%AF%E9%A2%84%E6%B5%8B/ class=category-list-link>åˆ†æ”¯é¢„æµ‹<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/ class=category-list-link>åšå®¢æ­å»º<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/ class=category-list-link>åŸºç¡€æ¦‚å¿µ<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E5%A4%84%E7%90%86%E5%99%A8/ class=category-list-link>å¤„ç†å™¨<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/ class=category-list-link>æ“ä½œç³»ç»Ÿ<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E7%8E%AF%E5%A2%83/ class=category-list-link>ç¯å¢ƒ<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/ class=category-list-link>ç¯å¢ƒæ­å»º<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/ class=category-list-link>ç¯å¢ƒé…ç½®<span class=category-list-count>5</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7/ class=category-list-link>ç¼“å­˜ä¸€è‡´æ€§<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/ class=category-list-link>è®ºæ–‡é˜…è¯»<span class=category-list-count>17</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E8%AE%BF%E5%AD%98/ class=category-list-link>è®¿å­˜<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E8%B6%85%E6%A0%87%E9%87%8F%E5%A4%84%E7%90%86%E5%99%A8/ class=category-list-link>è¶…æ ‡é‡å¤„ç†å™¨<span class=category-list-count>12</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E9%A6%99%E5%B1%B1/ class=category-list-link>é¦™å±±<span class=category-list-count>8</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E9%A6%99%E5%B1%B1%E6%BA%90%E4%BB%A3%E7%A0%81/ class=category-list-link>é¦™å±±æºä»£ç <span class=category-list-count>3</a></span></div></div></div></div></div></section><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-infinity" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M9.828 9.172a4 4 0 100 5.656A10 10 0 0012 12a10 10 0 012.172-2.828 4 4 0 110 5.656A10 10 0 0112 12 10 10 0 009.828 9.172"/></svg></div><h2 class="widget-title section-title">Archives</h2><div class=widget-archive--list><div class=archives-year><a href=/archives/#2025><span class=year>2025</span>
<span class=count>55</span></a></div><div class=archives-year><a href=/archives/#2024><span class=year>2024</span>
<span class=count>47</span></a></div></div></section><section class="widget tagCloud"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11 3l9 9a1.5 1.5.0 010 2l-6 6a1.5 1.5.0 01-2 0L3 11V7a4 4 0 014-4h4"/><circle cx="9" cy="9" r="2"/></svg></div><h2 class="widget-title section-title">Tags</h2><div class=tagCloud-tags><a href=/tags/runahead/ class=font_size_6>Runahead
</a><a href=/tags/prefetch/ class=font_size_4>Prefetch
</a><a href=/tags/vector/ class=font_size_3>Vector
</a><a href=/tags/cache/ class=font_size_2>Cache
</a><a href=/tags/chipyard/ class=font_size_2>Chipyard
</a><a href=/tags/diplomacy/ class=font_size_2>Diplomacy
</a><a href=/tags/in-order/ class=font_size_2>In-Order
</a><a href=/tags/rocket-chip/ class=font_size_2>Rocket-Chip
</a><a href=/tags/%E5%88%86%E6%94%AF%E9%A2%84%E6%B5%8B/ class=font_size_2>åˆ†æ”¯é¢„æµ‹
</a><a href=/tags/%E5%AF%84%E5%AD%98%E5%99%A8%E9%87%8D%E5%91%BD%E5%90%8D/ class=font_size_2>å¯„å­˜å™¨é‡å‘½å</a></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>