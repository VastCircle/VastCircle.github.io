<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='DVR的思路 1.discover mode
RPT : ( pc : 40 addr : 40 stride : 16 state : 2 最内层检测位 : 1)
DVR是引入了一个子线程，线程是跑在同一个内核里的， 所以它多搞了一组寄存器 ，用来实现SIMT , 单指令多线程
'><title>Prefetch的一些小思考</title>
<link rel=canonical href=https://VastCircle.github.io/2025/prefetch%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%80%9D%E8%80%83/><link rel=stylesheet href=/scss/style.min.46208cabd58e8bcef0cfb7d7ea6b561adcca3b91dd1fc6657493a44f03c5db75.css><meta property='og:title' content='Prefetch的一些小思考'><meta property='og:description' content='DVR的思路 1.discover mode
RPT : ( pc : 40 addr : 40 stride : 16 state : 2 最内层检测位 : 1)
DVR是引入了一个子线程，线程是跑在同一个内核里的， 所以它多搞了一组寄存器 ，用来实现SIMT , 单指令多线程
'><meta property='og:url' content='https://VastCircle.github.io/2025/prefetch%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%80%9D%E8%80%83/'><meta property='og:site_name' content="VastCircle's blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content><meta property='article:published_time' content='2025-01-22T16:44:10+08:00'><meta property='article:modified_time' content='2025-01-22T16:44:10+08:00'><meta name=twitter:title content="Prefetch的一些小思考"><meta name=twitter:description content="DVR的思路 1.discover mode
RPT : ( pc : 40 addr : 40 stride : 16 state : 2 最内层检测位 : 1)
DVR是引入了一个子线程，线程是跑在同一个内核里的， 所以它多搞了一组寄存器 ，用来实现SIMT , 单指令多线程
"><style>:root{--article-font-family:"Noto Serif SC", var(--base-font-family)}</style><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@300;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex
<!--
extended
-->
on-phone--column extended"><div id=article-toolbar><a href=https://VastCircle.github.io/ class=back-home><svg class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg>
<span>Back</span></a></div><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header class=site-info><figure class=site-avatar><a href=/><img src=/img/avatar_hu9516569771622178000.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🍥</span></figure><h1 class=site-name><a href=/>VastCircle's blog</a></h1><h2 class=site-description>To shine , not to be illuminated</h2><ol class=social-menu><li><a href=https://github.com/VastCircle target=_blank title=GitHub><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://twitter.com target=_blank title=Twitter><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol></header><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>friends</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category></header><h2 class=article-title><a href=/2025/prefetch%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%80%9D%E8%80%83/>Prefetch的一些小思考</a></h2><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jan 22, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-words>2284字</time></div></footer></div></header><section class=article-content><h2 id=dvr的思路>DVR的思路</h2><p>1.discover mode</p><p>RPT : ( pc : 40 addr : 40 stride : 16 state : 2 最内层检测位 : 1)</p><p>DVR是引入了一个子线程，线程是跑在同一个内核里的， 所以它多搞了一组寄存器 ，用来实现SIMT , 单指令多线程</p><p>子线程的生成 ： 从跨步加载开始到存储在FLR 的 PC结束</p><p>子线程使用与主线程相同的取指，解码，执行单元</p><p>子线程指令从前端缓存区生成 ，前端缓冲区通过保持解码的微操作将取指阶段与pipline的其余部分解偶。子线程使用不同的向量发出寄存器（VIR),而不是乱序指令队列 ， 每当主线程没有为端口准备好指令（执行），就会发出子线程发出寄存器的指令</p><h2 id=svr的思路>SVR的思路</h2><p>stride detector</p><p><figure class=gallery-image style=flex-grow:1652;flex-basis:3965px><a href=/2025/prefetch%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%80%9D%E8%80%83/image-20250124121204554.png data-size=1933x117><img src=/2025/prefetch%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%80%9D%E8%80%83/image-20250124121204554.png width=1933 height=117 srcset="/2025/prefetch%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%80%9D%E8%80%83/image-20250124121204554_hu2666849609729017277.png 480w, /2025/prefetch%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%80%9D%E8%80%83/image-20250124121204554_hu9422686755703106330.png 1024w" loading=lazy alt=image-20250124121204554></a><figcaption>image-20250124121204554</figcaption></figure></p><p>taint Tracket</p><p>当指令是间接链的一部分时，“Tainted"位被set ,</p><p>为读取带有Tainted 位的寄存器的所有指令生成SVI</p><p>当内核离开piggyback runahead mode , taint is reset</p><p><figure class=gallery-image style=flex-grow:622;flex-basis:1494px><a href=/2025/prefetch%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%80%9D%E8%80%83/image-20250124121216044.png data-size=959x154><img src=/2025/prefetch%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%80%9D%E8%80%83/image-20250124121216044.png width=959 height=154 srcset="/2025/prefetch%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%80%9D%E8%80%83/image-20250124121216044_hu1008847906636732441.png 480w, /2025/prefetch%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%80%9D%E8%80%83/image-20250124121216044_hu11589088977630677302.png 1024w" loading=lazy></a></figure></p><p>HSLR</p><p>检测到stride load ,将load PC -> HSLR , 并且core 进入 Piggyback Runahead mode</p><p><figure class=gallery-image style=flex-grow:343;flex-basis:824px><a href=/2025/prefetch%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%80%9D%E8%80%83/image-20250124121148970.png data-size=402x117><img src=/2025/prefetch%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%80%9D%E8%80%83/image-20250124121148970.png width=402 height=117 srcset="/2025/prefetch%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%80%9D%E8%80%83/image-20250124121148970_hu5565158132059246444.png 480w, /2025/prefetch%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%80%9D%E8%80%83/image-20250124121148970_hu4187853805138274056.png 1024w" loading=lazy></a></figure></p><p>speculative Register File</p><p>SVI :</p><p>在检测到stride load 时，SVU会根据内存地址和跨步大小创建一个SVI</p><p>对于taint Tracket输入被污染的指令，也会执行相同操作 。</p><p>当我们从stride load(HSLR中)启动piggyback runahead mode 是，a register keeps track of the 16 least significant bits of the last indirect load executed before we return to the HSLR load。When we terminate, this is copied into the HSLR PC’s LIL entry in the stride detector2.当超过 LIL 中的指令数或达到 HSLR 负载（以先到者为准）时，我们将停止生成 SVI。</p><h2 id=思考>思考</h2><p>在大核里</p><hr><p>stride load</p><p>RPT : ( pc : 40 addr : 40 stride : 16 state : 2 最内层检测位 : 1)</p><p>当发现检测位为1，可以去清空VTT和FLR ，重新开始</p><p>每当重新遇到启动discoder mode 的pc时， 会清空所有的检测位</p><p>Taint Tracker</p><p>VTT ： 依赖链的建立 ,污点向量记录</p><p>FLR : 记录最后一个load ，更新FLR时，清空SBB和LCR</p><p>loop bound detector</p><p>SBB:是否处理过分支</p><p>LCR:保存上一个比较指令的源和目标寄存器的ID (x86是这样的) ， riscv的话，累加指令？</p><p>bne s0,s4 ,1031a</p><p>beqz s2,10362</p><hr><p>RPT dispatch -> PC , exe -> addr</p><p>不需要寄存器号</p><p>小核的执行单元和访存单元 ，写回单元（） ， 需不需要写小核的寄存器 ？</p><p>stride load imm , addr, step 寄存器号</p><p>发一条小核执行一条 ？</p><p>什么时候发送?</p><p>找到 stride load 和 loop bound , 再次进入前一个stride load 的时候</p><p>PCv 来记录 stride load pc ，在发现检测位为1时可以去更新PCv, 并且清空VTT和 FLR</p><p>下一轮会把所有标记为脏的指令全部都发送到一个结构里去 ， 然后再用一个结构向量化转发给多个小核（可以在标记的时候就发送吗 ？）</p><p>发送给某个结构的内容？</p><p>能使得小核成功执行指令的 部分</p><p>stride load addr step ， 可能不止一条stride load ,</p><p>只有stride load 需要电路控制 step</p><p>一些算数运算 rs1 rs2 rdata1 rdata2 op , 要放寄存器序号需要重命名， 可以不放寄存器号，可以直接映射到id去 （1）in-order核加一部分寄存器 （2）小核维护一个freeReg 表 ， 完成之后需要恢复</p><p>jar ?</p><p>depend load rs1 imm</p><p>boom Uop -> rocket decode , 大部分可以去除</p><p>提取 ？</p><p>dispatch -> uop</p><p>中间数据都需要通过 exe 读取 ， 最快的应该是从 iregister_read的时候读取 ，</p><p>需要提取的中间数据 ： 没有被VTT标记的寄存器值</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#7f848e>// rocket decode 
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span><span style=color:#c678dd>def</span> <span style=color:#e06c75>default</span><span style=color:#c678dd>:</span> <span style=color:#e5c07b>List</span><span style=color:#56b6c2>[</span><span style=color:#e5c07b>BitPat</span><span style=color:#56b6c2>]</span> <span style=color:#c678dd>=</span>
</span></span><span style=display:flex><span>                <span style=color:#7f848e>//           jal                                                                         renf1               fence.i
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>                <span style=color:#7f848e>//   val     | jalr                                                                      | renf2             |
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>                <span style=color:#7f848e>//   | fp_val| | renx2                                                                   | | renf3           |
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>                <span style=color:#7f848e>//   | | rocc| | | renx1               s_alu1                              mem_val       | | | wfd           |
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>                <span style=color:#7f848e>//   | | | br| | | | scie      s_alu2  |       imm    dw     alu           | mem_cmd     | | | | mul         |
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>                <span style=color:#7f848e>//   | | | | | | | | | zbk     |       |       |      |      |             | |           | | | | | div       | fence
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>                <span style=color:#7f848e>//   | | | | | | | | | | zkn   |       |       |      |      |             | |           | | | | | | wxd     | | amo
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>                <span style=color:#7f848e>//   | | | | | | | | | | | zks |       |       |      |      |             | |           | | | | | | |       | | | dp
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>                <span style=color:#e5c07b>List</span><span style=color:#56b6c2>(</span><span style=color:#e06c75>N</span><span style=color:#56b6c2>,</span><span style=color:#e06c75>X</span><span style=color:#56b6c2>,</span><span style=color:#e06c75>X</span><span style=color:#56b6c2>,</span><span style=color:#e06c75>X</span><span style=color:#56b6c2>,</span><span style=color:#e06c75>X</span><span style=color:#56b6c2>,</span><span style=color:#e06c75>X</span><span style=color:#56b6c2>,</span><span style=color:#e06c75>X</span><span style=color:#56b6c2>,</span><span style=color:#e06c75>X</span><span style=color:#56b6c2>,</span><span style=color:#e06c75>X</span><span style=color:#56b6c2>,</span><span style=color:#e06c75>X</span><span style=color:#56b6c2>,</span><span style=color:#e06c75>X</span><span style=color:#56b6c2>,</span><span style=color:#e06c75>X</span><span style=color:#56b6c2>,</span>  <span style=color:#e06c75>A2_X</span><span style=color:#56b6c2>,</span>   <span style=color:#e06c75>A1_X</span><span style=color:#56b6c2>,</span>   <span style=color:#e5c07b>IMM_X</span><span style=color:#56b6c2>,</span> <span style=color:#e5c07b>DW_X</span><span style=color:#56b6c2>,</span>  <span style=color:#e06c75>aluFn</span><span style=color:#56b6c2>.</span><span style=color:#e5c07b>FN_X</span><span style=color:#56b6c2>,</span>   <span style=color:#e06c75>N</span><span style=color:#56b6c2>,</span><span style=color:#e5c07b>M_X</span><span style=color:#56b6c2>,</span>        <span style=color:#e06c75>X</span><span style=color:#56b6c2>,</span><span style=color:#e06c75>X</span><span style=color:#56b6c2>,</span><span style=color:#e06c75>X</span><span style=color:#56b6c2>,</span><span style=color:#e06c75>X</span><span style=color:#56b6c2>,</span><span style=color:#e06c75>X</span><span style=color:#56b6c2>,</span><span style=color:#e06c75>X</span><span style=color:#56b6c2>,</span><span style=color:#e06c75>X</span><span style=color:#56b6c2>,</span><span style=color:#e5c07b>CSR</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>X</span><span style=color:#56b6c2>,</span><span style=color:#e06c75>X</span><span style=color:#56b6c2>,</span><span style=color:#e06c75>X</span><span style=color:#56b6c2>,</span><span style=color:#e06c75>X</span><span style=color:#56b6c2>,</span><span style=color:#e06c75>X</span><span style=color:#56b6c2>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#7f848e>//                                                                  frs3_en                        wakeup_delay
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>            <span style=color:#7f848e>//     is val inst?                                                 |  imm sel                     |    bypassable (aka, known/fixed latency)
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>            <span style=color:#7f848e>//     |  is fp inst?                                               |  |     uses_ldq              |    |  is_br
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>            <span style=color:#7f848e>//     |  |  is single-prec?                        rs1 regtype     |  |     |  uses_stq           |    |  |
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>            <span style=color:#7f848e>//     |  |  |  micro-code                          |       rs2 type|  |     |  |  is_amo          |    |  |
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>            <span style=color:#7f848e>//     |  |  |  |         iq-type  func unit        |       |       |  |     |  |  |  is_fence     |    |  |
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>            <span style=color:#7f848e>//     |  |  |  |         |        |                |       |       |  |     |  |  |  |  is_fencei |    |  |  is breakpoint or ecall?
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>            <span style=color:#7f848e>//     |  |  |  |         |        |        dst     |       |       |  |     |  |  |  |  |  mem    |    |  |  |  is unique? (clear pipeline for it)
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>            <span style=color:#7f848e>//     |  |  |  |         |        |        regtype |       |       |  |     |  |  |  |  |  cmd    |    |  |  |  |  flush on commit
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>            <span style=color:#7f848e>//     |  |  |  |         |        |        |       |       |       |  |     |  |  |  |  |  |      |    |  |  |  |  |  csr cmd
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>            <span style=color:#7f848e>//     |  |  |  |         |        |        |       |       |       |  |     |  |  |  |  |  |      |    |  |  |  |  |  |
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>              <span style=color:#e5c07b>List</span><span style=color:#56b6c2>(</span><span style=color:#e06c75>N</span><span style=color:#56b6c2>,</span> <span style=color:#e06c75>N</span><span style=color:#56b6c2>,</span> <span style=color:#e06c75>X</span><span style=color:#56b6c2>,</span> <span style=color:#e06c75>uopX</span>    <span style=color:#56b6c2>,</span> <span style=color:#e5c07b>IQT_INT</span><span style=color:#56b6c2>,</span> <span style=color:#e5c07b>FU_X</span>   <span style=color:#56b6c2>,</span> <span style=color:#e5c07b>RT_X</span>  <span style=color:#56b6c2>,</span> <span style=color:#e5c07b>DC2</span>    <span style=color:#56b6c2>,</span><span style=color:#e5c07b>DC2</span>    <span style=color:#56b6c2>,</span><span style=color:#e06c75>X</span><span style=color:#56b6c2>,</span> <span style=color:#e5c07b>IS_X</span><span style=color:#56b6c2>,</span> <span style=color:#e06c75>X</span><span style=color:#56b6c2>,</span> <span style=color:#e06c75>X</span><span style=color:#56b6c2>,</span> <span style=color:#e06c75>X</span><span style=color:#56b6c2>,</span> <span style=color:#e06c75>X</span><span style=color:#56b6c2>,</span> <span style=color:#e06c75>N</span><span style=color:#56b6c2>,</span> <span style=color:#e5c07b>M_X</span><span style=color:#56b6c2>,</span>   <span style=color:#e5c07b>DC2</span><span style=color:#56b6c2>,</span> <span style=color:#e06c75>X</span><span style=color:#56b6c2>,</span> <span style=color:#e06c75>X</span><span style=color:#56b6c2>,</span> <span style=color:#e06c75>N</span><span style=color:#56b6c2>,</span> <span style=color:#e06c75>N</span><span style=color:#56b6c2>,</span> <span style=color:#e06c75>X</span><span style=color:#56b6c2>,</span> <span style=color:#e5c07b>CSR</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>X</span><span style=color:#56b6c2>)</span>
</span></span></code></pre></div><p>其实我看了这么多我感觉是只要遇到一个负载就认为是跨步负载 ， 要不然对于嵌套，肯定是内部的先检测出嵌套循环</p><p>RPT肯定是要有的 ， RPT 应该是每一个load都会分配一个rpt ,</p><p>动态迭代次数也要有</p><p>迭代次数需要达到一定的数量，不能太少</p><p>控制流</p><p>for (i = 0 to N ) {</p><p>​ A[i] load A[i]</p><p>​ for (j = 0 to M ) {</p><p>​ B[j] ; load B[j]</p><p>​ }</p><p>}</p><p>for (i = 0 to N) {</p><p>​ A[i] ; load A[i]</p><p>​ B[i]; load b[i]</p><p>}</p><p>for (i = 0 to N) {</p><p>​ A[i] ; load A[i]</p><p>}</p><p>for (i = 0 to N ) {</p><p>​ B[i]; load b[i]</p><p>}</p><p>microUop</p><p>load a</p><p>store a -> b // store指令是可以不用关注的</p><p>b -> c // 编译器是不是会直接优化成 a -> c</p><p>load c //</p><p>load a // stride load</p><p>a = a ^ b</p><p>load a(imm)</p><p>发送什么 ？</p><p>顺序</p><p>从stride load 到 depend load 的指令的</p><p>dispatch 的时候进入队列 -> 重命名 ？</p><p>ROB + issue</p><p>从哪里获取 ？</p><p>dispatch uop + issue data , 专门加入一个队列来放置一些相关的数据 ，</p><p>rob uop + issue data + dispatch</p><p>发送给小核的寄存器号？</p><p>stride load exe之后的结果 可以直接发送过去</p><p>基于存放队列做重命名 -></p><p>stride load : addr step loop_bound</p><p>后面的一些指令 :</p><p>算数指令:</p><p>顺序表 -> 每个条目</p><p>按道理来说需要把从stride load -> depend load 的整个uop都发送给 小核</p><p>uop 要发送</p><p>小核不和大核共用寄存器堆</p><p>dispatch 里 ， 顺序</p><p>decode里 发送 ，重命名之前的 ， 分支 ？</p><p>RPT多余的位 最内层检测位可以用来更新 VTT和 FLR</p><p>等传递链结束的时候可以就可以进行vector runahead ,</p><p>Dependent-Load Checking</p><p>LCR : 2 src id + dest id x86 cmp eax, ebx</p><p>SBB : 1bit</p><p>架构相关 riscv : 累加 ,riscv通过判断累加值就可以判断stride,通过分支指令就可以判断循环边界 x86 通过比较指令</p><p>比较指令 往前跳</p><p>物理寄存器里</p><p>能就只发送一次吗 ？</p><p>stride +</p><p>发送什么数据</p><p>发送到一个buffer里，在buffer里做矢量化 ，在发送到小核里去</p><h2 id=附录>附录</h2><h3 id=参考文献>参考文献</h3><h3 id=版权信息>版权信息</h3><p>本文原载于 <a class=link href=https://vastcircle.github.io target=_blank rel=noopener>vastcircle.github.io</a>，遵循 CC BY-NC-SA 4.0 协议，复制请保留原文出处。</p></section><footer class=article-footer><section class=article-tags></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-contents--wrapper><h2 class=section-title>Related contents</h2><div class=related-contents><div class="flex article-list--tile"><article><a href=/2025/ubuntu22.04%E7%BD%91%E6%98%93%E4%BA%91/><div class=article-details><h2 class=article-title>Ubuntu22.04网易云</h2></div></a></article><article><a href=/2025/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/><div class=article-details><h2 class=article-title>性能优化阅读笔记</h2></div></a></article><article><a href=/2025/gem5_dvr/><div class=article-details><h2 class=article-title>Gem5_dvr</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{DISQUS&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><script>(function(e,t){var s=document,o="script",n=s.createElement(o),i=s.getElementsByTagName(o)[0];n.src=e,t&&n.addEventListener("load",function(e){t(e)}),i.parentNode.insertBefore(n,i)})("//cdn.bootcss.com/pangu/3.3.0/pangu.min.js",function(){pangu.spacingPage()})</script><section class=copyright>&copy;
2023 -
2025 <a href=https://stack-theme-mod.vercel.app/>vastcircle</a>·<i class="fas fa-bell"></i> <a id=days>0</a>Days<br>共书写了394.9k字·共 103篇文章</br><span><p></section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.2.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a><br><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh target=_blank>© Licensed Under CC BY-NC-SA 4.0</a></section><script>var days,number_of_days,s1="2024-10-06",s1=new Date(s1.replace(/-/g,"/"));s2=new Date,days=s2.getTime()-s1.getTime(),number_of_days=parseInt(days/(1e3*60*60*24)),document.getElementById("days").innerHTML=number_of_days</script></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><form action=/search/ class="search-form widget"><p><label>Search</label>
<input name=keyword required placeholder="Type something...">
<button title=Search><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg></button></p></form><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#dvr的思路>DVR的思路</a></li><li><a href=#svr的思路>SVR的思路</a></li><li><a href=#思考>思考</a></li><li><a href=#附录>附录</a><ol><li><a href=#参考文献>参考文献</a></li><li><a href=#版权信息>版权信息</a></li></ol></li></ol></nav></div></section><section class="widget categories"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-infinity" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M9.828 9.172a4 4 0 100 5.656A10 10 0 0012 12a10 10 0 012.172-2.828 4 4 0 110 5.656A10 10 0 0112 12 10 10 0 009.828 9.172"/></svg></div><h2 class="widget-title section-title">Categories</h2><div class=widget-categories--list><div class=widget><h3 class=widget-title></h3><div class=widget-body><div class=category-list><div class=category-list-item><a href=https://VastCircle.github.io/categories/boom/ class=category-list-link>boom<span class=category-list-count>2</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/boom%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB/ class=category-list-link>boom代码阅读<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/c++/ class=category-list-link>c++<span class=category-list-count>3</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/cache/ class=category-list-link>cache<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/chipyard/ class=category-list-link>chipyard<span class=category-list-count>3</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/chisel/ class=category-list-link>chisel<span class=category-list-count>2</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/cpu%E5%9F%BA%E7%A1%80/ class=category-list-link>cpu基础<span class=category-list-count>2</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/gem5/ class=category-list-link>gem5<span class=category-list-count>5</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/gpgpu%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/ class=category-list-link>gpgpu读书笔记<span class=category-list-count>2</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/linux/ class=category-list-link>linux<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/prefetch/ class=category-list-link>prefetch<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/riscv/ class=category-list-link>riscv<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/rocket-chip/ class=category-list-link>rocket-chip<span class=category-list-count>2</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/runahead/ class=category-list-link>runahead<span class=category-list-count>3</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB/ class=category-list-link>代码阅读<span class=category-list-count>2</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E5%88%86%E6%94%AF%E9%A2%84%E6%B5%8B/ class=category-list-link>分支预测<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/ class=category-list-link>博客搭建<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/ class=category-list-link>基础概念<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E5%A4%84%E7%90%86%E5%99%A8/ class=category-list-link>处理器<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/ class=category-list-link>操作系统<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E7%8E%AF%E5%A2%83/ class=category-list-link>环境<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/ class=category-list-link>环境搭建<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/ class=category-list-link>环境配置<span class=category-list-count>5</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7/ class=category-list-link>缓存一致性<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/ class=category-list-link>论文阅读<span class=category-list-count>17</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E8%AE%BF%E5%AD%98/ class=category-list-link>访存<span class=category-list-count>1</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E8%B6%85%E6%A0%87%E9%87%8F%E5%A4%84%E7%90%86%E5%99%A8/ class=category-list-link>超标量处理器<span class=category-list-count>12</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E9%A6%99%E5%B1%B1/ class=category-list-link>香山<span class=category-list-count>8</a></span></div><div class=category-list-item><a href=https://VastCircle.github.io/categories/%E9%A6%99%E5%B1%B1%E6%BA%90%E4%BB%A3%E7%A0%81/ class=category-list-link>香山源代码<span class=category-list-count>3</a></span></div></div></div></div></div></section><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-infinity" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M9.828 9.172a4 4 0 100 5.656A10 10 0 0012 12a10 10 0 012.172-2.828 4 4 0 110 5.656A10 10 0 0112 12 10 10 0 009.828 9.172"/></svg></div><h2 class="widget-title section-title">Archives</h2><div class=widget-archive--list><div class=archives-year><a href=/archives/#2025><span class=year>2025</span>
<span class=count>55</span></a></div><div class=archives-year><a href=/archives/#2024><span class=year>2024</span>
<span class=count>47</span></a></div></div></section><section class="widget tagCloud"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11 3l9 9a1.5 1.5.0 010 2l-6 6a1.5 1.5.0 01-2 0L3 11V7a4 4 0 014-4h4"/><circle cx="9" cy="9" r="2"/></svg></div><h2 class="widget-title section-title">Tags</h2><div class=tagCloud-tags><a href=/tags/runahead/ class=font_size_6>Runahead
</a><a href=/tags/prefetch/ class=font_size_4>Prefetch
</a><a href=/tags/vector/ class=font_size_3>Vector
</a><a href=/tags/cache/ class=font_size_2>Cache
</a><a href=/tags/chipyard/ class=font_size_2>Chipyard
</a><a href=/tags/diplomacy/ class=font_size_2>Diplomacy
</a><a href=/tags/in-order/ class=font_size_2>In-Order
</a><a href=/tags/rocket-chip/ class=font_size_2>Rocket-Chip
</a><a href=/tags/%E5%88%86%E6%94%AF%E9%A2%84%E6%B5%8B/ class=font_size_2>分支预测
</a><a href=/tags/%E5%AF%84%E5%AD%98%E5%99%A8%E9%87%8D%E5%91%BD%E5%90%8D/ class=font_size_2>寄存器重命名</a></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>